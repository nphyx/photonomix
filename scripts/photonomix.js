!function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=18)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.TARGET_FPS=30;e.WEIGHT_PRED_R=1.3;e.WEIGHT_PRED_G=.7;e.WEIGHT_PRED_B=1;e.START_POP=50;e.MOTE_BASE_SIZE=.015;e.MOTE_BASE_ALPHA=1;e.MOTE_BASE_SPEED=5e-4;e.MOTE_BASE_SIGHT=.15;e.PREGNANT_THRESHOLD=172;e.PREGNANT_TIME=30;e.DEATH_THRESHOLD=18;e.GRAVITY=6.67408e-8;e.GLOBAL_DRAG=.1;e.PHOTON_BASE_SIZE=.015;e.PHOTON_LIFETIME=300;e.MARKER_HIT_LIFETIME=30;e.MARKER_HIT_SIZE=.1;e.VOID_SIZE=.01;e.EMITTER_SIZE=.01;e.MAX_MOTES=300;e.MAX_PHOTONS=25800;e.MAX_VOIDS=5;e.MAX_EMITTERS=5;e.MAX_ENTITIES=26110;e.POSITIVE_ENERGY=.01;e.NEGATIVE_ENERGY=.01;e.DEBUG=!1;e.VALIDATE_VECTORS=!0;let i;const s=i="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;e.BUFFER_TYPE=s},function(t,e,n){"use strict";var i=n(27);n.d(e,"a",function(){return i.a}),n.d(e,"b",function(){return i.b})},function(t,e,n){"use strict";function i(t){return t+1e-11*o()}function s(t,e=0,n=1/0){return w(t)<w(e)?t=t<0?-e:e:w(t)>w(n)&&(t=t<0?-n:n),t}function o(){return E()>.5?1:-1}function r(t,e){return t/(w(t)+w(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.twiddle=i,e.logisticSmooth=function(t,e,n=2*t,i=1){return n/(1+v(O,i*t-e))},e.adjRand=function(t=1){return(2*E()-1)*t},e.posneg=o,e.clamp=function(t,e,n){return S(R(t,n),e)},e.ratio=r,e.rat_vec2=function(t){return r(t[M],t[A])},e.norm_ratio=function(t,e){let n=0,i=t.length;e=e||new Float32Array(i);let s=t.reduce((t,e)=>t+e,0);for(;n<i;++n)e[n]=0!==t[n]?t[n]/s:0;return e},e.evenNumber=function(t){return t>>1<<1};var a=n(1),c=n(0);const{vec2:l,magnitude:u,mut_normalize:h,distance:f,mut_times:d,mut_copy:p,mut_clamp:m}=a.b,{minus:g}=a.a,{sqrt:b,abs:w,E:O,pow:v,cos:y,sin:_,random:E,PI:C,max:S,min:R}=Math,M=0,A=1,x=function(){let t=0,e=0;return function(n){for(t=0,e=n.length;t<e;++t)n[t]=i(n[t]);return n}}();e.twiddleVec=x;const L=function(){let t,e;return function(n){for(t=0,e=n.length;t<e;t++){if(isNaN(n[t]))throw new Error("NaN vector");if(n[t]===1/0)throw new Error("Infinite vector");if(n[t]===-1/0)throw new Error("-Infinite vector")}}}();e.validate=L;const j=function(){let t=l();return function(e,n){return u(g(e,n,t))}}();e.dist=j;const T=function(){let t=0,e=0;return function(n,i=0,o=1/0){for(t=0,e=n.length;t<e;++t)n[t]=s(n[t],i,o)}}();e.limitVecMut=T;const P=function(){let t=l(),e=0,n=0,i=0,s=0;return function(o,r,a,l){if(l=l||t,g(o,r,l),e=u(l),n=l[0],i=l[1],0===n&&0===i||0===e)return l;if(s=m(1/b(n*n+i*i),1e-11,1e11),a=m(a,-1e11,1e11),l[0]=n*s,l[1]=i*s,d(l,-a*c.GRAVITY/(e*e)),c.VALIDATE_VECTORS)try{L(l)}catch(t){console.log("gravitation error",t),console.log(a),g(o,r,l),console.log("minus",l),T(l,1e-5,10),console.log("limit",l),e=u(l),console.log("magnitude",e),h(l),console.log("normalize",l),d(l,-a/(e*e)),console.log("scale",l),l.fill(0)}return l}}();e.gravitate=P;const I=function(){let t=l(),e=0,n=0,i=0;return function(s,o,r,a){if(a=a||t,g(s,o,a),n=a[0],i=a[1],0===n&&0===i)return a;if(e=m(1/b(n*n+i*i),1e-11,1e11),r=m(r,-1e11,1e11),a[0]=n*e,a[1]=i*e,d(a,-r),c.VALIDATE_VECTORS)try{L(a)}catch(t){console.log("acceleration error",t),console.log("strength",r),g(s,o,a),console.log("minus",a),h(a),console.log("normalize",a),d(a,-r),console.log("scale",a),a.fill(0)}return a}}();e.accelerate=I;const k=function(){let t=l(),e=0,n=0,i=0,o=0,r=0;return function(a,l,f){if(f=f||t,n=u(a),n=s(n,0,1e11),e=m(l*n*n,1e-11,1e11),p(f,a),o=f[0],r=f[1],0===o&&0===r||0===e)return f;if(i=m(1/b(o*o+r*r),1e-11,1e11),e=m(e,1e-11,1e11),f[0]=o*i,f[1]=r*i,d(f,-1),d(f,e),c.VALIDATE_VECTORS)try{L(f)}catch(t){console.log("drag error",t),console.log(l,n,e),console.log("magnitude",u(a)),p(f,a),console.log("copied",f),h(f),console.log("normalized",f),d(f,-1),console.log("inverted",f),d(f,e),console.log("scaled",f),f.fill(0)}return f}}();e.drag=k;const z=function(){let t=l(),e=0;return function(n,i,s,o,r,a){return e=f(i,s)*o,a=a||t,a[0]=0,a[1]=0,e>1&&I(i,s,r*e*e,a),a}}();e.avoid=z;const D=function(){let t=0,e=0;return function(n){for(t=0,e=n.length;t<e;++t)n[t]=w(n[t]);return n}}();e.absVec=D;const G=function(t,e){let n=t[0],i=t[1];return n>e||n<-e||(i>e||i<-e)};e.outOfBounds=G;const B=function(){let t=0,e=0,n=0,i=0,s=l(),o=l();return function(r,a,c,l){return l=l||s,t=y(c*C),e=_(c*C),g(r,a,o),n=o[M],i=o[A],l[M]=n*t-i*e,l[A]=n*e+i*t,l}}();e.rotate=B;const N=function(){let t=0,e=0;return function(n){for(t=n.length;t;t--)e=Math.floor(Math.random()*t),[n[t-1],n[e]]=[n[e],n[t-1]]}}();e.shuffle=N},function(t,e,n){"use strict";function i(t,e,n){let i=function(){let t=0,e=R.length;for(;t<e;++t)if(!R.get(t))return t;throw new Error("out of photons")}();return R.set(i,!0),M[i].init(t,e,n),M[i]}function s(t){R.set(t,!1),function(t){M[t].pos.fill(0),M[t].vel.fill(0),M[t].intVals.fill(0)}(t)}function o(){let t=S.buffer;this.offset=S.allocate(),this.pos=h(0,0,t,g+this.offset),this.vel=h(0,0,t,b+this.offset),this.intVals=new Uint8ClampedArray(t,w+this.offset,E),Object.defineProperties(this,{color:{get:()=>this.intVals[O],set:t=>this.intVals[O]=t},lifetime:{get:()=>this.intVals[v],set:t=>this.intVals[v]=t},mass:{get:()=>this.intVals[y],set:t=>this.intVals[y]=t},pulse:{get:()=>this.intVals[_],set:t=>this.intVals[_]=t}})}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.destroy=s,e.tick=function(t,e){let n=0,i=R.length;for(;n<i;++n)R.get(n)&&(M[n].tick(t,e),M[n].lifetime<=0&&s(n))},e.forEach=function(t){let e=0,n=R.length;for(;e<n;++e)R.get(e)&&t(M[e])},e.init=function(){for(let t=0;t<u.MAX_PHOTONS;++t)M[t]=new o},e.Photon=o;var r=n(1),a=n(15),c=n(2),l=n(5),u=n(0);let{vec2:h,times:f,mut_copy:d}=r.b,{mut_plus:p}=r.a;const{random:m}=Math,g=0,b=8,w=b+8,O=0,v=O+1,y=v+1,_=y+1,E=_+1,C=w+E+(4-(w+E)%4);e.BUFFER_LENGTH=C;e.COLOR_R=0,e.COLOR_G=1,e.COLOR_B=2;const S=new a.a(C,u.MAX_PHOTONS),R=new l.a(u.MAX_PHOTONS),M=Array(u.MAX_PHOTONS),A=new Uint32Array(3);e.STORED_PHOTONS=A,o.prototype.init=function(t,e,n){d(this.pos,t),d(this.vel,e),this.lifetime=u.PHOTON_LIFETIME,this.size=u.PHOTON_BASE_SIZE,this.color=n,this.mass=1,this.pulse=~~(u.TARGET_FPS*m())},o.prototype.tick=(()=>{let t,e,n=h();return function(i,s){this.lifetime>0&&this.lifetime--,t=this.pos,e=this.vel,p(t,f(e,s,n)),p(e,Object(c.drag)(e,u.GLOBAL_DRAG))}})(),o.prototype.destroy=function(){s(this.offset)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.scaleSprite=function(t,e){return~~(t*e)},e.colorIndex=function(t,e,n){return(t>>4<<8)+(e>>4<<4)+(n>>4)}},function(t,e,n){"use strict";var i=n(19),s=(n(22),n(30)),o=(n(12),n(34),n(8),n(35));n(36),n(37);n.d(e,"c",function(){return s}),n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o.a})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.updateCompositeOperation=function(t,e){t.globalCompositeOperation!==e&&(t.globalCompositeOperation=e)},e.screenSpace=function(t){return(t+1)/2*c.minDimension},e.screenSpaceVec=function(t,e){return e[0]=(t[0]+1)/2*c.minDimension,e[1]=(t[1]+1)/2*c.minDimension,e},e.gameSpaceVec=function(t,e){e[0]=t[0]/c.minDimension*2-1,e[1]=t[1]/c.minDimension*2-1},e.offscreen=function(t,e){return t<-.5*c.width||t>1.5*c.width||e<-.5*c.height||e>1.5*c.height},e.drawCircle=function(t,e,n,i,s,o=0,r){t.globalCompositeOperation="source-over",t.beginPath(),t.arc(e,n,i,2*Math.PI,!1),t.fillStyle=s,t.fill(),r&&(t.strokeStyle=r,t.lineWidth=o,t.stroke()),t.closePath()},e.tick=function(){l||(l=!0),i.draw(),s.draw(a),r.draw(a)},e.init=function(t,e){a=t.game,c=e.props,i.init(e),s.init(e),r.init(e)};var i=n(38),s=n(40),o=n(14),r=n(50);n.d(e,"bokeh",function(){return i}),n.d(e,"entities",function(){return s}),n.d(e,"sprites",function(){return o}),n.d(e,"ui",function(){return r});let a,c,l=!1},function(t,e,n){"use strict";function i(t,e){S[t]=function(){return new(Function.prototype.bind.apply(e,arguments))}}function s(){return this.photons=l,this.photons.init(),m.b.map("ripple","mouse0"),this.entities=[],this.stats={pop:0,born:0,died:0,target:0},this.actions={},this.registerActions(),this.started=-1,this.clickCooldown=0,this}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"Photon",function(){return b}),e.registerType=i,e.Game=s;var o=n(16),r=n(11),a=n(47),c=n(48),l=n(3),u=n(17),h=n(6),f=n(49),d=n(2),p=n(1),m=n(5),g=n(0);n.d(e,"Mote",function(){return o.b}),n.d(e,"Void",function(){return r.a}),n.d(e,"Emitter",function(){return a.a}),n.d(e,"Marker",function(){return c.a}),n.d(e,"AntiGravitonCluster",function(){return f.a}),n.d(e,"Ripple",function(){return u.a});const b=l.Photon,{minus:w}=p.a,{vec2:O,mut_copy:v}=p.b,y=new Uint16Array(g.MAX_MOTES+g.MAX_PHOTONS+100);let{random:_}=Math,E=0,C=0;const S={};i("mote",o.b),i("void",r.a),i("emitter",a.a),i("marker",c.a),i("ripple",u.a),i("antiGravitonCluster",f.a),S.randomMote=o.b.random,s.prototype.start=function(){for(let t=0;t<g.START_POP;++t)this.spawn("randomMote");this.started=Date.now()},s.prototype.tick=function(){let t,e,n=0,i=0,s=0,r=O();return function(a){0===this.clickCooldown?m.b.lookupMap("ripple").isDown()&&(Object(h.gameSpaceVec)(m.b.getCursorPosition(),r),this.spawn("ripple",r),this.clickCooldown=3):this.clickCooldown--;let c=a.interval/a.elapsed,l=a.frameCount;for(t=this.entities,this.stats.target=0,this.stats.pop=0,s=c/g.TARGET_FPS,this.photons.tick(this.entities,s,l),n=0,i=t.length;n<i;++n)(e=t[n]).tick(this.entities,s,l),e instanceof o.b?(this.stats.pop++,e.target&&this.stats.target++,e.injured&&l%~~(.1*g.TARGET_FPS)==0&&e.bleed(),e.dying===g.DEATH_THRESHOLD?(this.killMote(e),y[E]=n,this.stats.died++,E++):e.pregnant===g.PREGNANT_TIME&&(this.entities.push(e.split()),this.stats.born++)):e instanceof u.a?(e.mass>250&&(this.spawn("void",e.pos,[0,0],100),e.mass=0),e.mass<=0&&(y[E]=n,E++)):e.mass<=0&&(y[E]=n,E++),Object(d.outOfBounds)(e.pos,20)&&(y[E]=n,E++);for(;E>0;)C=y[--E],(e=t[C])&&void 0!==e.pool&&e.destroy(),t.splice(C,1),y[E]=0}}(),s.prototype.emitPhoton=function(){let t=O(),e=O(),n=O(),i=0,s=O(.05,.05);return function(o,r,a,c=i,l=12){return o=o||[1.8*_()-.9,1.8*_()-.9],r?v(e,r):(v(e,s),Object(d.rotate)(e,n,i%l/(l/2),e)),a=a||~~(3*_()),v(t,o),this.photons.create(t,e,a),i++,a}}(),s.prototype.spawn=function(){let t=Array.prototype.slice.apply(arguments).shift();S[t]&&this.entities.push(S[t].apply(null,arguments))},s.prototype.killMote=function(){let t=0,e=0,n=0,i=O(),s=0,o=0,c=0;return function(l){if(_()<g.POSITIVE_ENERGY)this.entities.push(new a.a(l.pos,l.vel,~~(10*g.DEATH_THRESHOLD*_()),void 0,l.ratios));else if(_()<g.NEGATIVE_ENERGY)this.entities.push(new r.a(l.pos,l.vel,~~(10*g.DEATH_THRESHOLD*_())));else for(v(i,l.pos),s=l.photons[0],o=l.photons[1],c=l.photons[2],t=s+c+o,e=0,n=0;n<t;++n)s===n&&(e=1),s+o===n&&(e=2),this.emitPhoton(i,void 0,e,n,t)}}(),s.prototype.registerAction=function(t,e){this.actions[t]=e.bind(this)};let R=O();s.prototype.registerActions=function(){this.registerAction("launchAntiGravitonCluster",function(t){w(this.player.mouseUp,t,R),this.entities.push(new f.a(t,R,148))})}},function(t,e,n){"use strict";function i(t,e,n){let i=e.indexOf(t);return-1!==i&&(n.push(e.splice(i,1)),!0)}function s(t){return-1===l.indexOf(t)&&-1===u.indexOf(t)?(d++,i(t,c,l)||l.push(t),fetch(f+t).then(function(t){return function(t,e){return new Promise((n,s)=>{if(e.ok){let s=e.headers.get("Content-type");return a.a(s)(e).then(e=>(function(t,e,n,s){let o=new function(t,e,n){return this.uri=t,this.content=e,this.type=n,this}(t,e,n);h[t]=o,d--,i(t,l,u),s(o)})(t,e,s,n))}s("failed to fetch asset "+t)})}.bind(null,t)}(t))):l.indexOf(t)>=0?new Promise(e=>{let n=0,i=setInterval(()=>{if(void 0!==h[t]?(e(h[t]),clearInterval(i)):n++,n>100)throw clearInterval(i),Error("stuck in fetching status way too long")},250)}):u.indexOf(t)>=0?Promise.resolve(h[t]):void 0}function o(t){let e=h[t];return void 0===e?s(t):Promise.resolve(e)}function r(t){-1===c.indexOf(t)&&-1===l.indexOf(t)&&void 0===h[t]&&c.push(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.requestAsset=o,e.requestAssetList=function(t){return Promise.all(t.map(t=>o(t)))},e.enqueueAsset=r,e.enqueueAssetList=function(t){t.forEach(t=>r(t))},e.processQueue=function(){return Promise.all(c.map(t=>s(t)))},e.setGlobalAssetPrefix=function(t){f=t};var a=n(24);const c=[],l=[],u=[],h={};let f="",d=0},function(t,e,n){"use strict";function i(t){if(0===t.length)return[[]];for(var e=[],n=0;n<t.length;n++)for(var s=t.slice(),o=s.splice(n,1),r=i(s),a=0;a<r.length;a++){var c=o.concat(r[a]);e.push(c)}return e}function s(t){return this[t]}function o(t,e){return t(e.map(t=>this[t]))}function r(t,e){return function(){let n=t.apply(null,[e].concat(Array.prototype.slice.apply(arguments)));if(!(n instanceof Float32Array))return n;switch(n.length){case 2:return g(m.vec2(n));case 3:return g(m.vec3(n));case 4:return g(m.vec4(n));default:return g(m(n.length,n))}}}function a(t,e,n){return t+n*(e-t)}function c(t,e,n,i,s,o,r,a){return t*s+e*o+n*r+i*a}function l(t){return z(t,t)}function u(t,e,n){return D(t,e,n,t)}function h(t,e,n,i,s){return G(t,e,n,i,s,t)}function f(t,e){return N(t,e,t)}function d(t,e,n){return q(t,e,n,t)}function p(t){let e=t.toArray().map(t=>t.toFixed(2));return"vec"+t.length+"("+e.join(", ")+")"}function m(){var t,e=arguments.length;if(0===e)throw new Error("vectors.create requires at least one argument");if(1===e)t=new Float32Array(arguments[0]);else{let e,n=Array.prototype.slice.apply(arguments),i=0,s=n.shift(),o=n.length;o>0&&n[o-1]instanceof ArrayBuffer?(i=0,e=n.pop()):o>1&&n[o-2]instanceof ArrayBuffer&&(i=n.pop(),e=n.pop()),t=void 0!==e?new Float32Array(e,i,s):new Float32Array(s),n.length>0&&t.set(_(n))}return t}function g(t){return b.wrap(t,t.length,1),t.toString=r(p,t),t.homogenous=r(I,t),t.times=r(N,t),t.lerp=r(D,t),t.cubic=r(G,t),t.dot=r(B,t),t.clamp=r(q,t),t.angle=F.bind(null,t),t.magnitude=k.bind(null,t),t.distance=H.bind(null,t),t.normalize=r(z,t),t.mut_normalize=r(l,t),t.mut_times=r(f,t),t.mut_lerp=r(u,t),t.mut_cubic=r(h,t),t.mut_clamp=r(d,t),t.mut_copy=r(P,t),2!==t.length&&3!==t.length||(t.cross=r(U,t)),function(t){let e,n,i;2===t.length?(n=L,i=M):3===t.length?(n=j,i=M.concat(A)):(n=T,i=M.concat(A,x));for(let e=0,i=n.length;e<i;++e){let i=s.bind(t,n[e].i);for(let s=0,o=n[e].names.length;s<o;++s)Object.defineProperty(t,n[e].names[s],{get:i})}for(let n=0,s=i.length;n<s;++n){switch(i[n].length){case 2:e=m.vec2;break;case 3:e=m.vec3;break;case 4:e=m.vec4}Object.defineProperty(t,i[n].join(""),{get:o.bind(t,e,i[n])})}}(t),t}Object.defineProperty(e,"__esModule",{value:!0}),e.mut_normalize=l,e.mut_lerp=u,e.mut_cubic=h,n.d(e,"times",function(){return N}),e.mut_times=f,n.d(e,"clamp",function(){return q}),e.mut_clamp=d,e.toString=p,e.create=m,e.wrap=g;var b=n(10);const{plus:w,minus:O,mut_plus:v,mut_minus:y}=b;e.plus=w,e.minus=O,e.mut_plus=v,e.mut_minus=y;let _=b.flatten,{sqrt:E,min:C,max:S,acos:R}=Math;const M=[];e.aliasCombos2d=M;const A=[];e.aliasCombos3d=A;const x=[];e.aliasCombos4d=x;const L=[{names:["x"],i:0},{names:["y"],i:1}];e.aliases2d=L;const j=[{names:["x","r"],i:0},{names:["y","g"],i:1},{names:["z","b"],i:2}];e.aliases3d=j;const T=[{names:["w","a"],i:3}].concat(j);e.aliases4d=T,i("xy".split("")).forEach(t=>{M.push(t)}),["xz","yz","xyz","rgb"].forEach(t=>{i(t.split("")).forEach(t=>{A.push(t)})}),["yxw","zxw","yzw","xyzw","rga","rba","gba","rgba"].forEach(t=>{i(t.split("")).forEach(t=>{x.push(t)})});const P=(()=>{let t=0,e=0,n=0;return function(i,s){for(t=0,e=i.length,n=s.length;t<e&&t<n;++t)i[t]=s[t];return i}})();e.mut_copy=P;const I=function(){let t=0,e=0;return function(n,i){for(e=n.length,i=i||m(n.length+1),t=0;t<e;++t)i[t]=n[t];return i[t]=1,i}}();e.homogenous=I;const k=function(){let t=0,e=0,n=0,i=0;return function(s){for(t=0,n=0,i=s.length;n<i;++n)e=s[n],t+=e*e;return E(t)}}();e.magnitude=k;const z=function(){let t=0,e=0,n=0;return function(i,s){for(n=i.length,s=s||m(n),t=1/k(i),e=0;e<n;++e)s[e]=i[e]*t;return s}}();e.normalize=z;const D=function(){let t=0,e=0;return function(n,i,s,o){for(e=n.length,o=o||m(e),t=0;t<e;++t)o[t]=a(n[t],i[t],s);return o}}();e.lerp=D;const G=function(){let t=0,e=0,n=0,i=0,s=0,o=0,r=0,a=0,l=0;return function(u,h,f,d,p,g){for(e=u.length,g=g||m(e),o=(i=(n=1-p)*n)*n,r=3*p*i,a=3*(s=p*p)*n,l=s*p,t=0;t<e;++t)g[t]=c(u[t],h[t],f[t],d[t],o,r,a,l);return g}}();e.cubic=G;const B=function(){let t=0,e=0;return function(n,i){for(e=0,t=n.length;t--;)e+=n[t]*i[t];return e}}();e.dot=B;var N=function(){let t=0;return function(e,n,i){if(t=e.length-1,"number"==typeof n){for(i=i||new Float32Array(t+1);t>=0;--t)i[t]=e[t]*n;return i}return B(e,n)}}();const F=function(){let t,e;return function(n,i){return t=z(n),e=z(i),R(N(t,e))}}();e.angle=F;const H=function(){let t=0,e=0,n=0,i=0;return function(s,o){for(n=0,e=s.length,t=0;t<e;++t)i=o[t]-s[t],n+=i*i;return E(n)}}();e.distance=H;const U=function(){let t=0,e=0,n=0,i=0,s=0,o=0;return function(r,a,c){if(!(r.length>3||a.length>3||r.length<2||a.length<2))return c=c||m(3),t=r[0],e=r[1],n=r[2]||0,i=a[0],s=a[1],o=a[2]||0,c[0]=e*o-n*s,c[1]=n*i-t*o,c[2]=t*s-e*i,c}}();e.cross=U;var q=(()=>{let t=0,e=0;return function(n,i,s,o){if("number"==typeof n)return function(t,e,n){return S(C(t,n),e)}(n,i,s);for(o=o||new Float32Array(n.length),t=0,e=n.length;t<e;++t)o[t]=q(n[t],i,s);return o}})();const V=m.vec2=m.bind(null,2);e.vec2=V;const X=m.vec3=m.bind(null,3);e.vec3=X;const W=m.vec4=m.bind(null,4);e.vec4=W},function(t,e,n){"use strict";function i(t){if(t instanceof Object&&"number"==typeof t.length){let e=0,n=t.length,s=[];for(;e<n;++e)s=s.concat(i(t[e]));return s}return t}function s(t,e){return t.rows===e.rows&&t.cols===e.cols||void 0===t.rows&&void 0===e.rows&&t.length===e.length||1===e.cols&&void 0===e.cols&&t.rows===e.length||1===t.rows&&void 0===e.rows&&t.cols===e.length}function o(t,e){return m(t,e,t)}function r(t,e){return g(t,e,t)}function a(t,e){return b(t,e,t)}function c(t,e){return w(t,e,t)}function l(t){return Array.prototype.slice.apply(t)}function u(t,e,n=[],s,o=0){var r;r=s?new Float32Array(s,o,e*t):new Float32Array(e*t);var a=i(n);return r.rows=t,r.cols=e,a.length?r.set(a):r.fill(0),r}Object.defineProperty(e,"__esModule",{value:!0}),e.flatten=i,e.likeMatrices=s,e.mut_plus=o,e.mut_plus_scalar=r,e.mut_minus=a,e.mut_minus_scalar=c,e.mut_multiply_scalar=function(t,e){return y(t,e,t)},e.toArray=l,e.create=u,e.wrap=function(t,e,n){return t.rows=e||t.rows,t.cols=n||t.cols,t.toArray=l.bind(null,t),t.toString=E.bind(null,t),t.col=O.bind(null,t),t.row=v.bind(null,t),t.plus=m.bind(null,t),t.plus_scalar=g.bind(null,t),t.minus=b.bind(null,t),t.minus_scalar=w.bind(null,t),t.dot=_.bind(null,t),t.multiply_scalar=y.bind(null,t),t.mut_plus=o.bind(null,t),t.mut_plus_scalar=r.bind(null,t),t.mut_minus=a.bind(null,t),t.mut_minus_scalar=c.bind(null,t),t};var h=n(9);const{cos:f,sin:d}=Math,p=h.create,m=function(){let t=0,e=0,n=0,i=0;return function(o,r,a){if(s(o,r)){for(e=o.length,n=o.rows,i=o.cols,a=a||u.similar(o),t=0;t<e;++t)a[t]=o[t]+r[t];return a}}}();e.plus=m;const g=function(){let t=0;return function(e,n,i){for(i=i||u(e.rows,e.cols),n=+n,t=e.length;t--;)i[t]=e[t]+n;return i}}();e.plus_scalar=g;const b=function(){let t=0,e=0,n=0;return function(i,o,r){if(s(i,o)){for(t=i.length,n=i.rows||0,e=i.cols||t,r=r||u.similar(i);t--;)r[t]=i[t]-o[t];return r}}}();e.minus=b;const w=function(){let t=0;return function(e,n,i){for(i=i||u(e.rows,e.cols),n=+n,t=e.length;t--;)i[t]=e[t]-n;return i}}();e.minus_scalar=w;const O=function(){let t=0,e=0;return function(n,i,s){s=s||u(n.rows,1);let o=n.cols;for(t=0,e=n.rows;t<e;++t)s[t]=n[t*o+i];return s}}();e.col=O;const v=function(){let t=0,e=0;return function(n,i,s){s=s||u(1,n.cols);let o=n.cols;for(t=0,e=n.cols;t<e;++t)s[t]=n[o*i+t];return s}}();e.row=v;const y=function(){let t=0,e=0;return function(n,i,s){for(s=s||u(n.rows,n.cols),t=0,e=n.length;t<e;++t)s[t]=n[t]*i;return s}}();e.multiply_scalar=y;const _=function(){let t=0,e=0,n=0,i=0,s=0,o=0,r=0,a=0,c=0,l=0,h=0,f=0;return function(d,p,m){if(r=void 0!==d.cols?d.cols:d.length,s=void 0!==p.rows?p.rows:p.length,r===s){for(a=void 0!==d.rows?d.rows:1,i=void 0!==p.cols?p.cols:1,t=p.length,m=m||u(a,i),f=0,c=0;c<a;++c)for(l=c*r,o=0;o<t;++o)h=l+(e=o/i|0),m[f=i*c+(n=o%i)]=m[f]+p[o]*d[h];return m}}}();e.dot=_;const E=function(){function t(t,e){return(" ".repeat(t)+e).slice(-t)}let e,n,i,s="",o=0,r=0,a=0,c=0;return function(u){for(o=0|u.cols,r=0|u.rows,s="matrix(",e=function(t){return l(t).map(t=>t.toFixed(2))}(u),n=e.reduce((t,e)=>Math.max(t,e.length),0),a=0;a<r;++a)i=e.slice(a*o,2*(a+1)*o);for(a=0,c=e.length;a<c;++a)e[a]=t(n,e[a]),a>0&&(s+=a%o==0?"\n       ":", "),s+=e[a];return s+")"}}();e.toString=E,u.similar=function(t,...e){return t.rows&&t.cols?u.apply(null,[t.rows,t.cols].concat(e)):p.apply(null,[t.length].concat(e))},u.identity=function(){let t=0,e=0,n=0;return function(i,s,o=0){let r=u(i|=0,i,void 0,s,o);for(t=0,e=i*i,n=i+1|0;t<e;t+=n)r[t]=1;return r}}(),u.translation=function(){let t=Float32Array.from([1,0,0,0,1,0,0,0,1]),e=Float32Array.from([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return function(n,i,s=0){switch(n.length){case 2:return t[2]=n[0],t[5]=n[1],u(3,3,t,i,s);case 3:return e[3]=n[0],e[7]=n[1],e[11]=n[2],u(4,4,e,i,s);default:return}}}(),u.rotateX=function(){let t=0,e=0,n=Float32Array.from([1,0,0,0,1,0,0,0,1]);return function(i,s,o=0){return t=f(i),e=d(i),n[4]=t,n[5]=-e,n[7]=e,n[8]=t,u(3,3,n,s,o)}}(),u.rotateY=function(){let t=0,e=0,n=Float32Array.from([1,0,0,0,1,0,0,0,1]);return function(i,s,o=0){return t=f(i),e=d(i),n[0]=t,n[2]=e,n[6]=-e,n[8]=t,u(3,3,n,s,o)}}(),u.rotateZ=function(){let t=0,e=0,n=Float32Array.from([1,0,0,0,1,0,0,0,1]);return function(i,s,o=0){return t=f(i),e=d(i),n[0]=t,n[1]=-e,n[3]=e,n[4]=t,u(3,3,n,s,o)}}()},function(t,e,n){"use strict";function i(t=l(),e=l(),n=1){return this.pos=l(t),this.vel=l(e),this.size=0,this.birthMass=n,this.mass=1,this.lastMeal=-1,this.eatTime=0,this}e.a=i;var s=n(1),o=n(2),r=n(7),a=n(3),c=n(0);const{vec2:l,times:u,mut_times:h,distance:f}=s.b,{mut_plus:d}=s.a,{random:p,sqrt:m,PI:g,ceil:b,min:w}=Math,O=l(0,0);let v,y=l(),_=0,E=0,C=0,S=0;i.prototype.tick=function(t,e){for(this.birthMass>0&&(S=w(this.birthMass,b(this.mass/100)),this.birthMass-=S,this.mass+=S),this.eatTime>30?this.eatTime--:this.lastMeal=-1,Object(o.outOfBounds)(this.pos,1.3)&&(this.mass=this.mass-1),this.size=m(this.mass/g)*c.VOID_SIZE,d(this.pos,u(this.vel,e,y)),d(this.vel,Object(o.avoid)(this.vel,this.pos,O,1.3,.01,y)),d(this.vel,Object(o.drag)(this.vel,c.GLOBAL_DRAG)),Object(o.limitVecMut)(this.vel,0,1),a.forEach(t=>{(C=f(this.pos,t.pos))<this.size&&(t.lifetime=t.lifetime-1,(0===t.lifetime||C<.6*this.size)&&(this.mass=this.mass+1,this.lastMeal=t.color,this.eatTime=15,t.lifetime=0)),t.lifetime>0&&d(t.vel,h(Object(o.gravitate)(t.pos,this.pos,t.mass*this.mass,y),1/t.mass))}),_=0,E=t.length;_<E;++_)(v=t[_])!==this&&(C=f(this.pos,v.pos),v instanceof r.Mote&&C<.6*this.size&&30*p()*C<1&&(v.injured=v.injured+1),v instanceof i&&C<.44*(v.size+this.size)&&this.mass>v.mass&&(S=w(v.mass,b(this.birthMass+this.mass/100)),this.birthMass+=S,v.mass-=S),v.mass&&(v instanceof r.Emitter?d(v.vel,h(Object(o.gravitate)(v.pos,this.pos,this.mass/v.mass,y),1/v.mass)):v instanceof r.AntiGravitonCluster||d(v.vel,h(Object(o.gravitate)(v.pos,this.pos,v.mass*this.mass,y),1/v.mass))))}},function(t,e,n){"use strict";function i(){return this.queue={},this}e.a=i,i.prototype.on=function(t,e){void 0===this.queue[t]&&(this.queue[t]=[]),this.queue[t].push(e)},i.prototype.fire=function(){let t,e;return function(n,i){if(void 0!==this.queue[n])for(t=0,e=this.queue[n].length;t<e;++t)this.queue[n][t].call(i)}}()},function(t,e,n){"use strict";e.b=30;e.a=6.67408e-8;e.c=!0},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){i.init(t),o.init(t),s.init(t),r.init(t),c.init(t),a.init(t)};var i=n(41),s=n(42),o=n(43),r=n(44),a=n(45),c=n(46),l=n(4);n.d(e,"motes",function(){return i}),n.d(e,"emitters",function(){return s}),n.d(e,"photons",function(){return o}),n.d(e,"voids",function(){return r}),n.d(e,"markers",function(){return a}),n.d(e,"ui",function(){return c}),n.d(e,"util",function(){return l})},function(t,e,n){"use strict";function i(t,e){let n=0;if(e){if(t*e>s)throw new Error("requested buffer size is too large");n=t*e}else n=function(t){return s-s%t}(t);let i=new ArrayBuffer(n),o=function(t){return t<Math.pow(2,8)?new Uint8Array(t):t<Math.pow(2,16)?new Uint16Array(t):new Uint32Array(t)}(e||n/t);return Object.defineProperties(this,{itemLength:{get:()=>t},buffer:{get:()=>i},size:{get:()=>n},freed:{get:()=>o}}),this.next=0,this.freedPos=0,this}e.a=i;const s=Math.pow(2,21);let o=0;i.prototype.allocate=function(){if(this.freedPos>0)o=this.popFree();else{if(!(this.next<this.size-1))throw new Error("pool buffer is full");o=this.next,this.next=this.next+this.itemLength}return o},i.prototype.popFree=function(){return this.freedPos--,o=this.freed[this.freedPos]*this.itemLength,this.freed[this.freedPos]=0,o},i.prototype.free=function(t){this.freed[this.freedPos]=0===t?t:t/this.itemLength,this.freedPos++}},function(t,e,n){"use strict";function i(t=new Uint8Array(3),e=new Float32Array(2),n=s.MOTE_BASE_SPEED,i=s.MOTE_BASE_SIGHT,o=1,a=1){let l=ct.buffer,h=ct.allocate(),f=new Uint8ClampedArray(l,A+h,3),d=new Uint8ClampedArray(l,x+h,3);f[c.COLOR_R]=t[c.COLOR_R],f[c.COLOR_G]=t[c.COLOR_G],f[c.COLOR_B]=t[c.COLOR_B];let p=new Int8Array(l,j+h,N-A),m=new Float32Array(l,W+h,st);this.pos=g(e,l,U*M+H+h),this.vel=g(0,0,l,q*M+H+h);let b=new Float32Array(l,V*M+H+h,3),w=new Float32Array(l,X*M+H+h,3);return this.target=void 0,this.color_string="",n+=Object(r.adjRand)(5e-4),i+=Object(r.adjRand)(.001),o+=Object(r.adjRand)(.001),a+=Object(r.adjRand)(.001),Object.defineProperties(this,{photons:{get:()=>f},color:{get:()=>d},dying:{get:()=>p[T],set:t=>p[T]=t},action:{get:()=>p[B],set:t=>p[B]=t},pregnant:{get:()=>p[P],set:t=>p[P]=t},injured:{get:()=>p[I],set:t=>p[I]=t},lastInjury:{get:()=>p[k],set:t=>p[k]=t},needsUpdate:{get:()=>p[D],set:t=>p[D]=t},pulse:{get:()=>p[G],set:t=>p[G]=t},lastMeal:{get:()=>p[z],set:t=>p[z]=t},size:{get:()=>m[Y],set:t=>m[Y]=t},sizeMin:{get:()=>m[Z],set:t=>m[Z]=t},sizeMax:{get:()=>m[K],set:t=>m[K]=t},speed:{get:()=>m[Q],set:t=>m[Q]=t},sight:{get:()=>m[J],set:t=>m[J]=t},agro:{get:()=>m[$],set:t=>m[$]=t},fear:{get:()=>m[tt],set:t=>m[tt]=t},potential:{get:()=>m[et],set:t=>m[et]=t},resistance:{get:()=>m[nt],set:t=>m[nt]=t},mass:{get:()=>m[it],set:t=>m[it]=t},base_speed:{get:()=>n},base_sight:{get:()=>i},base_agro:{get:()=>o},base_fear:{get:()=>a},offset:{get:()=>h},ratios:{get:()=>b},prefs:{get:()=>w}}),s.DEBUG&&Object.defineProperties(this,{intVals:{get:()=>p},floatVals:{get:()=>m}}),this.dying=0,this.pregnant=0,this.injured=0,this.lastInjury=0,this.speed=n,this.sight=i,this.agro=o,this.fear=a,this.potential=2*this.agro,this.resistance=2*this.fear,this.lastMeal=~~(3*u()),this.pulse=~~(s.TARGET_FPS*u()),this.size=s.MOTE_BASE_SIZE,this.sizeMin=.5*s.MOTE_BASE_SIZE,this.sizeMax=3*s.MOTE_BASE_SIZE,this.updateProperties(),this.prefs[c.COLOR_R]=this.ratios[c.COLOR_R],this.prefs[c.COLOR_G]=this.ratios[c.COLOR_G],this.prefs[c.COLOR_B]=this.ratios[c.COLOR_B],this}e.b=i;var s=n(0),o=n(1),r=n(2),a=n(15),c=n(3),l=n(11);let{random:u,max:h,min:f,floor:d,ceil:p,sin:m}=Math;const{vec2:g,times:b,mut_clamp:w,magnitude:O,distance:v,mut_copy:y,mut_times:_}=o.b,{plus:E,mut_plus:C}=o.a,S=w,R=g(0,0);e.a=4;Object(r.twiddleVec)(R);const M=4,A=0,x=A+3,L=x+3,j=L,T=0,P=T+1,I=P+1,k=I+1,z=k+1,D=z+1,G=D+1,B=G+1,N=B+1,F=L+N,H=F+(M-F%M),U=0,q=U+2,V=q+2,X=V+3,W=H+(X+3)*M,Y=0,Z=Y+1,K=Z+1,Q=K+1,J=Q+1,$=J+1,tt=$+1,et=tt+1,nt=et+1,it=nt+1,st=it+1,ot=W+st*M,rt=g(),at=g(),ct=new a.a(ot,s.MAX_MOTES);i.prototype.updateProperties=function(){let t,e,n,i=0,o=0,a=0;return function(){if(({photons:t,ratios:n,color:e}=this),i=t[c.COLOR_R],o=t[c.COLOR_G],a=t[c.COLOR_B],this.mass=i+o+a,this.mass>0&&(this.size=S(this.mass/(s.PREGNANT_THRESHOLD/3)*s.MOTE_BASE_SIZE,this.sizeMin,this.sizeMax),Object(r.norm_ratio)(t,n),this.speed=this.base_speed*(1-this.size)*(1+n[c.COLOR_B]),this.sight=this.base_sight+.5*this.size,this.agro=this.base_agro*(1+n[c.COLOR_R]),this.fear=this.base_fear*(1+n[c.COLOR_G]),s.DEBUG)){if(isNaN(this.speed))throw new Error("Mote.updateProperties: NaN speed");if(isNaN(this.sight))throw new Error("Mote.updateProperties: NaN sight");if(isNaN(this.size))throw new Error("Mote.updateProperties: NaN size");if(isNaN(this.agro))throw new Error("Mote.updateProperties: NaN agro");if(isNaN(this.fear))throw new Error("Mote.updateProperties: NaN fear")}this.mass>s.PREGNANT_THRESHOLD&&0===this.pregnant&&(this.pregnant=s.PREGNANT_TIME),this.mass<s.DEATH_THRESHOLD&&0===this.dying&&(this.dying=1),e[c.COLOR_R]=~~(255*n[c.COLOR_R]),e[c.COLOR_G]=~~(255*n[c.COLOR_G]),e[c.COLOR_B]=~~(255*n[c.COLOR_B]),this.needsUpdate=0}}(),i.prototype.runMaintenance=function(){let t,e,n,i=0,o=0,a=0,c=0,l=0,u=0,h=0,f=0,d=0;return function(p){({pos:t,vel:e,pregnant:i,dying:o,agro:l,fear:u,size:h,speed:f,sight:d,target:n}=this),i>0&&(this.pregnant=i-1),o>0&&(this.dying=o+1),this.needsUpdate&&this.updateProperties(),a=l*(100*h),c=u*(100*h),this.potential=S(this.potential+l*p,-a,a),this.resistance=S(this.resistance+u*p,-c,c),C(t,b(e,p,rt)),C(e,Object(r.avoid)(e,t,R,1.3,f,rt)),C(e,Object(r.drag)(e,s.GLOBAL_DRAG))}}(),i.prototype.validateTarget=function(){let t,e=0,n=0;return function(i){return({pos:t,sight:n}=this),e=v(t,i.pos),i===this?-1:i.dying?-1:i.lifetime&&i.lifetime<3?-1:i.mass<1?-1:e>n+.5*i.size?-1:Object(r.outOfBounds)(i,.7)?-1:e}}(),i.prototype.search=function(){let t,e,n,s,o,r=0,a=0,u=0,d=0,p=0,m=0,g=0,b=0,w=0,O=0;return function(v){for(({pos:t,vel:e,sight:u}=this),n=-1/0,s=0,(this.pregnant||this.dying)&&(this.action=0,n=1/0),c.forEach(t=>{t.lifetime<4||(p=this.prefs[c.COLOR_R]-this.ratios[c.COLOR_R],m=this.prefs[c.COLOR_G]-this.ratios[c.COLOR_G],g=this.prefs[c.COLOR_B]-this.ratios[c.COLOR_B],w=h(p,m,g),b=f(p,m,g),(w==p&&t.color==c.COLOR_R||w==m&&t.color==c.COLOR_G||w==g&&t.color==c.COLOR_B)&&(O=30),O=b==p&&t.color==c.COLOR_R||b==m&&t.color==c.COLOR_G||b==g&&t.color==c.COLOR_B?10:20,(d=O*(1/s))>n&&(this.target=t,this.action=2,n=d))}),r=0,a=v.length;r<a&&n<1/0;++r){o=v[r];let t=this.validateTarget(o);-1!==t&&(o instanceof i?(d=1/t*3)>n&&(this.target=o,o.target===this||t<.5*(this.size+o.size)?this.action=3:this.action=2,n=d):o instanceof l.a&&(this.target=o,this.action=3,n=1/0))}return!(n<0)}}(),i.prototype.tick=function(){let t,e,n,s,o,a,l,h,f,d,p;return function(g,w,v){switch(({pos:t,vel:e,size:n,sight:s,speed:o,agro:a,fear:l,resistance:h,potential:f,target:d}=this),this.runMaintenance(w),d&&-1===(p=this.validateTarget(d))&&(this.action=0),this.action){case 0:this.target=void 0,O(e)<.001?(rt[0]=2*u()-1,rt[1]=2*u()-1):(y(rt,t),C(rt,b(e,w,at)),C(rt,Object(r.rotate)(rt,t,m((v+this.pulse)*o),at))),C(e,Object(r.accelerate)(t,rt,o,at)),this.action=1;break;case 2:E(d.pos,b(d.vel,w,rt),at),C(e,Object(r.accelerate)(t,at,o,rt)),p<s&&(d instanceof i&&(this.potential,this.agro),this.action=4);break;case 3:E(d.pos,b(d.vel,w,rt),at),C(e,Object(r.accelerate)(at,t,o,rt)),this.resistance>3*l&&(this.action=0);break;case 4:d instanceof i?this.discharge(d):d instanceof c.Photon&&this.eatPhoton(d);break;case 5:break;case 1:this.search(g)||(this.action=0)}}}();let lt=0;i.prototype.discharge=function(t){lt=this.potential-t.resistance,t.resistance-=h(this.agro,lt*this.agro),this.potential-=h(this.fear,lt*this.fear),t.injure(this,h(0,~~lt)),this.potential<0&&(this.action=0)},i.prototype.injure=function(t,e){this.injured+=e,this.lastInjury=this.injured,(this.resistance<3*this.agro||this.injured<this.fear)&&(this.target=t)},i.prototype.bleed=function(){let t,e=0,n=0,i=g();return function(){t=this.photons;do{switch(e=~~(3*u())){case c.COLOR_R:n=t[c.COLOR_R];break;case c.COLOR_G:n=t[c.COLOR_G];break;case c.COLOR_B:n=t[c.COLOR_B]}}while(0===n);switch(e){case c.COLOR_R:t[c.COLOR_R]=t[c.COLOR_R]-1;break;case c.COLOR_G:t[c.COLOR_G]=t[c.COLOR_G]-1;break;case c.COLOR_B:t[c.COLOR_B]=t[c.COLOR_B]-1}this.injured--,_(this.vel,1+this.speed),y(i,this.vel),_(i,-1),this.needsUpdate=1,c.create(this.pos,i,e)}}(),i.prototype.split=function(){let t,e;return function(){return e=this.photons,t=new i([d(e[c.COLOR_R]/2),d(e[c.COLOR_G]/2),d(e[c.COLOR_B]/2)],this.pos,this.base_speed,this.base_sight,this.base_agro,this.base_fear),e[c.COLOR_R]=p(e[c.COLOR_R]/2),e[c.COLOR_G]=p(e[c.COLOR_G]/2),e[c.COLOR_B]=p(e[c.COLOR_B]/2),this.pregnant=s.PREGNANT_TIME-1,t.pregnant=s.PREGNANT_TIME-1,this.target=t,t.target=this,t.needsUpdate=1,this.needsUpdate=1,t}}(),i.prototype.eatPhoton=function(){let t;return function(e){if(e.lifetime>2&&v(this.pos,e.pos)<this.sight){switch(t=this.photons,e.lifetime=2,e.color){case c.COLOR_R:t[c.COLOR_R]+=1;break;case c.COLOR_G:t[c.COLOR_G]+=1;break;case c.COLOR_B:t[c.COLOR_B]+=1}this.lastMeal=e.color,this.potential-=.5*this.agro,this.resistance-=.5*this.fear,this.needsUpdate=1}this.action=0}}();const ut=new Float32Array(2),ht=new Uint8ClampedArray(3);i.random=function(){do{ut[0]=u()*Object(r.posneg)(),ut[1]=u()*Object(r.posneg)()}while(O(ut)>.8);return ht[0]=~~(64*u()),ht[1]=~~(64*u()),ht[2]=~~(64*u()),new i(ht,ut)},i.prototype.destroy=function(){ct.free(this.offset)}},function(t,e,n){"use strict";function i(t=l(),e=100){return this.pos=l(t),this.vel=l(0,0),this.storedMass=0,this.mass=e,this}e.a=i;var s=n(1),o=n(2),r=n(3),a=n(11);let c,{vec2:l,mut_times:u,distance:h}=s.b,{mut_plus:f}=s.a,d=l(),p=0,m=0,g=0;i.prototype.tick=function(t){for(this.storedMass?(this.mass+=this.storedMass,this.storedMass=0):this.mass--,r.forEach(t=>{(g=h(this.pos,t.pos))<.01?t.lifetime=0:f(t.vel,u(Object(o.gravitate)(t.pos,this.pos,20*this.mass,d),1/t.mass))}),p=0,m=t.length;p<m;++p)(c=t[p])!==this&&(g=h(this.pos,c.pos),c instanceof i&&!c.storedMass?g<.005&&g>.001&&(this.storedMass++,c.mass--):c instanceof a.a?(g<.0025&&(c.birthMass+=this.storedMass,this.storedMass=0),g-c.size<.01&&this.mass>90&&this.mass<100&&c.mass--,this.storedMass=0):f(c.vel,u(Object(o.gravitate)(c.pos,this.pos,-this.mass*c.mass,d),1/c.mass)))}},function(t,e,n){"use strict";function i(){let t=document.querySelector(l.container);u.state.game.start(),t.removeEventListener("click",i),t.classList.remove("start"),console.log("game started")}Object.defineProperty(e,"__esModule",{value:!0}),e.startGame=i;var s=n(5),o=n(6),r=n(7),a=n(0),c=n(2);const l={container:"body",bufferDescriptions:[{label:"bokehBack",compositeMethod:"source-over",scaleMethod:s.c.buffers.SCALE_KEEP_ASPECT},{label:"bokehFront",compositeMethod:"lighter",scaleMethod:s.c.buffers.SCALE_NONE},{label:"entitiesLight",compositeMethod:"lighter",scaleMethod:s.c.buffers.SCALE_NONE},{label:"entitiesDark",compositeMethod:"hard-light",scaleMethod:s.c.buffers.SCALE_NONE},{label:"ui",compositeMethod:"source-over",scaleMethod:s.c.buffers.SCALE_NONE}],pixelRatio:1,frameCallback:function(){u.state.game.started&&u.state.game.tick(s.c.timing),u.draw.tick()}};var u={util:c,constants:a,controls:s.b,display:s.c,game:r,draw:o,state:{}};window.photonomix=u,window.addEventListener("load",function(){u.state.game=new r.Game,s.c.init(l),o.init(u.state,s.c),s.b.init(),document.querySelector(l.container).addEventListener("click",i)})},function(t,e,n){"use strict";function i(t){if(t instanceof Object&&"number"==typeof t.length){let e=0,n=t.length,s=[];for(;e<n;++e)s=s.concat(i(t[e]));return s}return t}function s(t,...e){const n=function(t){let e=o(t);void 0===e&&(e=new f.a(t),p[t]=e);return e}(t);return(e=i(e)).forEach(t=>{const e=function(t){let e=r(t=t.toLowerCase());void 0===e&&(e=new h.a(t),d.push(e));return e}(t);-1==n.keys.indexOf(e)&&n.keys.push(e)}),n}function o(t){return p[t]}function r(t){return t=t.toLowerCase(),d.filter(e=>e.key===t)[0]}function a(t){const e=Date.now();if(t instanceof MouseEvent){const n=r("mouse"+t.button);n&&n.lastUp>=n.lastDown&&(n.down=!0,n.lastDown=e)}else if(t instanceof KeyboardEvent){const n=r(t.key);n&&n.lastUp>=n.lastDown&&(n.down=!0,n.lastDown=e)}}function c(t){const e=Date.now();if(t instanceof MouseEvent){const n=r("mouse"+t.button);n&&(n.down=!1,n.lastUp=e)}else if(t instanceof KeyboardEvent){const n=r(t.key);n&&(n.down=!1,n.lastUp=e)}}function l(){const t=Date.now();d.forEach(e=>{e.down=!1,e.lastUp=t})}function u(t){m[0]=t.clientX,m[1]=t.clientY}Object.defineProperty(e,"__esModule",{value:!0}),e.flatten=i,e.map=s,e.unmap=function(t,e){if(p[t]){let n=p[t].keys.indexOf(r(e));n&&p.keys.splice(n,1)}return p[t]},e.lookupMap=o,e.lookupKeyState=r,e.getCursorPosition=function(){return Float32Array.of(m[0],m[1])},e.init=function(){window.addEventListener("keydown",a),window.addEventListener("keyup",c),window.addEventListener("mousedown",a),window.addEventListener("mouseup",c),window.addEventListener("blur",l),window.addEventListener("mousemove",u)};var h=n(20),f=n(21);const d=[],p={},m=new Float32Array(2)},function(t,e,n){"use strict";e.a=function(t){return this.key=t,this.down=!1,this.lastDown=0,this.lastUp=0,Object.seal(this)}},function(t,e,n){"use strict";function i(t){return t=t.toLowerCase(),this.label=t,this.keys=[],this.checkedDown=0,this.checkedUp=0,Object.seal(this)}e.a=i,i.prototype.lastDown=function(){return this.keys.reduce((t,e)=>t=t>e.lastDown?t:e.lastDown,0)},i.prototype.lastUp=function(){return this.keys.reduce((t,e)=>t=t>e.lastDown?t:e.lastDown,0)},i.prototype.isDown=function(){return this.keys.reduce((t,e)=>t=t||e.down,!1)},i.prototype.onceDown=function(){return!!(this.lastUp()>=this.checkedDown&&this.isDown())&&(this.checkedDown=Date.now(),!0)},i.prototype.onceUp=function(){return this.lastDown()>=this.checkedUp&&!this.isDown()&&(this.checkedUp=Date.now(),!0)}},function(t,e,n){"use strict";n(23),n(25),n(26),n(29)},function(t,e,n){"use strict";function i(t,e,n,i){return this.frameCount=t,this.frameWidth=e,this.frameHeight=n,this.animations=i,this.context=void 0,this.flippedContext=void 0,this.ready=!1,this.width=0,this.height=0,this.rows=0,this.columns=0,Object.seal(this)}var s=n(8);let o=[];i.prototype.init=function(t,e=!0){let n=document.createElement("canvas");n.width=this.width=t.width,n.height=this.height=t.height,this.columns=n.width/this.frameWidth,this.rows=n.height/this.frameHeight;let i=n.getContext("2d");i.drawImage(t,0,0),this.context=i,e&&this.generateFlipped(),this.ready=!0},i.prototype.generateFlipped=function(){let t=document.createElement("canvas");t.width=this.width,t.height=this.height;let e,n,i,s,o,r,a=t.getContext("2d"),c=this.rows,l=this.cols,u=this.frameWidth,h=this.frameHeight;for(a.scale(-1,1),e=0,c=this.rows;e<c;++e)for(n=0,l=this.columns;n<l;++n)o=i=n*u,s=r=e*h,a.drawImage(this.context.canvas,i,s,u,h,-i-u,r,u,h);a.setTransform(1,0,0,1,0,0),this.flippedContext=a},i.prototype.draw=function(t,e,n,i,s=!1){let o=this.animations[e]?this.animations[e]:this.animations.default,r=o.startFrame+n%o.length,{frameWidth:a,frameHeight:c}=this,l=s?this.flippedContext.canvas:this.context.canvas;t.drawImage(l,function(t,e){return e%t.columns*t.frameWidth}(this,r),function(t,e){return Math.floor(e/t.columns)*t.frameHeight}(this,r),a,c,i[0],i[1],a,c)},i.fromAsepriteAtlas=function(t){return new Promise(e=>{void 0!==o[t]&&o[t]instanceof i?e(o[t]):(console.log(s),s.requestAsset(t).then(n=>{let r=n.content,a={default:{label:"default",startFrame:0,length:1}};r.meta.frameTags&&r.meta.frameTags.forEach(t=>{a[t.name.toLowerCase()]={label:t.name.toLowerCase(),startFrame:t.from,length:t.to-t.from+1}}),s.requestAsset(r.meta.image).then(n=>{let s=new i(r.frames.length,r.frames[0].frame.w,r.frames[0].frame.h,a);s.init(n.content),o[t]=s,e(s)})}))})}},function(t,e,n){"use strict";function i(t,e){if(void 0!==r[t])throw new Error("tried to add a mimeType but there's already a handler for it");r[t]=e}function s(t){return new Promise(e=>{t.blob().then(t=>{let n=document.createElement("img");n.addEventListener("load",()=>e(n)),n.src=URL.createObjectURL(t)})})}function o(t){return new Promise(e=>t.text().then(t=>e(t)))}e.a=function(t){return"function"==typeof r[t]?r[t]:r.default};const r={default:t=>new Promise(e=>t.blob().then(t=>e(t)))};i("image/jpeg",s),i("image/gif",s),i("image/png",s),i("text/html",o),i("text/plain",o),i("application/json",function(t){return new Promise(e=>t.json().then(t=>e(t)))})},function(t,e,n){"use strict";(function(){return this}).prototype.init=function(t){let e=document.createElement("canvas");e.width=this.width=t[0].width,e.height=this.height=t[0].height,this.columns=e.width/this.frameWidth,this.rows=e.height/this.frameHeight;let n=e.getContext("2d");for(let e=0,i=t.length;e<i;++e)n.drawImage(t[e],0,0);this.ready=!0,this.spriteCanvas=e}},function(t,e,n){"use strict";function i(t,e,n){return this.layers=t,this.animations=e,this.slices=n,this.source=void 0,this.context=void 0,this.flippedContext=void 0,this.ready=!1,Object.seal(this)}var s=n(8),o=n(1);const r=[];i.prototype.init=function(t,e=!0){this.source=t;let n=document.createElement("canvas");n.width=t.width,n.height=t.height;let i=n.getContext("2d");i.drawImage(t,0,0),this.context=i,e&&this.generateFlipped(),this.ready=!0},i.prototype.generateFlipped=function(){let t=document.createElement("canvas");t.width=this.context.canvas.width,t.height=this.context.canvas.height;let e=t.getContext("2d");e.scale(-1,1);let n,i,s,r=t=>{let i=this.slices[t],r=o.b.vec2(i.pos);o.b.mut_plus(r,s.frames[n].pos),e.drawImage(this.context.canvas,r[0],r[1],i.dims[0],i.dims[1],-r[0]-i.dims[0],r[1],i.dims[0],i.dims[1])};Object.keys(this.layers).forEach(t=>{for(s=this.layers[t],n=0,i=s.frames.length;n<i;++n)Object.keys(this.slices).filter(t=>"default"!==t).forEach(r)}),e.setTransform(1,0,0,1,0,0),this.flippedContext=e},i.prototype.draw=function(t,e,n,i=!1,s){let r=this.slices[e]?this.slices[e]:this.slices.default,a=i?this.flippedContext.canvas:this.context.canvas;void 0===s&&(s=Object.keys(this.layers)),s.forEach(e=>{let i=o.b.vec2(r.pos);o.b.mut_plus(i,this.layers[e].frames[0].pos),t.drawImage(a,i[0],i[1],r.dims[0],r.dims[1],n[0],n[1],r.dims[0],r.dims[1])})},i.prototype.animate=function(t,e,n,i,s=!1,o){void 0===o&&(o=Object.keys(this.layers));let r=this.animations[e]?this.animations[e]:this.animations.default,a=r.start+i%r.length,c=s?this.flippedContext.canvas:this.context.canvas;o.forEach(e=>{let i=this.layers[e].frames[a];t.drawImage(c,i.pos[0],i.pos[1],i.dims[0],i.dims[1],n[0],n[1],i.dims[0],i.dims[1])})},i.prototype.prebake=function(){throw new Error("unimplemented")},i.fromAsepriteAtlas=function(t,e){return e=e||function(t){return t},new Promise(n=>{void 0!==r[t]&&r[t]instanceof i?n(r[t]):(console.log(s),s.requestAsset(t).then(a=>{let c,l=a.content,u=l.meta.size.w,h=l.meta.size.h,f=l.meta.layers.length,d=l.frames.length/f,p=h/f,m={},g=[];l.meta.layers.forEach((t,n)=>{g.push(t.name),void 0===m[t.name]&&(c={label:t.name.trim(),data:e(t.data?t.data:""),opacity:t.opacity,blendMode:t.blendMode,pos:o.b.vec2(0,n*p),frames:[]},m[c.label]=Object.freeze(c))});let b,w={default:{label:"default",data:e(""),pos:o.b.vec2(0,0),dims:o.b.vec2(u,h)}};l.meta.slices.forEach(t=>{void 0===w[t.name]&&(b={label:t.name.trim(),data:e(t.data?t.data:""),pos:o.b.vec2(t.keys[0].bounds.x,t.keys[0].bounds.y),dims:o.b.vec2(t.keys[0].bounds.w,t.keys[0].bounds.h)},w[b.label]=Object.freeze(b))});let O,v={};l.meta.frameTags.forEach(t=>{void 0===v[t.name]&&(O={label:t.name.trim(),start:t.from,length:t.to-t.from+1},v[O.label]=Object.freeze(O))}),l.frames.forEach((t,e)=>{let n=m[g[~~(e/d)]],i={pos:o.b.vec2(t.frame.x,t.frame.y),dims:o.b.vec2(t.frame.w,t.frame.h)};n.frames.push(Object.freeze(i))}),s.requestAsset(l.meta.image).then(e=>{let s=new i(Object.seal(m),Object.seal(v),Object.seal(w));s.init(e.content),r[t]=s,n(s)})}))})}},function(t,e,n){"use strict";var i=n(9),s=n(10);n(28);const o=i;e.b=o;const r=s;e.a=r},function(t,e,n){"use strict";function i(t){if(0===t.length)return[[]];for(var e=[],n=0;n<t.length;n++)for(var s=t.slice(),o=s.splice(n,1),r=i(s),a=0;a<r.length;a++){var c=o.concat(r[a]);e.push(c)}return e}function s(t){return t.map(t=>this[t])}function o(t){return"quaternion("+h.toArray(t).map(t=>t.toFixed(2)).join(", ")+")"}function r(t,e){e=e||a();return f(t,e)}function a(){let t=[0,0,0,1],e=Array.prototype.slice.apply(arguments),n=e.length;0===n?e=t:e[n-1]instanceof ArrayBuffer?e=1===n?t.concat(e).concat([0]):e.concat([0]):e[n-2]instanceof ArrayBuffer&&2===n&&(e=t.concat(e));return u.create.apply(null,[4].concat(e))}function c(t){return function(t){Object.defineProperties(t,{x:{get:function(){return this[0]}},y:{get:function(){return this[1]}},z:{get:function(){return this[2]}},w:{get:function(){return this[3]}}});for(let e=0,n=w.length;e<n;++e)Object.defineProperty(t,w[e].join(""),{get:s.bind(t,w[e])})}(t),h.wrap(t),t.slerp=l(O,t),t.normalize=l(r,t),t.invert=l(v,t),t.toString=o.bind(null,t),t.times=l(u.times,t),t.clamp=l(u.clamp,t),t.normalize=l(u.normalize,t),t.mut_normalize=l(u.mut_normalize,t),t.mut_times=l(u.mut_times,t),t.mut_clamp=l(u.mut_clamp,t),t.mut_copy=l(u.mut_copy,t),t}function l(t,e){return function(){return c(a(t.apply(null,[e].concat(Array.prototype.slice.apply(arguments)))))}}Object.defineProperty(e,"__esModule",{value:!0}),e.toString=o,e.normalize=r,e.create=a,e.wrap=c;var u=n(9),h=n(10);const f=u.normalize,{abs:d,sin:p,cos:m,acos:g,sqrt:b}=Math;let w=[];["xyzw","xyz","xzw","xyw","yzw","xy","xw","xz","yz","yw","zw"].forEach(t=>{i(t.split("")).forEach(t=>{w.push(t)})});const O=function(){let t=0,e=0,n=0,i=0,s=0,o=0,r=0,c=0,l=0,u=0,h=0,f=0,m=0;return function(w,O,v,y){return t=w[0],e=O[0],n=w[1],i=O[1],s=w[2],o=O[2],r=w[3],c=O[3],l=t*e+n*i+s*o+r*c,y=y||a(),d(l)>=1?(y[0]=t,y[1]=n,y[2]=s,y[3]=r,y):(h=g(l),u=b(1-l*l),f=p((1-v)*h)/u,m=p(v*h)/u,y[0]=t*f+e*m,y[1]=n*f+i*m,y[2]=s*f+o*m,y[3]=r*f+c*m,y)}}();e.slerp=O;const v=function(t,e=!0,n){return n=n||a(),e?r(t,n):n.set(t),n[0]=-n[0],n[1]=-n[1],n[2]=-n[2],n};e.invert=v,a.identity=function(){return a()},a.fromEulerAngles=function(){let t=0,e=0,n=0,i=0,s=0,o=0,r=0,c=0,l=0,u=0,h=0;return function(f,d,g){let b=a(d,g);return t=f[0]/2,e=f[1]/2,n=f[2]/2,i=m(t),s=p(t),o=m(e),r=p(e),c=m(n),l=p(n),u=i*o,h=s*r,b[0]=u*l+h*c,b[1]=s*o*c+i*r*l,b[2]=i*r*c-s*o*l,b[3]=u*c-h*l,b}}(),a.fromAxisAngle=function(){let t=0,e=0;return function(n,i,s,o){let r=a(s,o);return t=f(n),e=i/2,r[0]=t[0]*p(e),r[1]=t[1]*p(e),r[2]=t[2]*p(e),r[3]=m(e),r}}()},function(t,e,n){"use strict";function i(){return this}i.prototype.init=function(t){},i.prototype.write=function(t,e,n,i,s,o=1){}},function(t,e,n){"use strict";function i(t){return t>>1<<1}function s(){C||(C=!0,document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),x.events.fire("fullscreen-off")):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),x.events.fire("fullscreen-on")))}function o(t){return t.preventDefault(),C=!!(document.webkitIsFullScreen||document.mozIsFullScreen||document.msIsFullScreen),!1}function r(){A.width=x.width=i(m.clientWidth),A.height=x.height=i(m.clientHeight),x.orientation=x.width>x.height?0:1,x.minDimension=b(x.width,x.height),x.maxDimension=w(x.width,x.height),R.forEach(t=>{t.width=~~(x.width/x.pixelRatio),t.height=~~(x.height/x.pixelRatio)}),x.events.fire("resize")}function a(){requestAnimationFrame(a);try{let t=Date.now();(y=t-S)>v&&(S=t-y%v,_++,g(M),u.composite(R,A,x))}catch(t){console.error("Crappy uncaught error in animation loop is crappy")}}function c(t){x.pixelRatio=t.pixelRatio||x.pixelRatio,(m=document.querySelector(t.container)).classList.add("2d"),A=new u.CompositeBuffer(m),m.width=A.width=i(m.clientWidth),m.height=A.height=i(m.clientHeight),function(t){for(let e=0,n=t.length;e<n;++e){let n=t[e],i=new u.DrawBuffer(n.compositeMethod,n.scaleMethod);i.id=n.label,R.push(i),M[n.label]=i}}(t.bufferDescriptions),r(),g=t.frameCallback,window.addEventListener("resize",r),(O=t.fullscreen)&&(m.addEventListener("click",s),document.addEventListener("fullscreenchange",o),document.addEventListener("mozfullscreenchange",o),document.addEventListener("msfullscreenchange",o),document.addEventListener("webkitfullscreenchange",o)),p=Date.now(),S=p,v=1e3/d.b,E||requestAnimationFrame(a),E=!0}Object.defineProperty(e,"__esModule",{value:!0}),e.evenNumber=i,e.updateCompositeOperation=function(t,e){t.globalCompositeOperation!==e&&(t.globalCompositeOperation=e)},e.init=c;var l=n(31),u=n(32),h=n(12),f=n(33);n.n(f);n.d(e,"buffers",function(){return u}),n.d(e,"ui",function(){return f}),n.d(e,"util",function(){return l});var d=n(13);let p,m,g,{min:b,max:w}=Math,O=!1,v=0,y=0,_=0,E=!1,C=!1,S=0;const R=[],M={};e.buffersByLabel=M;let A;const x={width:0,height:0,pixelRatio:1,orientation:0,aspect:0,minDimension:0,maxDimension:0,events:new h.a};e.props=x;const L={get frameCount(){return _},get startTime(){return p},get lastFrame(){return S},get elapsed(){return y},get interval(){return v}};e.timing=L},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.drawCircle=function(t,e,n,i,s,o=0,r){t.globalCompositeOperation="source-over",t.beginPath(),t.arc(e,n,i,2*Math.PI,!1),t.fillStyle=s,t.fill(),r&&(t.strokeStyle=r,t.lineWidth=o,t.stroke()),t.closePath()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrawBuffer=function(t="source-over",e=s,n="2d"){return this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext(n),this.offsetX=0,this.offsetY=0,this.compositeMethod=t,this.scaleMethod=e,Object.defineProperties(this,{width:{get:()=>this.canvas.width,set:t=>this.canvas.width=t},height:{get:()=>this.canvas.height,set:t=>this.canvas.height=t}}),this},e.CompositeBuffer=function(t){return this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.container=t,this.container.appendChild(this.canvas),Object.defineProperties(this,{width:{get:()=>this.canvas.width,set:t=>this.canvas.width=t},height:{get:()=>this.canvas.height,set:t=>this.canvas.height=t}}),this};const{min:i}=Math,s=0;e.SCALE_STRETCH=s;e.SCALE_KEEP_ASPECT=1;e.SCALE_NONE=2;e.SCALE_CROP=3;const o=function(){let t,e,n,o,r,a,c,l,u,h,f,d;return function(p,m,g){for(o=m.context,1!==g.pixelRatio&&(o.imageSmoothingEnabled=!1),t=0,e=p.length;t<e;++t){switch(n=p[t],o.globalCompositeOperation!==n.compositeMethod&&(o.globalCompositeOperation=n.compositeMethod),n.scaleMethod){case s:c=0,l=0,r=n.width,a=n.height,f=n.offsetX,d=n.offsetY,u=m.width,h=m.height;break;case 1:c=0,l=0,r=n.width,a=n.height,f=n.offsetX,d=n.offsetY,u=m.width,h=m.height,g.orientation?(r=m.width,a=i(m.height,n.height),u=i(m.width,n.width),h=m.height):(r=i(m.width,n.width),a=m.height,u=m.width,h=i(m.height,n.height));break;case 3:c=0,l=0,r=i(m.width-n.offsetX,n.width),a=i(m.height-n.offsetY,n.height),f=n.offsetX,d=n.offsetY,u=i(m.width-n.offsetX,n.width),h=i(m.height-n.offsetY,n.height);break;default:c=0,l=0,r=n.width,a=n.height,f=n.offsetX,d=n.offsetY,u=n.width*g.pixelRatio,h=n.height*g.pixelRatio}o.drawImage(n.canvas,c,l,r,a,f,d,u,h)}}}();e.composite=o},function(t,e,n){"use strict"},function(t,e,n){"use strict";function i(t,e=0,n=1/0){return m(t)<m(e)?t=t<0?-e:e:m(t)>m(n)&&(t=t<0?-n:n),t}var s=n(13),o=n(1);const{minus:r,mut_clamp:a,mut_copy:c,mut_times:l,normalize:u,mut_normalize:h,magnitude:f,vec2:d}=o.b,{sqrt:p,abs:m,floor:g,ceil:b,round:w}=Math,O=function(){let t=0,e=0;return function(n,s=0,o=1/0){for(t=0,e=n.length;t<e;++t)n[t]=i(n[t],s,o)}}(),v=function(){let t,e;return function(n){for(t=0,e=n.length;t<e;t++){if(isNaN(n[t]))throw new Error("NaN vector");if(n[t]===1/0)throw new Error("Infinite vector");if(n[t]===-1/0)throw new Error("-Infinite vector")}}}();(function(){let t=d(),e=0,n=0,i=0,s=0})(),function(){let t=d(),e=0,n=0,i=0}(),function(){let t=d(),e=0,n=0,i=0,s=0,o=0}()},function(t,e,n){"use strict";function i(){if(arguments[0]instanceof ArrayBuffer&&"number"==typeof arguments[1]&&"number"==typeof arguments[2])this[s]=new Uint8Array(arguments[0],arguments[1],Math.ceil(arguments[2]/8));else{if("number"!=typeof arguments[0])throw Error("expected either length or buffer, offset, length as arguments");this[s]=new Uint8Array(Math.ceil(arguments[0]/8))}return this.length=8*this[s].byteLength,Object.freeze(this),this}e.a=i;const s=Symbol();i.prototype.get=function(t){let e=~~(t/8),n=t%8;return!!(this[s][e]&1<<n)},i.prototype.set=function(t,e){let n=~~(t/8),i=t%8;e?this[s][n]|=1<<i:this[s][n]&=255^1<<i},i.prototype.fill=function(t){this[s].fill(t?255:0)},i.prototype.recycle=function(){this[s].fill(0)}},function(t,e,n){"use strict"},function(t,e,n){"use strict";function i(t=0,e=0){return this.width=0,this.height=0,this.cellWidth=0,this.cellHeight=0,this.length=0,t&&e&&this.init(t,e),this}const{floor:s}=Math,o=Math.pow(2,16)-1,r=new Uint16Array(4),a=new Uint16Array(4),c=new Uint16Array(4),l=new Uint16Array(4),u=new Uint16Array(4),h=new Uint16Array(4);if(r[0]=4369,r[1]=r[0]<<1,r[2]=r[0]<<2,r[3]=r[0]<<3,(r[0]|r[1]|r[2]|r[3])!==o)throw new Error("MASK_X is bad");if(a[0]=15,a[1]=a[0]<<4,a[2]=a[0]<<8,a[3]=a[0]<<12,(a[0]|a[1]|a[2]|a[3])!==o)throw new Error("MASK_Y is bad");c[0]=0,c[1]=a[3],c[2]=c[1]|a[2],c[3]=c[2]|a[1],l[0]=0,l[1]=a[0],l[2]=l[1]|a[1],l[3]=l[2]|a[2],u[0]=0,u[1]=r[3],u[2]=u[1]|r[2],u[3]=u[2]|r[1],h[0]=0,h[1]=r[0],h[2]=h[1]|r[1],h[3]=h[2]|r[2];const f=Symbol();i.CHANNEL_RED=0,i.CHANNEL_GREEN=1,i.CHANNEL_BLUE=2,i.CHANNEL_ALPHA=3,i.fromCanvasPixels=function(t,e=0,n=i.CHANNEL_ALPHA){console.time("new CollisionMap");let s=new i(t.width,t.height);console.timeEnd("new CollisionMap");let o,r=t.getContext("2d");console.time("fromCanvasPixels loop");let a=!0;for(let i=0,c=t.height;i<c;i+=100){try{a&&console.time("getImageData"),o=r.getImageData(0,i,t.width,100).data,a&&console.timeEnd("getImageData")}catch(t){throw new Error("CollisionData:failed to get image data :(")}a&&console.time("loop map.set");for(let r=0,a=o.length;r<a;r+=4){let a=r/4%t.width,c=i+~~(r/4/t.width);o[r+n]>e&&s.set(a,c,!0)}a&&console.timeEnd("loop map.set"),a=!1}return console.timeEnd("fromCanvasPixels loop"),s};const d=i.cellBit=function(t,e){return 1<<t%4+e%4*4},p=i.cellMask=function(t,e){return function(t){return o^t}(d(t,e))},m=i.cellIndex=function(t,e,n){return s(e/4)*s(n/4)+s(t/4)};i.prototype.init=function(t,e){this.width=~~t,this.width%4&&(this.width+=4-~~t%4),this.height=~~e,this.height%4&&(this.height+=4-~~e%4),this.cellWidth=this.width/4,this.cellHeight=this.height/4;let n=this.cellWidth*this.cellHeight;return this.length!==n?(this.length=n,this.length&&(this[f]=new Uint16Array(this.length))):this[f]&&this[f].fill(0),this},i.prototype.getCell=function(t,e){return this[f][m(t,e,this.width)]},i.prototype.get=function(t,e){return this.getCell(t,e)&d(t,e)?1:0},i.prototype.set=function(t,e,n){n?this[f][m(t,e,this.width)]|=d(t,e):this[f][m(t,e,this.width)]&=p(t,e)},i.prototype.checkRect=function(t,e,n,i){let s,r,a=t%4,d=e%4,p=Math.ceil((a+n)/4),m=Math.ceil((d+i)/4);for(let t=0;t<m;++t){r=0===t?c[d]:t===m-1?l[d]:o;for(let e=0;e<p;++e)if((s=0===e?h[a]:e===p-1?u[a]:o)&r&this[f][t*this.cellWidth+e])return 1}return 0},i.prototype.intersect=function(t,e,n,i,s,o,r){let a,c,l=0;for(c=0;c<r;++c)for(a=0;a<r;++a)l+=this.get(e+a,n+c)&&t.get(i+a,s+c)?1:0;return l},i.MASK_X=r,i.MASK_Y=a,i.MASK_TOP=c,i.MASK_BOTTOM=l,i.MASK_LEFT=h,i.MASK_RIGHT=u},function(t,e,n){"use strict";function i(t,e){return Math.random()*(e-t)+t}function s(t,e,n,i){return"hsla("+t+","+e+"%,"+n+"%,"+i+")"}function o(){let t=u.width,e=u.height,n=Math.min(t,e),i=Math.max(t,e);h.fillStyle="black",h.fillRect(0,0,t,e);let s=h.createLinearGradient(0,0,t,e);s.addColorStop(0,g[0]),s.addColorStop(.5,g[1]),s.addColorStop(1,g[2]),h.fillStyle=s,h.fillRect(0,0,t,e),(s=h.createLinearGradient(0,e,t,0)).addColorStop(0,b[0]),s.addColorStop(.5,b[1]),s.addColorStop(1,b[2]),h.fillStyle=s,h.fillRect(0,0,t,e),r(h,0,0,t,e,6);let o=(i-n)/i;(s=h.createRadialGradient(t/2,e/2,i/2,t/2,e/2,0)).addColorStop(1,"rgba(32,32,32,0.5)"),s.addColorStop(o+.06,"rgba(0,0,0,0.8)"),s.addColorStop(o+.05,"rgba(128,128,128,1.0)"),s.addColorStop(o+.04,"rgba(255,255,255,0.6)"),s.addColorStop(o+.03,"rgba(255,255,255,0.8)"),s.addColorStop(o+.025,"rgba(255,255,255,0.8)"),s.addColorStop(o+.005,"rgba(255,255,255,0.5)"),s.addColorStop(0,"rgba(255,255,255,0.01)"),h.fillStyle=s,h.globalCompositeOperation="luminosity",h.fillRect(0,0,t,e),h.globalCompositeOperation="source-in",r(h,0,0,t,e,6),Object(c.canvasRGBA)(h.canvas,0,0,t,e,4)}function r(t,e,n,i,s,o=1){let r,c=t.getImageData(e,n,i,s),l=c.data;for(let t=0,e=l.length;t<e;t+=4)r=~~(Math.random()*o*2-o),l[t]=Object(a.clamp)(l[t]+r,0,255),r=~~(Math.random()*o*2-o),l[t+1]=Object(a.clamp)(l[t+1]+r,0,255),r=~~(Math.random()*o*2-o),l[t+2]=Object(a.clamp)(l[t+2]+r,0,255);h.putImageData(c,e,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){d=t.props,l=t.buffersByLabel.bokehBack,h=l.context,u=t.buffersByLabel.bokehFront,f=u.context;let e=l.width+l.height,n=u.width,s=u.height;m.length=0;for(var r=0;r<Math.floor(.01*(n+s));r++)m.push({radius:i(.005*e,.02*e),x:i(0,n),y:i(0,s),angle:i(0,p),vel:i(.05,.2),tick:i(0,1e4)});o(),d.events.on("resize",o)},e.generateBackground=o,e.draw=function(){var t=m.length;let e=u.width,n=u.height;for(f.fillStyle="rgba(0,0,0,0)",f.globalCompositeOperation="source-over",f.clearRect(0,0,e,n),f.shadowBlur=15,f.shadowColor="#fff";t--;){var o=m[t];o.x+=Math.cos(o.angle)*o.vel,o.y+=Math.sin(o.angle)*o.vel,o.angle+=i(-.05,.05),f.beginPath(),f.arc(o.x,o.y,o.radius,0,p),f.fillStyle=s(0,0,100,.03+.01*Math.cos(.02*o.tick)),f.fill(),o.x-o.radius>e&&(o.x=-o.radius),o.x+o.radius<0&&(o.x=e+o.radius),o.y-o.radius>n&&(o.y=-o.radius),o.y+o.radius<0&&(o.y=n+o.radius),o.tick++}};var a=n(2),c=n(39);n.n(c);let l,u,h,f,d,p=2*Math.PI,m=[],g=["rgba(255,64,64,1.0)","rgba(64,255,64,1.0)","rgba(64,64,225,1.0)"];Object(a.shuffle)(g);let b=["rgba(255,64,64,0.8)","rgba(64,255,64,0.8)","rgba(64,64,225,0.8)"];Object(a.shuffle)(b)},function(t,e){function n(t,e,n,i,s){if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLCanvasElement&&!t instanceof HTMLCanvasElement)return;var o,r=t.getContext("2d");try{try{o=r.getImageData(e,n,i,s)}catch(t){throw new Error("unable to access local image data: "+t)}}catch(t){throw new Error("unable to access image data: "+t)}return o}function i(t,e,i,o,r,a){if(!(isNaN(a)||a<1)){a|=0;var c=n(t,e,i,o,r);c=s(c,e,i,o,r,a),t.getContext("2d").putImageData(c,e,i)}}function s(t,e,n,i,s,o){var r,u,h,f,d,p,m,g,b,w,O,v,y,_,E,C,S,R,M,A,x,L,j,T,P=t.data,I=o+o+1,k=i-1,z=s-1,D=o+1,G=D*(D+1)/2,B=new a,N=B;for(h=1;h<I;h++)if(N=N.next=new a,h==D)var F=N;N.next=B;var H=null,U=null;m=p=0;var q=c[o],V=l[o];for(u=0;u<s;u++){for(C=S=R=M=g=b=w=O=0,v=D*(A=P[p]),y=D*(x=P[p+1]),_=D*(L=P[p+2]),E=D*(j=P[p+3]),g+=G*A,b+=G*x,w+=G*L,O+=G*j,N=B,h=0;h<D;h++)N.r=A,N.g=x,N.b=L,N.a=j,N=N.next;for(h=1;h<D;h++)f=p+((k<h?k:h)<<2),g+=(N.r=A=P[f])*(T=D-h),b+=(N.g=x=P[f+1])*T,w+=(N.b=L=P[f+2])*T,O+=(N.a=j=P[f+3])*T,C+=A,S+=x,R+=L,M+=j,N=N.next;for(H=B,U=F,r=0;r<i;r++)P[p+3]=j=O*q>>V,0!=j?(j=255/j,P[p]=(g*q>>V)*j,P[p+1]=(b*q>>V)*j,P[p+2]=(w*q>>V)*j):P[p]=P[p+1]=P[p+2]=0,g-=v,b-=y,w-=_,O-=E,v-=H.r,y-=H.g,_-=H.b,E-=H.a,f=m+((f=r+o+1)<k?f:k)<<2,g+=C+=H.r=P[f],b+=S+=H.g=P[f+1],w+=R+=H.b=P[f+2],O+=M+=H.a=P[f+3],H=H.next,v+=A=U.r,y+=x=U.g,_+=L=U.b,E+=j=U.a,C-=A,S-=x,R-=L,M-=j,U=U.next,p+=4;m+=i}for(r=0;r<i;r++){for(S=R=M=C=b=w=O=g=0,v=D*(A=P[p=r<<2]),y=D*(x=P[p+1]),_=D*(L=P[p+2]),E=D*(j=P[p+3]),g+=G*A,b+=G*x,w+=G*L,O+=G*j,N=B,h=0;h<D;h++)N.r=A,N.g=x,N.b=L,N.a=j,N=N.next;for(d=i,h=1;h<=o;h++)p=d+r<<2,g+=(N.r=A=P[p])*(T=D-h),b+=(N.g=x=P[p+1])*T,w+=(N.b=L=P[p+2])*T,O+=(N.a=j=P[p+3])*T,C+=A,S+=x,R+=L,M+=j,N=N.next,h<z&&(d+=i);for(p=r,H=B,U=F,u=0;u<s;u++)P[(f=p<<2)+3]=j=O*q>>V,j>0?(j=255/j,P[f]=(g*q>>V)*j,P[f+1]=(b*q>>V)*j,P[f+2]=(w*q>>V)*j):P[f]=P[f+1]=P[f+2]=0,g-=v,b-=y,w-=_,O-=E,v-=H.r,y-=H.g,_-=H.b,E-=H.a,f=r+((f=u+D)<z?f:z)*i<<2,g+=C+=H.r=P[f],b+=S+=H.g=P[f+1],w+=R+=H.b=P[f+2],O+=M+=H.a=P[f+3],H=H.next,v+=A=U.r,y+=x=U.g,_+=L=U.b,E+=j=U.a,C-=A,S-=x,R-=L,M-=j,U=U.next,p+=i}return t}function o(t,e,i,s,o,a){if(!(isNaN(a)||a<1)){a|=0;var c=n(t,e,i,s,o);c=r(c,e,i,s,o,a),t.getContext("2d").putImageData(c,e,i)}}function r(t,e,n,i,s,o){var r,u,h,f,d,p,m,g,b,w,O,v,y,_,E,C,S,R,M,A,x=t.data,L=o+o+1,j=i-1,T=s-1,P=o+1,I=P*(P+1)/2,k=new a,z=k;for(h=1;h<L;h++)if(z=z.next=new a,h==P)var D=z;z.next=k;var G=null,B=null;m=p=0;var N=c[o],F=l[o];for(u=0;u<s;u++){for(_=E=C=g=b=w=0,O=P*(S=x[p]),v=P*(R=x[p+1]),y=P*(M=x[p+2]),g+=I*S,b+=I*R,w+=I*M,z=k,h=0;h<P;h++)z.r=S,z.g=R,z.b=M,z=z.next;for(h=1;h<P;h++)f=p+((j<h?j:h)<<2),g+=(z.r=S=x[f])*(A=P-h),b+=(z.g=R=x[f+1])*A,w+=(z.b=M=x[f+2])*A,_+=S,E+=R,C+=M,z=z.next;for(G=k,B=D,r=0;r<i;r++)x[p]=g*N>>F,x[p+1]=b*N>>F,x[p+2]=w*N>>F,g-=O,b-=v,w-=y,O-=G.r,v-=G.g,y-=G.b,f=m+((f=r+o+1)<j?f:j)<<2,g+=_+=G.r=x[f],b+=E+=G.g=x[f+1],w+=C+=G.b=x[f+2],G=G.next,O+=S=B.r,v+=R=B.g,y+=M=B.b,_-=S,E-=R,C-=M,B=B.next,p+=4;m+=i}for(r=0;r<i;r++){for(E=C=_=b=w=g=0,O=P*(S=x[p=r<<2]),v=P*(R=x[p+1]),y=P*(M=x[p+2]),g+=I*S,b+=I*R,w+=I*M,z=k,h=0;h<P;h++)z.r=S,z.g=R,z.b=M,z=z.next;for(d=i,h=1;h<=o;h++)p=d+r<<2,g+=(z.r=S=x[p])*(A=P-h),b+=(z.g=R=x[p+1])*A,w+=(z.b=M=x[p+2])*A,_+=S,E+=R,C+=M,z=z.next,h<T&&(d+=i);for(p=r,G=k,B=D,u=0;u<s;u++)x[f=p<<2]=g*N>>F,x[f+1]=b*N>>F,x[f+2]=w*N>>F,g-=O,b-=v,w-=y,O-=G.r,v-=G.g,y-=G.b,f=r+((f=u+P)<T?f:T)*i<<2,g+=_+=G.r=x[f],b+=E+=G.g=x[f+1],w+=C+=G.b=x[f+2],G=G.next,O+=S=B.r,v+=R=B.g,y+=M=B.b,_-=S,E-=R,C-=M,B=B.next,p+=i}return t}function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],l=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];t.exports={image:function(t,e,n,s){if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLImageElement&&!t instanceof HTMLImageElement)return;var r=t.naturalWidth,a=t.naturalHeight;if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLCanvasElement&&!e instanceof HTMLCanvasElement)return;e.style.width=r+"px",e.style.height=a+"px",e.width=r,e.height=a;var c=e.getContext("2d");c.clearRect(0,0,r,a),c.drawImage(t,0,0),isNaN(n)||n<1||(s?i(e,0,0,r,a,n):o(e,0,0,r,a,n))},canvasRGBA:i,canvasRGB:o,imageDataRGBA:s,imageDataRGB:r}},function(t,e,n){"use strict";function i(){let t,e,{width:n,height:i,minDimension:s,orientation:o}=x;E.width=C.width=s,E.height=C.height=s,o?(t=0,e=(i-n)/2):(t=(n-i)/2,e=0),E.offsetX=C.offsetX=t,E.offsetY=C.offsetY=e}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),o=n(14),r=n(0),a=n(3),c=n(2),l=n(6),u=n(7),h=n(16);const{vec2:f,lerp:d}=s.b,{mut_plus:p}=s.a;let{min:m,cos:g,sin:b,sqrt:w,tan:O,round:v,PI:y}=Math;const _=r.TARGET_FPS;let E,C,S,R,M,A,x;const L=function(){let t=f(),e=f(),n=f(),i=f(),s=f(),o=f(),r=0,a=0,l=0,u=0,h=0,m=0,w=0,y=0,_=0,C=0,S=0,R=0,A=0,x=0;return function(f,L,j,T,P,I=4,k=0){h=.9,_=.7,C=.9,l=.57121,y=.71213,d(L,j,u=.6,t),d(L,j,_,e),d(L,j,h,n),d(L,j,C,i),p(Object(c.rotate)(t,n,O(g((M+k)*l)),s),t),p(Object(c.rotate)(e,i,O(b((M+k)*y)),o),e),S=L[0],R=L[1],A=j[0],x=j[1],r=s[0],a=s[1],m=o[0],w=o[1],E.width>E.height?(S=S,A=A,r=r,m=m):(R=R,x=x,a=a,w=w),f.beginPath(),f.moveTo(S,R),f.bezierCurveTo(r,a,m,w,A,x),f.strokeStyle=T,f.lineWidth=v(g((M+k)*l)*I),f.lineCap="round",f.stroke(),f.closePath(),f.beginPath(),f.moveTo(S,R),f.bezierCurveTo(r,a,m,w,A,x),f.strokeStyle=P,f.lineWidth=v(g((M+k)*l)*~~(I/4)),f.lineCap="round",f.stroke(),f.closePath()}}(),j=function(){let t,e=0,n=0,i=0,s=0,r=0,c=f(),u=f(),d=0,p=0,m=0,O=0,v=0,y=0,E=0;return function(f){S.globalCompositeOperation="lighter",y=Object(l.screenSpace)(f.pos[0]),E=Object(l.screenSpace)(f.pos[1]),({pulse:e,pregnant:n,injured:i,lastMeal:s}=f),r=f.size*x.minDimension,n?(d=r*g(.2*(M+e))*(w(n)+1),p=r*b(.2*(M+e+_))*(w(n)+1)*.1):i?(d=r*g((M+e)*(1-1/i+.2)),p=r*b(.2*(M+e+_))*.1):(d=r*g(.2*(M+e)),p=r*b(.2*(M+e+_))*.1),m=.5*d,O=.5*p,v=o.util.colorIndex(f.color[a.COLOR_R],f.color[a.COLOR_G],f.color[a.COLOR_B]),t=o.motes.get(v),S.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,y-m,E-m,d,d),t=o.motes.getCenter(),S.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,y-m,E-m,d,d),f.target&&f.action==h.a&&(c[0]=y,c[1]=E,u[0]=Object(l.screenSpace)(f.target.pos[0]),u[1]=Object(l.screenSpace)(f.target.pos[1]),L(S,c,u,o.motes.getColorString(v),"white",5,e))}}(),T=function(){let t,e=0,n=0,i=0,s=0,a=0,c=0;return function(u){Object(l.updateCompositeOperation)(S,"lighter"),i=Object(l.screenSpace)(u.pos[0]),s=Object(l.screenSpace)(u.pos[1]),t=o.photons.get(u.color),a=r.PHOTON_BASE_SIZE*x.minDimension,c=u.pulse,e=.75*a*(g(.3*(M+c))*b(.1*(M+c)))+.25*a,n=.5*e,S.drawImage(t.canvas,0,0,t.pixelSize,t.pixelSize,i-n,s-n,e,e)}}(),P=function(){let t,e=0,n=0,i=0,s=0,r=0;return function(a){Object(l.updateCompositeOperation)(S,"lighter"),i=Object(l.screenSpace)(a.pos[0]),s=Object(l.screenSpace)(a.pos[1]),t=o.markers.get(),r=.5*Math.pow(100-a.mass,1.5),n=.5*(e=r),S.drawImage(t.canvas,0,0,t.pixelSize,t.pixelSize,i-n,s-n,e,e),e=r*g(10*M),n=.5*e,S.drawImage(t.canvas,0,0,t.pixelSize,t.pixelSize,i-n,s-n,e,e)}}(),I=function(){let t,e=0,n=0,i=0,s=0,r=0,c=0,u=0,h=0,f=0;return function(d){switch(i=Object(l.screenSpace)(d.pos[0]),s=Object(l.screenSpace)(d.pos[1]),e=d.size*x.minDimension*1+b(.2*M),n=.5*e,t=o.voids.get(),Object(l.updateCompositeOperation)(R,"source-over"),R.drawImage(t.canvas,i-n,s-n,e,e),d.lastMeal){case-1:f=2184;break;case a.COLOR_R:f=3908;break;case a.COLOR_G:f=1268;break;case a.COLOR_B:f=1103}h=.5*(u=1.7*e),r=b(.0127*M)*e*.1,c=g(.0127*M)*e*.1,t=o.motes.get(4095),Object(l.updateCompositeOperation)(R,"soft-light"),R.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-h,s+c-h,u,u),h=.5*(u=1.2*e),r=g(.023*M)*e*.13,c=b(.023*M)*e*.13,t=o.motes.get(f),R.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-h,s+c-h,u,u),t=o.motes.get(0),h=.5*(u=1.65*e),r=b(.0122*M)*e*.15,c=g(.0122*M)*e*.15,Object(l.updateCompositeOperation)(R,"multiply"),R.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-h,s+c-h,u,u)}}(),k=function(){let t,e=0,n=0,i=0,s=0,r=0,a=0,c=0,u=0;return function(h){Object(l.updateCompositeOperation)(S,"lighter"),i=Object(l.screenSpace)(h.pos[0]),s=Object(l.screenSpace)(h.pos[1]),e=h.size*x.minDimension,n=.5*e,t=o.emitters.get(),S.drawImage(t.canvas,i-n,s-n,e,e),c=g(.2*M)*e*1.7,u=.5*c,t=o.motes.get(819),S.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i-u,s-u,c,c);try{u=.5*(c=1.3*e),r=b(.08*M)*e*(.1-.1*h.ratios[0]),a=g(.08*M)*e*(.1-.1*h.ratios[0]),t=o.motes.get(15.9*h.ratios[0]<<8),S.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-u,s+a-u,c,c),u=.5*(c=1.3*e),r=b(.08*M+2.094394)*e*(.1-.1*h.ratios[1]),a=g(.08*M+2.094394)*e*(.1-.1*h.ratios[1]),t=o.motes.get(15.9*h.ratios[1]<<4),S.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-u,s+a-u,c,c),u=.5*(c=1.3*e),r=b(.08*M+4.188789)*e*(.1-.1*h.ratios[2]),a=g(.08*M+4.188789)*e*(.1-.1*h.ratios[2]),t=o.motes.get(~~(15.9*h.ratios[2])),S.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-u,s+a-u,c,c)}catch(t){console.log(t.message)}}}(),z=function(){function t(t,e){p=b(.08*M+t)*O*e,w=g(.08*M+t)*O*e,s[0]=h+p,s[1]=d+w,L(R,i,s,a,c,r)}let e,n=0,i=f(),s=f(),r=4,a="rgba(0,0,0,0.3)",c="rgba(0,0,0,0.7)",u=y*(1/3),h=0,d=0,p=0,w=0,O=0,v=0;return function(s){Object(l.updateCompositeOperation)(R,"multiply"),h=Object(l.screenSpace)(s.pos[0]),d=Object(l.screenSpace)(s.pos[1]),n=s.size*x.minDimension,r=m(4,~~((O=n)/2)),v=.5*O,i[0]=h,i[1]=d,t(0,.5),t(2*u,.5),t(4*u,.5),t(u,.25),t(3*u,.25),t(5*u,.25),e=o.motes.get(0),R.drawImage(e.canvas,e.sx,e.sy,e.sw,e.sh,h-v,d-v,O,O)}}();e.init=function(t){x=t.props,A=t.timing,E=t.buffersByLabel.entitiesLight,C=t.buffersByLabel.entitiesDark,S=E.context,R=C.context,i(),x.events.on("resize",i),o.init(x)};const D=function(){let t,e,n,i,s;return function(r){Object(l.updateCompositeOperation)(S,"destination-out"),S.fillStyle="rgba(0,0,0,0.2)",S.fillRect(0,0,E.width,E.height),Object(l.updateCompositeOperation)(R,"destination-out"),R.fillStyle="rgba(0,0,0,0.1)",R.clearRect(0,0,C.width,C.height),M=A.frameCount;let c=o.ui.get("mask");for(a.forEach(T),t=0,e=r.entities.length;t<e;++t)n=r.entities[t],i=Object(l.screenSpace)(n.pos[0]),s=Object(l.screenSpace)(n.pos[1]),Object(l.offscreen)(i,s)||(n instanceof u.Mote?j(n):n instanceof u.Photon?T(n):n instanceof u.Void?I(n):n instanceof u.Emitter?k(n):n instanceof u.AntiGravitonCluster?z(n):n instanceof u.Ripple&&P(n));Object(l.updateCompositeOperation)(S,"destination-out"),S.drawImage(c.canvas,0,0,x.minDimension,x.minDimension),Object(l.updateCompositeOperation)(R,"destination-out"),R.drawImage(c.canvas,0,0,x.minDimension,x.minDimension)}}();e.draw=D},function(t,e,n){"use strict";function i(t){h=t.minDimension,f=4*m.MOTE_BASE_SIZE,d=Object(g.scaleSprite)(h,f),function(){(o=document.createElement("canvas")).width=o.height=d;let t=(c=o.getContext("2d")).createRadialGradient(d/2,d/2,d/2,d/2,d/2,0);t.addColorStop(1,"rgba(255,255,255,1.0"),t.addColorStop(.8,"rgba(255,255,255,0.5)"),t.addColorStop(.1,"rgba(255,255,255,0.0)"),c.fillStyle=t,c.fillRect(0,0,d,d)}(),function(){let t=d,e=d,n=document.createElement("canvas");n.width=t,n.height=e;let i=n.getContext("2d");i.globalCompositeOperation="copy",i.drawImage(o,0,0,t,e),i.globalCompositeOperation="source-in",i.fillStyle="rgba(255,255,255,0.15)",i.fillRect(0,0,t,e),r={canvas:n,context:i,pixelSize:d,sw:d,sh:d,sx:0,sy:0}}(),function(){(l=document.createElement("canvas")).width=l.height=d,u=l.getContext("2d"),(p=document.createElement("canvas")).width=p.height=64*d,a=p.getContext("2d"),s=Array(4096);for(let t=0;t<4096;++t)v[t]="rgb("+((t&b)>>4)+","+(t&w)+","+((t&O)<<4)+")",s[t]=function(t,e){let n=d,i=d,s=t%64,r=s*d,c=(t-s)/64*d;return u.globalCompositeOperation="copy",u.drawImage(o,0,0,n,i),u.globalCompositeOperation="source-in",u.fillStyle=e,u.fillRect(0,0,n,i),a.drawImage(l,c,r,n,i),{canvas:p,context:a,pixelSize:d,sw:d,sh:d,sx:c,sy:r}}(t,v[t])}()}Object.defineProperty(e,"__esModule",{value:!0}),e.getColorString=function(t){return v[t]},e.get=function(t){return s[t]},e.getCenter=function(){return r},e.init=i;var s,o,r,a,c,l,u,h,f,d,p,m=n(0),g=n(4);const b=3840,w=240,O=15,v=Array(4096)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){let e=Object(s.scaleSprite)(t.minDimension,1),n=document.createElement("canvas");n.width=n.height=e;let o=n.getContext("2d"),r=o.createRadialGradient(e/2,e/2,e/2,e/2,e/2,0);r.addColorStop(1,"rgba(255,255,255,0.3)"),r.addColorStop(.78,"rgba(255,255,255,0.3)"),r.addColorStop(.58,"rgba(255,255,255,0.22)"),r.addColorStop(.48,"rgba(255,255,255,0.17)"),r.addColorStop(.44,"rgba(255,255,255,0.22)"),r.addColorStop(.4,"rgba(255,255,255,0.19)"),r.addColorStop(.2,"rgba(255,255,255,0.09)"),r.addColorStop(.1,"rgba(255,255,255,0.0)"),o.fillStyle=r,o.fillRect(0,0,e,e),i={canvas:n,context:o,w:e,h:e,pixelSize:e}},e.get=function(){return i};var i,s=n(4)},function(t,e,n){"use strict";function i(t,e,n){let i=document.createElement("canvas");i.width=i.height=17;let s,o=i.getContext("2d");return(s=o.createRadialGradient(8,8,8,8,8,0)).addColorStop(.7,n),s.addColorStop(1,"white"),o.globalCompositeOperation="source-over",o.beginPath(),o.moveTo(8,0),o.quadraticCurveTo(8,8,0,8),o.quadraticCurveTo(8,8,8,17),o.quadraticCurveTo(8,8,17,8),o.quadraticCurveTo(8,8,8,0),o.fillStyle=s,o.fill(),o.closePath(),o.beginPath(),o.moveTo(8,4),o.lineTo(8,13),o.moveTo(4,8),o.lineTo(13,8),o.strokeStyle="white",o.lineWidth=1,o.stroke(),o.closePath(),{canvas:i,context:o,pixelSize:17,w:17,h:17}}Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){r[o.COLOR_R]=i(t.minDimension,s.PHOTON_BASE_SIZE,"red"),r[o.COLOR_G]=i(t.minDimension,s.PHOTON_BASE_SIZE,"green"),r[o.COLOR_B]=i(t.minDimension,s.PHOTON_BASE_SIZE,"blue")},e.get=function(t){return r[t]};var s=n(0),o=n(3);const r=Array(3)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){let e=Object(s.scaleSprite)(t.minDimension,1),n=document.createElement("canvas");n.width=n.height=e;let o=n.getContext("2d"),r=o.createRadialGradient(e/2,e/2,e/2,e/2,e/2,0);r.addColorStop(1,"rgba(0,0,0,1.0)"),r.addColorStop(.5,"rgba(0,0,0,1.0)"),r.addColorStop(.479,"rgba(0,0,0,0.99)"),r.addColorStop(.442,"rgba(0,0,0,0.98)"),r.addColorStop(.44,"rgba(255,255,255,0.95)"),r.addColorStop(.43,"rgba(255,255,255,0.95)"),r.addColorStop(.41,"rgba(255,255,255,0.39)"),r.addColorStop(.37,"rgba(255,255,255,0.29)"),r.addColorStop(.36,"rgba(255,255,255,0.32)"),r.addColorStop(.34,"rgba(255,255,255,0.31)"),r.addColorStop(.3,"rgba(255,255,255,0.35)"),r.addColorStop(.28,"rgba(255,255,255,0.39)"),r.addColorStop(.26,"rgba(255,255,255,0.35)"),r.addColorStop(.23,"rgba(255,255,255,0.30)"),r.addColorStop(.21,"rgba(255,255,255,0.26)"),r.addColorStop(.2,"rgba(255,255,255,0.31)"),r.addColorStop(.19,"rgba(255,255,255,0.34)"),r.addColorStop(.17,"rgba(255,255,255,0.29)"),r.addColorStop(.16,"rgba(255,255,255,0.21)"),r.addColorStop(.15,"rgba(255,255,255,0.19)"),r.addColorStop(.14,"rgba(255,255,255,0.15)"),r.addColorStop(.1,"rgba(255,255,255,0.09)"),r.addColorStop(.09,"rgba(255,255,255,0.15)"),r.addColorStop(.07,"rgba(255,255,255,0.12)"),r.addColorStop(.05,"rgba(255,255,255,0.09)"),r.addColorStop(0,"rgba(0,0,0,0.0)"),o.fillStyle=r,o.fillRect(0,0,e,e),i={canvas:n,context:o,w:e,h:e,pixelSize:e}},e.get=function(){return i};var i,s=n(4)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){let e=Object(s.scaleSprite)(t.minDimension,1),n=~~(e/2),o=document.createElement("canvas");o.width=o.height=e;let r=o.getContext("2d"),a=r.createRadialGradient(n,n,n,n,n,0);a.addColorStop(0,"rgba(255,255,255,0.0)"),a.addColorStop(.75,"rgba(255,255,255,0.0)"),a.addColorStop(.8,"rgba(255,255,255,0.007)"),a.addColorStop(.85,"rgba(255,255,255,0.007)"),a.addColorStop(.9,"rgba(255,255,255,0.0)"),r.fillStyle=a,r.fillRect(0,0,e,e),i={canvas:o,context:r,pixelSize:e,w:e,h:e}},e.get=function(){return i};var i,s=n(4)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get=function(t){return i[t]},e.init=function(t){let e=t.minDimension,n=document.createElement("canvas");n.width=n.height=e;let s=n.getContext("2d"),o=s.createRadialGradient(e/2,e/2,e/2,e/2,e/2,0);o.addColorStop(1,"rgba(0,0,0,0.0)"),o.addColorStop(.05,"rgba(0,0,0,0.0)"),o.addColorStop(0,"rgba(255,255,255,1.0)"),s.fillStyle=o,s.fillRect(0,0,e,e),i.mask={canvas:n,context:s,w:e,h:e,pixelSize:e}};var i={mask:void 0}},function(t,e,n){"use strict";function i(t=l(),e=l(),n=1,i,s=u(1,1,1)){return this.pos=l(t),this.vel=l(e),this.ratios=Object(r.norm_ratio)(s),this.birthMass=n,this.mass=1,this.initialMass=n,this.arms=i||b(m()*m()*50),this.size=0,this.next=~~(3*m()),this}e.a=i;var s=n(1),o=n(0),r=n(2),a=n(3),c=n(17);let{vec2:l,vec3:u,times:h,mut_times:f,distance:d}=s.b,{mut_plus:p}=s.a,{random:m,sqrt:g,ceil:b,min:w,PI:O}=Math;const v=l(0,0);let y,_=l(),E=0,C=0,S=0,R=0,M=0,A=0,x=0;i.prototype.tick=function(t,e,n){if(this.birthMass>0&&(x=w(this.birthMass,b(this.mass/100)),this.birthMass-=x,this.mass+=x),this.size=g(this.mass/O)*o.EMITTER_SIZE,0===this.birthMass&&(E=this.initialMass/20,S=b(o.TARGET_FPS/E),C=E/o.TARGET_FPS,n%S==0))for(;C-- >0&&this.mass>0;)this.mass--,this.emitPhoton();for(p(this.pos,h(this.vel,e,_)),p(this.vel,Object(r.drag)(this.vel,o.GLOBAL_DRAG)),p(this.vel,Object(r.avoid)(this.vel,this.pos,v,1.3,.001,_)),a.forEach(t=>{p(t.vel,f(Object(r.gravitate)(t.pos,this.pos,-this.mass*t.mass,_),1/t.mass))}),R=0,M=t.length;R<M;++R)(y=t[R])!==this&&(A=d(this.pos,y.pos),y instanceof i?p(y.vel,f(Object(r.gravitate)(y.pos,this.pos,this.mass*y.mass,_),1/y.mass)):y instanceof c.a||p(y.vel,f(Object(r.gravitate)(y.pos,this.pos,-this.mass*y.mass,_),1/y.mass)))},i.prototype.emitPhoton=function(){let t=l(),e=l(),n=0,i=0,s=0;return function(){s=this.next,t[0]=this.size/5,t[1]=this.size/5,p(t,this.pos),i=this.mass%this.initialMass,n=i/(this.initialMass/2),n+=i%this.arms*(2/this.arms),p(Object(r.rotate)(t,this.pos,n,t),this.pos),this.next=function(t){let e=m();return e<t[0]?0:e<t[0]+t[1]?1:2}(this.ratios),a.create(t,e,s)}}()},function(t,e,n){"use strict";function i(t,e,n=s.TARGET_FPS){this.type=t,this.pos=o.b.vec2(e),this.start=n,this.lifetime=n}e.a=i;var s=n(0),o=n(1);i.prototype.tick=function(){this.lifetime--}},function(t,e,n){"use strict";function i(t=l(),e=l(),n=1){return this.pos=l(t),this.vel=l(e),this.size=0,this.birthMass=this.initialMass=n,this.mass=1,this.instability=0,this.size=0,this}e.a=i;var s=n(1),o=n(2),r=n(7),a=n(3),c=n(0);const{vec2:l,times:u,distance:h,mut_copy:f}=s.b,{mut_plus:d}=s.a,{random:p,sqrt:m,PI:g,ceil:b,min:w,max:O}=Math,v=l(0,0);let y,_=l(),E=0,C=0,S=0,R=0;i.prototype.tick=function(t,e,n){if(this.birthMass>0&&(R=w(this.birthMass,b(this.mass/10)),this.birthMass-=R,this.mass+=R),this.size=m(.05*this.mass/g)*c.MOTE_BASE_SIZE,d(this.pos,u(this.vel,e,_)),this.initialMass=O(this.mass,this.initialMass),d(this.vel,Object(o.avoid)(this.vel,this.pos,v,1.3,.01,_)),d(this.vel,Object(o.drag)(this.vel,c.GLOBAL_DRAG)),0===this.birthMass&&(this.instability+=.003*this.mass),n%b(.05*c.TARGET_FPS)==0)for(;this.instability>0&&this.mass>0;)t.push(this.emitPhoton()),this.mass-=w(this.mass,7),this.instability-=.9;for(E=0,C=t.length;E<C;++E)if((y=t[E])!==this&&(S=h(this.pos,y.pos),y instanceof r.Void))return S<.5*(y.size+this.size)&&(R=w(y.mass,b((y.mass+y.birthMass)/10)),this.mass+=R,y.mass-=R,this.instability+=.07*R),void(S<10*this.size&&d(this.vel,Object(o.accelerate)(this.pos,y.pos,this.size*S*5,_)))},i.prototype.emitPhoton=function(){let t=l(),e=l(),n=l(),i=0,s=0,r=0;return function(){return r=~~(3*p()),t[0]=.1*this.size,t[1]=.1*this.size,d(t,this.pos),f(e,this.vel),s=this.mass%this.initialMass,i=s/(this.initialMass/2),i+=s%100*.02,f(n,Object(o.rotate)(t,this.pos,i,t)),d(n,this.pos),d(t,n),d(e,Object(o.accelerate)(this.pos,t,2*this.size,_)),a.create(t,e,r)}}()},function(t,e,n){"use strict";function i(t){let e,n,i,s=h.width,r=h.height,a=!0,c=90,u=Date.now();if(t.started<0||t.started>u-1e3){for(i="rgba(255,255,255,"+(e=(1e3-(n=t.started>0?u-t.started:0))/1e3)+")";a;)try{l.font=c+"px RightBankFLF",l.fillStyle=i,o(l,"PHOTONOMIX",s/2,r/2+c/2),a=!1}catch(t){a=!0,c-=10}l.font=c/3+"px RightBankFLF",l.fillStyle=i,o(l,"click to start",s/2,r/2+c)}}function s(t){let e=h.width,n=h.height;l.clearRect(0,0,e,n),a.DEBUG&&f(),i(t),function(){let t=c.b.getCursorPosition();Object(r.drawCircle)(l,t[0],t[1],5,"white")}()}function o(t,e,n,i){let s=t.measureText(e);if(s.width>h.width)throw new Error("text is wider than body");t.fillText(e,n-s.width/2,i)}Object.defineProperty(e,"__esModule",{value:!0}),e.drawUIText=i,e.draw=s,e.writeCentered=o,e.init=function(t){h=t.props,u=t.buffersByLabel.ui,l=u.context};var r=n(6),a=n(0),c=n(5);let l,u,h;const f=function(){let t,e,n,i;return function(){t=h.width,e=h.height,n=t/2,i=e/2,Object(r.drawCircle)(l,0,0,4,"yellow",1,"white"),Object(r.drawCircle)(l,n,0,4,"orange",1,"white"),Object(r.drawCircle)(l,t,0,4,"red",1,"white"),Object(r.drawCircle)(l,0,i,4,"white",1,"white"),Object(r.drawCircle)(l,n,i,4,"gray",1,"white"),Object(r.drawCircle)(l,t,i,4,"black",1,"white"),Object(r.drawCircle)(l,0,e,4,"blue",1,"white"),Object(r.drawCircle)(l,n,e,4,"cyan",1,"white"),Object(r.drawCircle)(l,t,e,4,"green",1,"white")}}()}]);
//# sourceMappingURL=photonomix.js.map