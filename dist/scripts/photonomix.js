!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=17)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.TARGET_FPS=30;e.WEIGHT_PRED_R=1.3;e.WEIGHT_PRED_G=.7;e.WEIGHT_PRED_B=1;e.START_POP=50;e.MOTE_BASE_SIZE=.015;e.MOTE_BASE_ALPHA=1;e.MOTE_BASE_SPEED=5e-4;e.MOTE_BASE_SIGHT=.15;e.PREGNANT_THRESHOLD=172;e.PREGNANT_TIME=30;e.DEATH_THRESHOLD=18;e.GRAVITY=6.67408e-8;e.GLOBAL_DRAG=.1;e.PHOTON_BASE_SIZE=.015;e.PHOTON_LIFETIME=300;e.MARKER_HIT_LIFETIME=30;e.MARKER_HIT_SIZE=.1;e.VOID_SIZE=.01;e.EMITTER_SIZE=.01;e.MAX_MOTES=300;e.MAX_PHOTONS=25800;e.MAX_VOIDS=5;e.MAX_EMITTERS=5;e.MAX_ENTITIES=26110;e.POSITIVE_ENERGY=.01;e.NEGATIVE_ENERGY=.01;e.DEBUG=!1;e.VALIDATE_VECTORS=!0;let i;const o=i="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;e.BUFFER_TYPE=o},function(t,e,n){"use strict";var i=n(26);n.d(e,"a",function(){return i.a}),n.d(e,"b",function(){return i.b})},function(t,e,n){"use strict";function i(t){return t+1e-11*s()}function o(t,e=0,n=1/0){return w(t)<w(e)?t=t<0?-e:e:w(t)>w(n)&&(t=t<0?-n:n),t}function s(){return _()>.5?1:-1}function r(t,e){return t/(w(t)+w(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.twiddle=i,e.logisticSmooth=function(t,e,n=2*t,i=1){return n/(1+y(v,i*t-e))},e.adjRand=function(t=1){return(2*_()-1)*t},e.posneg=s,e.clamp=function(t,e,n){return C(M(t,n),e)},e.ratio=r,e.rat_vec2=function(t){return r(t[x],t[A])},e.norm_ratio=function(t,e){let n=0,i=t.length;e=e||new Float32Array(i);let o=t.reduce((t,e)=>t+e,0);for(;n<i;++n)e[n]=0!==t[n]?t[n]/o:0;return e},e.evenNumber=function(t){return t>>1<<1};var a=n(1),c=n(0);const{vec2:l,magnitude:u,mut_normalize:h,distance:f,mut_times:d,mut_copy:p,mut_clamp:m}=a.b,{minus:g}=a.a,{sqrt:b,abs:w,E:v,pow:y,cos:E,sin:O,random:_,PI:S,max:C,min:M}=Math,x=0,A=1,j=function(){let t=0,e=0;return function(n){for(t=0,e=n.length;t<e;++t)n[t]=i(n[t]);return n}}();e.twiddleVec=j;const T=function(){let t,e;return function(n){for(t=0,e=n.length;t<e;t++){if(isNaN(n[t]))throw new Error("NaN vector");if(n[t]===1/0)throw new Error("Infinite vector");if(n[t]===-1/0)throw new Error("-Infinite vector")}}}();e.validate=T;const P=function(){let t=l();return function(e,n){return u(g(e,n,t))}}();e.dist=P;const I=function(){let t=0,e=0;return function(n,i=0,s=1/0){for(t=0,e=n.length;t<e;++t)n[t]=o(n[t],i,s)}}();e.limitVecMut=I;const k=function(){let t=l(),e=0,n=0,i=0,o=0;return function(s,r,a,l){if(l=l||t,g(s,r,l),e=u(l),n=l[0],i=l[1],0===n&&0===i||0===e)return l;if(o=m(1/b(n*n+i*i),1e-11,1e11),a=m(a,-1e11,1e11),l[0]=n*o,l[1]=i*o,d(l,-a*c.GRAVITY/(e*e)),c.VALIDATE_VECTORS)try{T(l)}catch(t){console.log("gravitation error",t),console.log(a),g(s,r,l),console.log("minus",l),I(l,1e-5,10),console.log("limit",l),e=u(l),console.log("magnitude",e),h(l),console.log("normalize",l),d(l,-a/(e*e)),console.log("scale",l),l.fill(0)}return l}}();e.gravitate=k;const R=function(){let t=l(),e=0,n=0,i=0;return function(o,s,r,a){if(a=a||t,g(o,s,a),n=a[0],i=a[1],0===n&&0===i)return a;if(e=m(1/b(n*n+i*i),1e-11,1e11),r=m(r,-1e11,1e11),a[0]=n*e,a[1]=i*e,d(a,-r),c.VALIDATE_VECTORS)try{T(a)}catch(t){console.log("acceleration error",t),console.log("strength",r),g(o,s,a),console.log("minus",a),h(a),console.log("normalize",a),d(a,-r),console.log("scale",a),a.fill(0)}return a}}();e.accelerate=R;const z=function(){let t=l(),e=0,n=0,i=0,s=0,r=0;return function(a,l,f){if(f=f||t,n=u(a),n=o(n,0,1e11),e=m(l*n*n,1e-11,1e11),p(f,a),s=f[0],r=f[1],0===s&&0===r||0===e)return f;if(i=m(1/b(s*s+r*r),1e-11,1e11),e=m(e,1e-11,1e11),f[0]=s*i,f[1]=r*i,d(f,-1),d(f,e),c.VALIDATE_VECTORS)try{T(f)}catch(t){console.log("drag error",t),console.log(l,n,e),console.log("magnitude",u(a)),p(f,a),console.log("copied",f),h(f),console.log("normalized",f),d(f,-1),console.log("inverted",f),d(f,e),console.log("scaled",f),f.fill(0)}return f}}();e.drag=z;const D=function(){let t=l(),e=0;return function(n,i,o,s,r,a){return e=f(i,o)*s,a=a||t,a[0]=0,a[1]=0,e>1&&R(i,o,r*e*e,a),a}}();e.avoid=D;const L=function(){let t=0,e=0;return function(n){for(t=0,e=n.length;t<e;++t)n[t]=w(n[t]);return n}}();e.absVec=L;const N=function(t,e){let n=t[0],i=t[1];return n>e||n<-e||(i>e||i<-e)};e.outOfBounds=N;const F=function(){let t=0,e=0,n=0,i=0,o=l(),s=l();return function(r,a,c,l){return l=l||o,t=E(c*S),e=O(c*S),g(r,a,s),n=s[x],i=s[A],l[x]=n*t-i*e,l[A]=n*e+i*t,l}}();e.rotate=F;const G=function(){let t=0,e=0;return function(n){for(t=n.length;t;t--)e=Math.floor(Math.random()*t),[n[t-1],n[e]]=[n[e],n[t-1]]}}();e.shuffle=G},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.scaleSprite=function(t,e){return~~(t*e)},e.colorIndex=function(t,e,n){return(t>>4<<8)+(e>>4<<4)+(n>>4)}},function(t,e,n){"use strict";function i(t,e,n){let i=y.buffer;this.offset=y.allocate(),this.pos=c(t[0],t[1],i,f+this.offset),this.vel=c(e[0],e[1],i,d+this.offset),this.intVals=new Uint8ClampedArray(i,p+this.offset,w),Object.defineProperties(this,{color:{get:()=>this.intVals[m],set:t=>this.intVals[m]=t},lifetime:{get:()=>this.intVals[g],set:t=>this.intVals[g]=t},mass:{get:()=>this.intVals[b],set:t=>this.intVals[b]=t}}),this.color=n,this.lifetime=a.PHOTON_LIFETIME,this.size=a.PHOTON_BASE_SIZE,this.mass=1,this.pulse=~~(a.TARGET_FPS*h())}e.d=i;var o=n(1),s=n(15),r=n(2),a=n(0);let{vec2:c,times:l}=o.b,{mut_plus:u}=o.a;const{random:h}=Math,f=0,d=8,p=d+8,m=0,g=m+1,b=g+1,w=b+1,v=p+w+(4-(p+w)%4);e.c=0,e.b=1,e.a=2;const y=new s.a(v,a.MAX_PHOTONS);i.prototype.tick=(()=>{let t,e,n=c();return function(i,o){this.lifetime>0&&this.lifetime--,t=this.pos,e=this.vel,u(t,l(e,o,n)),u(e,Object(r.drag)(e,a.GLOBAL_DRAG))}})(),i.prototype.destroy=function(){y.free(this.offset)}},function(t,e,n){"use strict";function i(t,e){C[t]=function(){return new(Function.prototype.bind.apply(e,arguments))}}function o(){return m.a.map("ripple","mouse0"),this.entities=[],this.photonBuffer=null,this.stats={pop:0,born:0,died:0,target:0},this.actions={},this.registerActions(),this.started=-1,this.clickCooldown=0,this}Object.defineProperty(e,"__esModule",{value:!0}),e.registerType=i,e.Game=o;var s=n(16),r=n(11),a=n(46),c=n(47),l=n(4),u=n(48),h=n(6),f=n(49);n.d(e,"Mote",function(){return s.b}),n.d(e,"Void",function(){return r.a}),n.d(e,"Emitter",function(){return a.a}),n.d(e,"Marker",function(){return c.a}),n.d(e,"Photon",function(){return l.d}),n.d(e,"AntiGravitonCluster",function(){return f.a}),n.d(e,"Ripple",function(){return u.a});var d=n(2),p=n(1),m=n(7),g=n(0);const{minus:b}=p.a,{vec2:w,vec3:v,mut_copy:y}=p.b,E=new Uint16Array(g.MAX_MOTES+g.MAX_PHOTONS+100);let{random:O}=Math,_=0,S=0;const C={},M=v();i("mote",s.b),i("void",r.a),i("emitter",a.a),i("marker",c.a),i("photon",l.d),i("ripple",u.a),i("antiGravitonCluster",f.a),C.randomMote=s.b.random,o.prototype.start=function(){for(let t=0;t<g.START_POP;++t)this.spawn("randomMote");this.started=Date.now()},o.prototype.tick=function(){let t,e,n=0,i=0,o=0,r=w();return function(a){0===this.clickCooldown?m.a.lookupMap("ripple").isDown()&&(Object(h.gameSpaceVec)(m.a.getCursorPosition(),r),this.spawn("ripple",r),this.clickCooldown=3):this.clickCooldown--;let c=a.interval/a.elapsed,f=a.frameCount;for(t=this.entities,this.stats.target=0,this.stats.pop=0,o=c/g.TARGET_FPS,n=0,i=t.length;n<i;++n)(e=t[n]).tick(this.entities,o,f),e instanceof s.b?(this.stats.pop++,e.target&&this.stats.target++,e.injured&&f%~~(.1*g.TARGET_FPS)==0&&this.entities.push(e.bleed()),e.dying===g.DEATH_THRESHOLD?(this.killMote(e),E[_]=n,this.stats.died++,_++):e.pregnant===g.PREGNANT_TIME&&(this.entities.push(e.split()),this.stats.born++)):e instanceof l.d?e.lifetime<=0&&(E[_]=n,M[e.color]++,_++):e instanceof u.a?(e.mass>250&&(this.spawn("void",e.pos,[0,0],100),e.mass=0),e.mass<=0&&(E[_]=n,_++)):e.mass<=0&&(E[_]=n,_++),Object(d.outOfBounds)(e.pos,20)&&(E[_]=n,_++);for(;_>0;)S=E[--_],(e=t[S])&&void 0!==e.pool&&e.destroy(),t.splice(S,1),E[_]=0}}(),o.prototype.emitPhoton=function(){let t=w(),e=w(),n=w(),i=0,o=w(.05,.05);return function(s,r,a,c=i,u=12){return s=s||[1.8*O()-.9,1.8*O()-.9],r?y(e,r):(y(e,o),Object(d.rotate)(e,n,i%u/(u/2),e)),a=a||~~(3*O()),y(t,s),this.entities.push(new l.d(t,e,a)),i++,a}}(),o.prototype.spawn=function(){let t=Array.prototype.slice.apply(arguments).shift();C[t]&&this.entities.push(C[t].apply(null,arguments))},o.prototype.killMote=function(){let t=0,e=0,n=0,i=w(),o=0,s=0,c=0;return function(l){if(O()<g.POSITIVE_ENERGY)this.entities.push(new a.a(l.pos,l.vel,~~(10*g.DEATH_THRESHOLD*O()),void 0,l.ratios));else if(O()<g.NEGATIVE_ENERGY)this.entities.push(new r.a(l.pos,l.vel,~~(10*g.DEATH_THRESHOLD*O())));else for(y(i,l.pos),o=l.photons[0],s=l.photons[1],c=l.photons[2],t=o+c+s,e=0,n=0;n<t;++n)o===n&&(e=1),o+s===n&&(e=2),this.emitPhoton(i,void 0,e,n,t)}}(),o.prototype.registerAction=function(t,e){this.actions[t]=e.bind(this)};let x=w();o.prototype.registerActions=function(){this.registerAction("launchAntiGravitonCluster",function(t){b(this.player.mouseUp,t,x),this.entities.push(new f.a(t,x,148))})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.updateCompositeOperation=function(t,e){t.globalCompositeOperation!==e&&(t.globalCompositeOperation=e)},e.screenSpace=function(t){return(t+1)/2*c.minDimension},e.screenSpaceVec=function(t,e){return e[0]=(t[0]+1)/2*c.minDimension,e[1]=(t[1]+1)/2*c.minDimension,e},e.gameSpaceVec=function(t,e){e[0]=t[0]/c.minDimension*2-1,e[1]=t[1]/c.minDimension*2-1},e.offscreen=function(t,e){return t<-.5*c.width||t>1.5*c.width||e<-.5*c.height||e>1.5*c.height},e.drawCircle=function(t,e,n,i,o,s=0,r){t.globalCompositeOperation="source-over",t.beginPath(),t.arc(e,n,i,2*Math.PI,!1),t.fillStyle=o,t.fill(),r&&(t.strokeStyle=r,t.lineWidth=s,t.stroke()),t.closePath()},e.tick=function(){l||(l=!0),i.draw(),o.draw(a),r.draw(a)},e.init=function(t,e){a=t.game,c=e.props,i.init(e),o.init(e),r.init(e)};var i=n(37),o=n(39),s=n(14),r=n(50);n.d(e,"bokeh",function(){return i}),n.d(e,"entities",function(){return o}),n.d(e,"sprites",function(){return s}),n.d(e,"ui",function(){return r});let a,c,l=!1},function(t,e,n){"use strict";var i=n(18),o=(n(21),n(29));n(12),n(33),n(8),n(34),n(35),n(36);n.d(e,"b",function(){return o}),n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function i(t,e,n){let i=e.indexOf(t);return-1!==i&&(n.push(e.splice(i,1)),!0)}function o(t){return-1===l.indexOf(t)&&-1===u.indexOf(t)?(d++,i(t,c,l)||l.push(t),fetch(f+t).then(function(t){return function(t,e){return new Promise((n,o)=>{if(e.ok){let o=e.headers.get("Content-type");return a.a(o)(e).then(e=>(function(t,e,n,o){let s=new function(t,e,n){return this.uri=t,this.content=e,this.type=n,this}(t,e,n);h[t]=s,d--,i(t,l,u),o(s)})(t,e,o,n))}o("failed to fetch asset "+t)})}.bind(null,t)}(t))):l.indexOf(t)>=0?new Promise(e=>{let n=0,i=setInterval(()=>{if(void 0!==h[t]?(e(h[t]),clearInterval(i)):n++,n>100)throw clearInterval(i),Error("stuck in fetching status way too long")},250)}):u.indexOf(t)>=0?Promise.resolve(h[t]):void 0}function s(t){let e=h[t];return void 0===e?o(t):Promise.resolve(e)}function r(t){-1===c.indexOf(t)&&-1===l.indexOf(t)&&void 0===h[t]&&c.push(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.requestAsset=s,e.requestAssetList=function(t){return Promise.all(t.map(t=>s(t)))},e.enqueueAsset=r,e.enqueueAssetList=function(t){t.forEach(t=>r(t))},e.processQueue=function(){return Promise.all(c.map(t=>o(t)))},e.setGlobalAssetPrefix=function(t){f=t};var a=n(23);const c=[],l=[],u=[],h={};let f="",d=0},function(t,e,n){"use strict";function i(t){if(0===t.length)return[[]];for(var e=[],n=0;n<t.length;n++)for(var o=t.slice(),s=o.splice(n,1),r=i(o),a=0;a<r.length;a++){var c=s.concat(r[a]);e.push(c)}return e}function o(t){return this[t]}function s(t,e){return t(e.map(t=>this[t]))}function r(t,e){return function(){let n=t.apply(null,[e].concat(Array.prototype.slice.apply(arguments)));if(!(n instanceof Float32Array))return n;switch(n.length){case 2:return g(m.vec2(n));case 3:return g(m.vec3(n));case 4:return g(m.vec4(n));default:return g(m(n.length,n))}}}function a(t,e,n){return t+n*(e-t)}function c(t,e,n,i,o,s,r,a){return t*o+e*s+n*r+i*a}function l(t){return D(t,t)}function u(t,e,n){return L(t,e,n,t)}function h(t,e,n,i,o){return N(t,e,n,i,o,t)}function f(t,e){return G(t,e,t)}function d(t,e,n){return q(t,e,n,t)}function p(t){let e=t.toArray().map(t=>t.toFixed(2));return"vec"+t.length+"("+e.join(", ")+")"}function m(){var t,e=arguments.length;if(0===e)throw new Error("vectors.create requires at least one argument");if(1===e)t=new Float32Array(arguments[0]);else{let e,n=Array.prototype.slice.apply(arguments),i=0,o=n.shift(),s=n.length;s>0&&n[s-1]instanceof ArrayBuffer?(i=0,e=n.pop()):s>1&&n[s-2]instanceof ArrayBuffer&&(i=n.pop(),e=n.pop()),t=void 0!==e?new Float32Array(e,i,o):new Float32Array(o),n.length>0&&t.set(O(n))}return t}function g(t){return b.wrap(t,t.length,1),t.toString=r(p,t),t.homogenous=r(R,t),t.times=r(G,t),t.lerp=r(L,t),t.cubic=r(N,t),t.dot=r(F,t),t.clamp=r(q,t),t.angle=B.bind(null,t),t.magnitude=z.bind(null,t),t.distance=H.bind(null,t),t.normalize=r(D,t),t.mut_normalize=r(l,t),t.mut_times=r(f,t),t.mut_lerp=r(u,t),t.mut_cubic=r(h,t),t.mut_clamp=r(d,t),t.mut_copy=r(k,t),2!==t.length&&3!==t.length||(t.cross=r(U,t)),function(t){let e,n,i;2===t.length?(n=T,i=x):3===t.length?(n=P,i=x.concat(A)):(n=I,i=x.concat(A,j));for(let e=0,i=n.length;e<i;++e){let i=o.bind(t,n[e].i);for(let o=0,s=n[e].names.length;o<s;++o)Object.defineProperty(t,n[e].names[o],{get:i})}for(let n=0,o=i.length;n<o;++n){switch(i[n].length){case 2:e=m.vec2;break;case 3:e=m.vec3;break;case 4:e=m.vec4}Object.defineProperty(t,i[n].join(""),{get:s.bind(t,e,i[n])})}}(t),t}Object.defineProperty(e,"__esModule",{value:!0}),e.mut_normalize=l,e.mut_lerp=u,e.mut_cubic=h,n.d(e,"times",function(){return G}),e.mut_times=f,n.d(e,"clamp",function(){return q}),e.mut_clamp=d,e.toString=p,e.create=m,e.wrap=g;var b=n(10);const{plus:w,minus:v,mut_plus:y,mut_minus:E}=b;e.plus=w,e.minus=v,e.mut_plus=y,e.mut_minus=E;let O=b.flatten,{sqrt:_,min:S,max:C,acos:M}=Math;const x=[];e.aliasCombos2d=x;const A=[];e.aliasCombos3d=A;const j=[];e.aliasCombos4d=j;const T=[{names:["x"],i:0},{names:["y"],i:1}];e.aliases2d=T;const P=[{names:["x","r"],i:0},{names:["y","g"],i:1},{names:["z","b"],i:2}];e.aliases3d=P;const I=[{names:["w","a"],i:3}].concat(P);e.aliases4d=I,i("xy".split("")).forEach(t=>{x.push(t)}),["xz","yz","xyz","rgb"].forEach(t=>{i(t.split("")).forEach(t=>{A.push(t)})}),["yxw","zxw","yzw","xyzw","rga","rba","gba","rgba"].forEach(t=>{i(t.split("")).forEach(t=>{j.push(t)})});const k=(()=>{let t=0,e=0,n=0;return function(i,o){for(t=0,e=i.length,n=o.length;t<e&&t<n;++t)i[t]=o[t];return i}})();e.mut_copy=k;const R=function(){let t=0,e=0;return function(n,i){for(e=n.length,i=i||m(n.length+1),t=0;t<e;++t)i[t]=n[t];return i[t]=1,i}}();e.homogenous=R;const z=function(){let t=0,e=0,n=0,i=0;return function(o){for(t=0,n=0,i=o.length;n<i;++n)e=o[n],t+=e*e;return _(t)}}();e.magnitude=z;const D=function(){let t=0,e=0,n=0;return function(i,o){for(n=i.length,o=o||m(n),t=1/z(i),e=0;e<n;++e)o[e]=i[e]*t;return o}}();e.normalize=D;const L=function(){let t=0,e=0;return function(n,i,o,s){for(e=n.length,s=s||m(e),t=0;t<e;++t)s[t]=a(n[t],i[t],o);return s}}();e.lerp=L;const N=function(){let t=0,e=0,n=0,i=0,o=0,s=0,r=0,a=0,l=0;return function(u,h,f,d,p,g){for(e=u.length,g=g||m(e),s=(i=(n=1-p)*n)*n,r=3*p*i,a=3*(o=p*p)*n,l=o*p,t=0;t<e;++t)g[t]=c(u[t],h[t],f[t],d[t],s,r,a,l);return g}}();e.cubic=N;const F=function(){let t=0,e=0;return function(n,i){for(e=0,t=n.length;t--;)e+=n[t]*i[t];return e}}();e.dot=F;var G=function(){let t=0;return function(e,n,i){if(t=e.length-1,"number"==typeof n){for(i=i||new Float32Array(t+1);t>=0;--t)i[t]=e[t]*n;return i}return F(e,n)}}();const B=function(){let t,e;return function(n,i){return t=D(n),e=D(i),M(G(t,e))}}();e.angle=B;const H=function(){let t=0,e=0,n=0,i=0;return function(o,s){for(n=0,e=o.length,t=0;t<e;++t)i=s[t]-o[t],n+=i*i;return _(n)}}();e.distance=H;const U=function(){let t=0,e=0,n=0,i=0,o=0,s=0;return function(r,a,c){if(!(r.length>3||a.length>3||r.length<2||a.length<2))return c=c||m(3),t=r[0],e=r[1],n=r[2]||0,i=a[0],o=a[1],s=a[2]||0,c[0]=e*s-n*o,c[1]=n*i-t*s,c[2]=t*o-e*i,c}}();e.cross=U;var q=(()=>{let t=0,e=0;return function(n,i,o,s){if("number"==typeof n)return function(t,e,n){return C(S(t,n),e)}(n,i,o);for(s=s||new Float32Array(n.length),t=0,e=n.length;t<e;++t)s[t]=q(n[t],i,o);return s}})();const V=m.vec2=m.bind(null,2);e.vec2=V;const X=m.vec3=m.bind(null,3);e.vec3=X;const W=m.vec4=m.bind(null,4);e.vec4=W},function(t,e,n){"use strict";function i(t){if(t instanceof Object&&"number"==typeof t.length){let e=0,n=t.length,o=[];for(;e<n;++e)o=o.concat(i(t[e]));return o}return t}function o(t,e){return t.rows===e.rows&&t.cols===e.cols||void 0===t.rows&&void 0===e.rows&&t.length===e.length||1===e.cols&&void 0===e.cols&&t.rows===e.length||1===t.rows&&void 0===e.rows&&t.cols===e.length}function s(t,e){return m(t,e,t)}function r(t,e){return g(t,e,t)}function a(t,e){return b(t,e,t)}function c(t,e){return w(t,e,t)}function l(t){return Array.prototype.slice.apply(t)}function u(t,e,n=[],o,s=0){var r;r=o?new Float32Array(o,s,e*t):new Float32Array(e*t);var a=i(n);return r.rows=t,r.cols=e,a.length?r.set(a):r.fill(0),r}Object.defineProperty(e,"__esModule",{value:!0}),e.flatten=i,e.likeMatrices=o,e.mut_plus=s,e.mut_plus_scalar=r,e.mut_minus=a,e.mut_minus_scalar=c,e.mut_multiply_scalar=function(t,e){return E(t,e,t)},e.toArray=l,e.create=u,e.wrap=function(t,e,n){return t.rows=e||t.rows,t.cols=n||t.cols,t.toArray=l.bind(null,t),t.toString=_.bind(null,t),t.col=v.bind(null,t),t.row=y.bind(null,t),t.plus=m.bind(null,t),t.plus_scalar=g.bind(null,t),t.minus=b.bind(null,t),t.minus_scalar=w.bind(null,t),t.dot=O.bind(null,t),t.multiply_scalar=E.bind(null,t),t.mut_plus=s.bind(null,t),t.mut_plus_scalar=r.bind(null,t),t.mut_minus=a.bind(null,t),t.mut_minus_scalar=c.bind(null,t),t};var h=n(9);const{cos:f,sin:d}=Math,p=h.create,m=function(){let t=0,e=0,n=0,i=0;return function(s,r,a){if(o(s,r)){for(e=s.length,n=s.rows,i=s.cols,a=a||u.similar(s),t=0;t<e;++t)a[t]=s[t]+r[t];return a}}}();e.plus=m;const g=function(){let t=0;return function(e,n,i){for(i=i||u(e.rows,e.cols),n=+n,t=e.length;t--;)i[t]=e[t]+n;return i}}();e.plus_scalar=g;const b=function(){let t=0,e=0,n=0;return function(i,s,r){if(o(i,s)){for(t=i.length,n=i.rows||0,e=i.cols||t,r=r||u.similar(i);t--;)r[t]=i[t]-s[t];return r}}}();e.minus=b;const w=function(){let t=0;return function(e,n,i){for(i=i||u(e.rows,e.cols),n=+n,t=e.length;t--;)i[t]=e[t]-n;return i}}();e.minus_scalar=w;const v=function(){let t=0,e=0;return function(n,i,o){o=o||u(n.rows,1);let s=n.cols;for(t=0,e=n.rows;t<e;++t)o[t]=n[t*s+i];return o}}();e.col=v;const y=function(){let t=0,e=0;return function(n,i,o){o=o||u(1,n.cols);let s=n.cols;for(t=0,e=n.cols;t<e;++t)o[t]=n[s*i+t];return o}}();e.row=y;const E=function(){let t=0,e=0;return function(n,i,o){for(o=o||u(n.rows,n.cols),t=0,e=n.length;t<e;++t)o[t]=n[t]*i;return o}}();e.multiply_scalar=E;const O=function(){let t=0,e=0,n=0,i=0,o=0,s=0,r=0,a=0,c=0,l=0,h=0,f=0;return function(d,p,m){if(r=void 0!==d.cols?d.cols:d.length,o=void 0!==p.rows?p.rows:p.length,r===o){for(a=void 0!==d.rows?d.rows:1,i=void 0!==p.cols?p.cols:1,t=p.length,m=m||u(a,i),f=0,c=0;c<a;++c)for(l=c*r,s=0;s<t;++s)h=l+(e=s/i|0),m[f=i*c+(n=s%i)]=m[f]+p[s]*d[h];return m}}}();e.dot=O;const _=function(){function t(t,e){return(" ".repeat(t)+e).slice(-t)}let e,n,i,o="",s=0,r=0,a=0,c=0;return function(u){for(s=0|u.cols,r=0|u.rows,o="matrix(",e=function(t){return l(t).map(t=>t.toFixed(2))}(u),n=e.reduce((t,e)=>Math.max(t,e.length),0),a=0;a<r;++a)i=e.slice(a*s,2*(a+1)*s);for(a=0,c=e.length;a<c;++a)e[a]=t(n,e[a]),a>0&&(o+=a%s==0?"\n       ":", "),o+=e[a];return o+")"}}();e.toString=_,u.similar=function(t,...e){return t.rows&&t.cols?u.apply(null,[t.rows,t.cols].concat(e)):p.apply(null,[t.length].concat(e))},u.identity=function(){let t=0,e=0,n=0;return function(i,o,s=0){let r=u(i|=0,i,void 0,o,s);for(t=0,e=i*i,n=i+1|0;t<e;t+=n)r[t]=1;return r}}(),u.translation=function(){let t=Float32Array.from([1,0,0,0,1,0,0,0,1]),e=Float32Array.from([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return function(n,i,o=0){switch(n.length){case 2:return t[2]=n[0],t[5]=n[1],u(3,3,t,i,o);case 3:return e[3]=n[0],e[7]=n[1],e[11]=n[2],u(4,4,e,i,o);default:return}}}(),u.rotateX=function(){let t=0,e=0,n=Float32Array.from([1,0,0,0,1,0,0,0,1]);return function(i,o,s=0){return t=f(i),e=d(i),n[4]=t,n[5]=-e,n[7]=e,n[8]=t,u(3,3,n,o,s)}}(),u.rotateY=function(){let t=0,e=0,n=Float32Array.from([1,0,0,0,1,0,0,0,1]);return function(i,o,s=0){return t=f(i),e=d(i),n[0]=t,n[2]=e,n[6]=-e,n[8]=t,u(3,3,n,o,s)}}(),u.rotateZ=function(){let t=0,e=0,n=Float32Array.from([1,0,0,0,1,0,0,0,1]);return function(i,o,s=0){return t=f(i),e=d(i),n[0]=t,n[1]=-e,n[3]=e,n[4]=t,u(3,3,n,o,s)}}()},function(t,e,n){"use strict";function i(t=c(),e=c(),n=1){return this.pos=c(t),this.vel=c(e),this.size=0,this.birthMass=n,this.mass=1,this.lastMeal=-1,this.eatTime=0,this}e.a=i;var o=n(1),s=n(2),r=n(5),a=n(0);const{vec2:c,times:l,mut_times:u,distance:h}=o.b,{mut_plus:f}=o.a,{random:d,sqrt:p,PI:m,ceil:g,min:b}=Math,w=c(0,0);let v,y=c(),E=0,O=0,_=0,S=0;i.prototype.tick=function(t,e){for(this.birthMass>0&&(S=b(this.birthMass,g(this.mass/100)),this.birthMass-=S,this.mass+=S),this.eatTime>30?this.eatTime--:this.lastMeal=-1,Object(s.outOfBounds)(this.pos,1.3)&&(this.mass=this.mass-1),this.size=p(this.mass/m)*a.VOID_SIZE,f(this.pos,l(this.vel,e,y)),f(this.vel,Object(s.avoid)(this.vel,this.pos,w,1.3,.01,y)),f(this.vel,Object(s.drag)(this.vel,a.GLOBAL_DRAG)),Object(s.limitVecMut)(this.vel,0,1),E=0,O=t.length;E<O;++E)(v=t[E])!==this&&(_=h(this.pos,v.pos),v instanceof r.Photon&&_<this.size&&(v.lifetime=v.lifetime-1,(0===v.lifetime||_<.6*this.size)&&(this.mass=this.mass+1,this.lastMeal=v.color,this.eatTime=15,v.lifetime=0)),v instanceof r.Mote&&_<.6*this.size&&30*d()*_<1&&(v.injured=v.injured+1),v instanceof i&&_<.44*(v.size+this.size)&&this.mass>v.mass&&(S=b(v.mass,g(this.birthMass+this.mass/100)),this.birthMass+=S,v.mass-=S),v.mass&&(v instanceof r.Emitter?f(v.vel,u(Object(s.gravitate)(v.pos,this.pos,this.mass/v.mass,y),1/v.mass)):v instanceof r.AntiGravitonCluster||f(v.vel,u(Object(s.gravitate)(v.pos,this.pos,v.mass*this.mass,y),1/v.mass))))}},function(t,e,n){"use strict";function i(){return this.queue={},this}e.a=i,i.prototype.on=function(t,e){void 0===this.queue[t]&&(this.queue[t]=[]),this.queue[t].push(e)},i.prototype.fire=function(){let t,e;return function(n,i){if(void 0!==this.queue[n])for(t=0,e=this.queue[n].length;t<e;++t)this.queue[n][t].call(i)}}()},function(t,e,n){"use strict";e.b=30;e.a=6.67408e-8;e.c=!0},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){i.init(t),s.init(t),o.init(t),r.init(t),c.init(t),a.init(t)};var i=n(40),o=n(41),s=n(42),r=n(43),a=n(44),c=n(45),l=n(3);n.d(e,"motes",function(){return i}),n.d(e,"emitters",function(){return o}),n.d(e,"photons",function(){return s}),n.d(e,"voids",function(){return r}),n.d(e,"markers",function(){return a}),n.d(e,"ui",function(){return c}),n.d(e,"util",function(){return l})},function(t,e,n){"use strict";function i(t,e){let n=0;if(e){if(t*e>o)throw new Error("requested buffer size is too large");n=t*e}else n=function(t){return o-o%t}(t);let i=new ArrayBuffer(n),s=function(t){return t<Math.pow(2,8)?new Uint8Array(t):t<Math.pow(2,16)?new Uint16Array(t):new Uint32Array(t)}(e||n/t);return Object.defineProperties(this,{itemLength:{get:()=>t},buffer:{get:()=>i},size:{get:()=>n},freed:{get:()=>s}}),this.next=0,this.freedPos=0,this}e.a=i;const o=Math.pow(2,21);let s=0;i.prototype.allocate=function(){if(this.freedPos>0)s=this.popFree();else{if(!(this.next<this.size-1))throw new Error("pool buffer is full");s=this.next,this.next=this.next+this.itemLength}return s},i.prototype.popFree=function(){return this.freedPos--,s=this.freed[this.freedPos]*this.itemLength,this.freed[this.freedPos]=0,s},i.prototype.free=function(t){this.freed[this.freedPos]=0===t?t:t/this.itemLength,this.freedPos++}},function(t,e,n){"use strict";function i(t=new Uint8Array(3),e=new Float32Array(2),n=o.MOTE_BASE_SPEED,i=o.MOTE_BASE_SIGHT,s=1,a=1){let l=ct.buffer,h=ct.allocate(),f=new Uint8ClampedArray(l,A+h,3),d=new Uint8ClampedArray(l,j+h,3);f[c.c]=t[c.c],f[c.b]=t[c.b],f[c.a]=t[c.a];let p=new Int8Array(l,P+h,G-A),m=new Float32Array(l,W+h,ot);this.pos=g(e,l,U*x+H+h),this.vel=g(0,0,l,q*x+H+h);let b=new Float32Array(l,V*x+H+h,3),w=new Float32Array(l,X*x+H+h,3);return this.target=void 0,this.color_string="",n+=Object(r.adjRand)(5e-4),i+=Object(r.adjRand)(.001),s+=Object(r.adjRand)(.001),a+=Object(r.adjRand)(.001),Object.defineProperties(this,{photons:{get:()=>f},color:{get:()=>d},dying:{get:()=>p[I],set:t=>p[I]=t},action:{get:()=>p[F],set:t=>p[F]=t},pregnant:{get:()=>p[k],set:t=>p[k]=t},injured:{get:()=>p[R],set:t=>p[R]=t},lastInjury:{get:()=>p[z],set:t=>p[z]=t},needsUpdate:{get:()=>p[L],set:t=>p[L]=t},pulse:{get:()=>p[N],set:t=>p[N]=t},lastMeal:{get:()=>p[D],set:t=>p[D]=t},size:{get:()=>m[Y],set:t=>m[Y]=t},sizeMin:{get:()=>m[Z],set:t=>m[Z]=t},sizeMax:{get:()=>m[K],set:t=>m[K]=t},speed:{get:()=>m[Q],set:t=>m[Q]=t},sight:{get:()=>m[J],set:t=>m[J]=t},agro:{get:()=>m[$],set:t=>m[$]=t},fear:{get:()=>m[tt],set:t=>m[tt]=t},potential:{get:()=>m[et],set:t=>m[et]=t},resistance:{get:()=>m[nt],set:t=>m[nt]=t},mass:{get:()=>m[it],set:t=>m[it]=t},base_speed:{get:()=>n},base_sight:{get:()=>i},base_agro:{get:()=>s},base_fear:{get:()=>a},offset:{get:()=>h},ratios:{get:()=>b},prefs:{get:()=>w}}),o.DEBUG&&Object.defineProperties(this,{intVals:{get:()=>p},floatVals:{get:()=>m}}),this.dying=0,this.pregnant=0,this.injured=0,this.lastInjury=0,this.speed=n,this.sight=i,this.agro=s,this.fear=a,this.potential=2*this.agro,this.resistance=2*this.fear,this.lastMeal=~~(3*u()),this.pulse=~~(o.TARGET_FPS*u()),this.size=o.MOTE_BASE_SIZE,this.sizeMin=.5*o.MOTE_BASE_SIZE,this.sizeMax=3*o.MOTE_BASE_SIZE,this.updateProperties(),this.prefs[c.c]=this.ratios[c.c],this.prefs[c.b]=this.ratios[c.b],this.prefs[c.a]=this.ratios[c.a],this}e.b=i;var o=n(0),s=n(1),r=n(2),a=n(15),c=n(4),l=n(11);let{random:u,max:h,min:f,floor:d,ceil:p,sin:m}=Math;const{vec2:g,times:b,mut_clamp:w,magnitude:v,distance:y,mut_copy:E,mut_times:O}=s.b,{plus:_,mut_plus:S}=s.a,C=w,M=g(0,0);e.a=4;Object(r.twiddleVec)(M);const x=4,A=0,j=A+3,T=j+3,P=T,I=0,k=I+1,R=k+1,z=R+1,D=z+1,L=D+1,N=L+1,F=N+1,G=F+1,B=T+G,H=B+(x-B%x),U=0,q=U+2,V=q+2,X=V+3,W=H+(X+3)*x,Y=0,Z=Y+1,K=Z+1,Q=K+1,J=Q+1,$=J+1,tt=$+1,et=tt+1,nt=et+1,it=nt+1,ot=it+1,st=W+ot*x,rt=g(),at=g(),ct=new a.a(st,o.MAX_MOTES);i.prototype.updateProperties=function(){let t,e,n,i=0,s=0,a=0;return function(){if(({photons:t,ratios:n,color:e}=this),i=t[c.c],s=t[c.b],a=t[c.a],this.mass=i+s+a,this.mass>0&&(this.size=C(this.mass/(o.PREGNANT_THRESHOLD/3)*o.MOTE_BASE_SIZE,this.sizeMin,this.sizeMax),Object(r.norm_ratio)(t,n),this.speed=this.base_speed*(1-this.size)*(1+n[c.a]),this.sight=this.base_sight+.5*this.size,this.agro=this.base_agro*(1+n[c.c]),this.fear=this.base_fear*(1+n[c.b]),o.DEBUG)){if(isNaN(this.speed))throw new Error("Mote.updateProperties: NaN speed");if(isNaN(this.sight))throw new Error("Mote.updateProperties: NaN sight");if(isNaN(this.size))throw new Error("Mote.updateProperties: NaN size");if(isNaN(this.agro))throw new Error("Mote.updateProperties: NaN agro");if(isNaN(this.fear))throw new Error("Mote.updateProperties: NaN fear")}this.mass>o.PREGNANT_THRESHOLD&&0===this.pregnant&&(this.pregnant=o.PREGNANT_TIME),this.mass<o.DEATH_THRESHOLD&&0===this.dying&&(this.dying=1),e[c.c]=~~(255*n[c.c]),e[c.b]=~~(255*n[c.b]),e[c.a]=~~(255*n[c.a]),this.needsUpdate=0}}(),i.prototype.runMaintenance=function(){let t,e,n,i=0,s=0,a=0,c=0,l=0,u=0,h=0,f=0,d=0;return function(p){({pos:t,vel:e,pregnant:i,dying:s,agro:l,fear:u,size:h,speed:f,sight:d,target:n}=this),i>0&&(this.pregnant=i-1),s>0&&(this.dying=s+1),this.needsUpdate&&this.updateProperties(),a=l*(100*h),c=u*(100*h),this.potential=C(this.potential+l*p,-a,a),this.resistance=C(this.resistance+u*p,-c,c),S(t,b(e,p,rt)),S(e,Object(r.avoid)(e,t,M,1.3,f,rt)),S(e,Object(r.drag)(e,o.GLOBAL_DRAG))}}(),i.prototype.validateTarget=function(){let t,e=0,n=0;return function(i){return({pos:t,sight:n}=this),e=y(t,i.pos),i===this?-1:i.dying?-1:i.lifetime&&i.lifetime<3?-1:i.mass<1?-1:e>n+.5*i.size?-1:Object(r.outOfBounds)(i,.7)?-1:e}}(),i.prototype.search=function(){let t,e,n,o,s,r=0,a=0,u=0,d=0,p=0,m=0,g=0,b=0,w=0,v=0;return function(y){for(({pos:t,vel:e,sight:u}=this),n=-1/0,o=0,(this.pregnant||this.dying)&&(this.action=0,n=1/0),r=0,a=y.length;r<a&&n<1/0;++r){s=y[r];let t=this.validateTarget(s);-1!==t&&(s instanceof i?(d=1/t*3)>n&&(this.target=s,s.target===this||t<.5*(this.size+s.size)?this.action=3:this.action=2,n=d):s instanceof l.a?(this.target=s,this.action=3,n=1/0):s instanceof c.d&&s.lifetime>3&&(p=this.prefs[c.c]-this.ratios[c.c],m=this.prefs[c.b]-this.ratios[c.b],g=this.prefs[c.a]-this.ratios[c.a],w=h(p,m,g),b=f(p,m,g),(w==p&&s.color==c.c||w==m&&s.color==c.b||w==g&&s.color==c.a)&&(v=30),v=b==p&&s.color==c.c||b==m&&s.color==c.b||b==g&&s.color==c.a?10:20,(d=v*(1/t))>n&&(this.target=s,this.action=2,n=d)))}return!(n<0)}}(),i.prototype.tick=function(){let t,e,n,o,s,a,l,h,f,d,p;return function(g,w,y){switch(({pos:t,vel:e,size:n,sight:o,speed:s,agro:a,fear:l,resistance:h,potential:f,target:d}=this),this.runMaintenance(w),d&&-1===(p=this.validateTarget(d))&&(this.action=0),this.action){case 0:this.target=void 0,v(e)<.001?(rt[0]=2*u()-1,rt[1]=2*u()-1):(E(rt,t),S(rt,b(e,w,at)),S(rt,Object(r.rotate)(rt,t,m((y+this.pulse)*s),at))),S(e,Object(r.accelerate)(t,rt,s,at)),this.action=1;break;case 2:_(d.pos,b(d.vel,w,rt),at),S(e,Object(r.accelerate)(t,at,s,rt)),p<o&&(d instanceof i&&(this.potential,this.agro),this.action=4);break;case 3:_(d.pos,b(d.vel,w,rt),at),S(e,Object(r.accelerate)(at,t,s,rt)),this.resistance>3*l&&(this.action=0);break;case 4:d instanceof i?this.discharge(d):d instanceof c.d&&this.eatPhoton(d);break;case 5:break;case 1:this.search(g)||(this.action=0)}}}();let lt=0;i.prototype.discharge=function(t){lt=this.potential-t.resistance,t.resistance-=h(this.agro,lt*this.agro),this.potential-=h(this.fear,lt*this.fear),t.injure(this,h(0,~~lt)),this.potential<0&&(this.action=0)},i.prototype.injure=function(t,e){this.injured+=e,this.lastInjury=this.injured,(this.resistance<3*this.agro||this.injured<this.fear)&&(this.target=t)},i.prototype.bleed=function(){let t,e=0,n=0,i=g();return function(){t=this.photons;do{switch(e=~~(3*u())){case c.c:n=t[c.c];break;case c.b:n=t[c.b];break;case c.a:n=t[c.a]}}while(0===n);switch(e){case c.c:t[c.c]=t[c.c]-1;break;case c.b:t[c.b]=t[c.b]-1;break;case c.a:t[c.a]=t[c.a]-1}return this.injured--,O(this.vel,1+this.speed),E(i,this.vel),O(i,-1),this.needsUpdate=1,new c.d(this.pos,i,e)}}(),i.prototype.split=function(){let t,e;return function(){return e=this.photons,t=new i([d(e[c.c]/2),d(e[c.b]/2),d(e[c.a]/2)],this.pos,this.base_speed,this.base_sight,this.base_agro,this.base_fear),e[c.c]=p(e[c.c]/2),e[c.b]=p(e[c.b]/2),e[c.a]=p(e[c.a]/2),this.pregnant=o.PREGNANT_TIME-1,t.pregnant=o.PREGNANT_TIME-1,this.target=t,t.target=this,t.needsUpdate=1,this.needsUpdate=1,t}}(),i.prototype.eatPhoton=function(){let t;return function(e){if(e.lifetime>2&&y(this.pos,e.pos)<this.sight){switch(t=this.photons,e.lifetime=2,e.color){case c.c:t[c.c]+=1;break;case c.b:t[c.b]+=1;break;case c.a:t[c.a]+=1}this.lastMeal=e.color,this.potential-=.5*this.agro,this.resistance-=.5*this.fear,this.needsUpdate=1}this.action=0}}();const ut=new Float32Array(2),ht=new Uint8ClampedArray(3);i.random=function(){do{ut[0]=u()*Object(r.posneg)(),ut[1]=u()*Object(r.posneg)()}while(v(ut)>.8);return ht[0]=~~(64*u()),ht[1]=~~(64*u()),ht[2]=~~(64*u()),new i(ht,ut)},i.prototype.destroy=function(){ct.free(this.offset)}},function(t,e,n){"use strict";function i(){let t=document.querySelector(l.container);u.state.game.start(),t.removeEventListener("click",i),t.classList.remove("start"),console.log("game started")}Object.defineProperty(e,"__esModule",{value:!0}),e.startGame=i;var o=n(7),s=n(6),r=n(5),a=n(0),c=n(2);const l={container:"body",bufferDescriptions:[{label:"bokehBack",compositeMethod:"source-over",scaleMethod:o.b.buffers.SCALE_KEEP_ASPECT},{label:"bokehFront",compositeMethod:"lighter",scaleMethod:o.b.buffers.SCALE_NONE},{label:"entitiesLight",compositeMethod:"lighter",scaleMethod:o.b.buffers.SCALE_NONE},{label:"entitiesDark",compositeMethod:"hard-light",scaleMethod:o.b.buffers.SCALE_NONE},{label:"ui",compositeMethod:"source-over",scaleMethod:o.b.buffers.SCALE_NONE}],pixelRatio:1,frameCallback:function(){u.state.game.started&&u.state.game.tick(o.b.timing),u.draw.tick()}};var u={util:c,constants:a,controls:o.a,display:o.b,game:r,draw:s,state:{}};window.photonomix=u,window.addEventListener("load",function(){u.state.game=new r.Game,o.b.init(l),s.init(u.state,o.b),o.a.init(),document.querySelector(l.container).addEventListener("click",i)})},function(t,e,n){"use strict";function i(t){if(t instanceof Object&&"number"==typeof t.length){let e=0,n=t.length,o=[];for(;e<n;++e)o=o.concat(i(t[e]));return o}return t}function o(t,...e){const n=function(t){let e=s(t);void 0===e&&(e=new f.a(t),p[t]=e);return e}(t);return(e=i(e)).forEach(t=>{const e=function(t){let e=r(t=t.toLowerCase());void 0===e&&(e=new h.a(t),d.push(e));return e}(t);-1==n.keys.indexOf(e)&&n.keys.push(e)}),n}function s(t){return p[t]}function r(t){return t=t.toLowerCase(),d.filter(e=>e.key===t)[0]}function a(t){const e=Date.now();if(t instanceof MouseEvent){const n=r("mouse"+t.button);n&&n.lastUp>=n.lastDown&&(n.down=!0,n.lastDown=e)}else if(t instanceof KeyboardEvent){const n=r(t.key);n&&n.lastUp>=n.lastDown&&(n.down=!0,n.lastDown=e)}}function c(t){const e=Date.now();if(t instanceof MouseEvent){const n=r("mouse"+t.button);n&&(n.down=!1,n.lastUp=e)}else if(t instanceof KeyboardEvent){const n=r(t.key);n&&(n.down=!1,n.lastUp=e)}}function l(){const t=Date.now();d.forEach(e=>{e.down=!1,e.lastUp=t})}function u(t){m[0]=t.clientX,m[1]=t.clientY}Object.defineProperty(e,"__esModule",{value:!0}),e.flatten=i,e.map=o,e.unmap=function(t,e){if(p[t]){let n=p[t].keys.indexOf(r(e));n&&p.keys.splice(n,1)}return p[t]},e.lookupMap=s,e.lookupKeyState=r,e.getCursorPosition=function(){return Float32Array.of(m[0],m[1])},e.init=function(){window.addEventListener("keydown",a),window.addEventListener("keyup",c),window.addEventListener("mousedown",a),window.addEventListener("mouseup",c),window.addEventListener("blur",l),window.addEventListener("mousemove",u)};var h=n(19),f=n(20);const d=[],p={},m=new Float32Array(2)},function(t,e,n){"use strict";e.a=function(t){return this.key=t,this.down=!1,this.lastDown=0,this.lastUp=0,Object.seal(this)}},function(t,e,n){"use strict";function i(t){return t=t.toLowerCase(),this.label=t,this.keys=[],this.checkedDown=0,this.checkedUp=0,Object.seal(this)}e.a=i,i.prototype.lastDown=function(){return this.keys.reduce((t,e)=>t=t>e.lastDown?t:e.lastDown,0)},i.prototype.lastUp=function(){return this.keys.reduce((t,e)=>t=t>e.lastDown?t:e.lastDown,0)},i.prototype.isDown=function(){return this.keys.reduce((t,e)=>t=t||e.down,!1)},i.prototype.onceDown=function(){return!!(this.lastUp()>=this.checkedDown&&this.isDown())&&(this.checkedDown=Date.now(),!0)},i.prototype.onceUp=function(){return this.lastDown()>=this.checkedUp&&!this.isDown()&&(this.checkedUp=Date.now(),!0)}},function(t,e,n){"use strict";n(22),n(24),n(25),n(28)},function(t,e,n){"use strict";function i(t,e,n,i){return this.frameCount=t,this.frameWidth=e,this.frameHeight=n,this.animations=i,this.context=void 0,this.flippedContext=void 0,this.ready=!1,this.width=0,this.height=0,this.rows=0,this.columns=0,Object.seal(this)}var o=n(8);let s=[];i.prototype.init=function(t,e=!0){let n=document.createElement("canvas");n.width=this.width=t.width,n.height=this.height=t.height,this.columns=n.width/this.frameWidth,this.rows=n.height/this.frameHeight;let i=n.getContext("2d");i.drawImage(t,0,0),this.context=i,e&&this.generateFlipped(),this.ready=!0},i.prototype.generateFlipped=function(){let t=document.createElement("canvas");t.width=this.width,t.height=this.height;let e,n,i,o,s,r,a=t.getContext("2d"),c=this.rows,l=this.cols,u=this.frameWidth,h=this.frameHeight;for(a.scale(-1,1),e=0,c=this.rows;e<c;++e)for(n=0,l=this.columns;n<l;++n)s=i=n*u,o=r=e*h,a.drawImage(this.context.canvas,i,o,u,h,-i-u,r,u,h);a.setTransform(1,0,0,1,0,0),this.flippedContext=a},i.prototype.draw=function(t,e,n,i,o=!1){let s=this.animations[e]?this.animations[e]:this.animations.default,r=s.startFrame+n%s.length,{frameWidth:a,frameHeight:c}=this,l=o?this.flippedContext.canvas:this.context.canvas;t.drawImage(l,function(t,e){return e%t.columns*t.frameWidth}(this,r),function(t,e){return Math.floor(e/t.columns)*t.frameHeight}(this,r),a,c,i[0],i[1],a,c)},i.fromAsepriteAtlas=function(t){return new Promise(e=>{void 0!==s[t]&&s[t]instanceof i?e(s[t]):(console.log(o),o.requestAsset(t).then(n=>{let r=n.content,a={default:{label:"default",startFrame:0,length:1}};r.meta.frameTags&&r.meta.frameTags.forEach(t=>{a[t.name.toLowerCase()]={label:t.name.toLowerCase(),startFrame:t.from,length:t.to-t.from+1}}),o.requestAsset(r.meta.image).then(n=>{let o=new i(r.frames.length,r.frames[0].frame.w,r.frames[0].frame.h,a);o.init(n.content),s[t]=o,e(o)})}))})}},function(t,e,n){"use strict";function i(t,e){if(void 0!==r[t])throw new Error("tried to add a mimeType but there's already a handler for it");r[t]=e}function o(t){return new Promise(e=>{t.blob().then(t=>{let n=document.createElement("img");n.addEventListener("load",()=>e(n)),n.src=URL.createObjectURL(t)})})}function s(t){return new Promise(e=>t.text().then(t=>e(t)))}e.a=function(t){return"function"==typeof r[t]?r[t]:r.default};const r={default:t=>new Promise(e=>t.blob().then(t=>e(t)))};i("image/jpeg",o),i("image/gif",o),i("image/png",o),i("text/html",s),i("text/plain",s),i("application/json",function(t){return new Promise(e=>t.json().then(t=>e(t)))})},function(t,e,n){"use strict";(function(){return this}).prototype.init=function(t){let e=document.createElement("canvas");e.width=this.width=t[0].width,e.height=this.height=t[0].height,this.columns=e.width/this.frameWidth,this.rows=e.height/this.frameHeight;let n=e.getContext("2d");for(let e=0,i=t.length;e<i;++e)n.drawImage(t[e],0,0);this.ready=!0,this.spriteCanvas=e}},function(t,e,n){"use strict";function i(t,e,n){return this.layers=t,this.animations=e,this.slices=n,this.source=void 0,this.context=void 0,this.flippedContext=void 0,this.ready=!1,Object.seal(this)}var o=n(8),s=n(1);const r=[];i.prototype.init=function(t,e=!0){this.source=t;let n=document.createElement("canvas");n.width=t.width,n.height=t.height;let i=n.getContext("2d");i.drawImage(t,0,0),this.context=i,e&&this.generateFlipped(),this.ready=!0},i.prototype.generateFlipped=function(){let t=document.createElement("canvas");t.width=this.context.canvas.width,t.height=this.context.canvas.height;let e=t.getContext("2d");e.scale(-1,1);let n,i,o,r=t=>{let i=this.slices[t],r=s.b.vec2(i.pos);s.b.mut_plus(r,o.frames[n].pos),e.drawImage(this.context.canvas,r[0],r[1],i.dims[0],i.dims[1],-r[0]-i.dims[0],r[1],i.dims[0],i.dims[1])};Object.keys(this.layers).forEach(t=>{for(o=this.layers[t],n=0,i=o.frames.length;n<i;++n)Object.keys(this.slices).filter(t=>"default"!==t).forEach(r)}),e.setTransform(1,0,0,1,0,0),this.flippedContext=e},i.prototype.draw=function(t,e,n,i=!1,o){let r=this.slices[e]?this.slices[e]:this.slices.default,a=i?this.flippedContext.canvas:this.context.canvas;void 0===o&&(o=Object.keys(this.layers)),o.forEach(e=>{let i=s.b.vec2(r.pos);s.b.mut_plus(i,this.layers[e].frames[0].pos),t.drawImage(a,i[0],i[1],r.dims[0],r.dims[1],n[0],n[1],r.dims[0],r.dims[1])})},i.prototype.animate=function(t,e,n,i,o=!1,s){void 0===s&&(s=Object.keys(this.layers));let r=this.animations[e]?this.animations[e]:this.animations.default,a=r.start+i%r.length,c=o?this.flippedContext.canvas:this.context.canvas;s.forEach(e=>{let i=this.layers[e].frames[a];t.drawImage(c,i.pos[0],i.pos[1],i.dims[0],i.dims[1],n[0],n[1],i.dims[0],i.dims[1])})},i.prototype.prebake=function(){throw new Error("unimplemented")},i.fromAsepriteAtlas=function(t,e){return e=e||function(t){return t},new Promise(n=>{void 0!==r[t]&&r[t]instanceof i?n(r[t]):(console.log(o),o.requestAsset(t).then(a=>{let c,l=a.content,u=l.meta.size.w,h=l.meta.size.h,f=l.meta.layers.length,d=l.frames.length/f,p=h/f,m={},g=[];l.meta.layers.forEach((t,n)=>{g.push(t.name),void 0===m[t.name]&&(c={label:t.name.trim(),data:e(t.data?t.data:""),opacity:t.opacity,blendMode:t.blendMode,pos:s.b.vec2(0,n*p),frames:[]},m[c.label]=Object.freeze(c))});let b,w={default:{label:"default",data:e(""),pos:s.b.vec2(0,0),dims:s.b.vec2(u,h)}};l.meta.slices.forEach(t=>{void 0===w[t.name]&&(b={label:t.name.trim(),data:e(t.data?t.data:""),pos:s.b.vec2(t.keys[0].bounds.x,t.keys[0].bounds.y),dims:s.b.vec2(t.keys[0].bounds.w,t.keys[0].bounds.h)},w[b.label]=Object.freeze(b))});let v,y={};l.meta.frameTags.forEach(t=>{void 0===y[t.name]&&(v={label:t.name.trim(),start:t.from,length:t.to-t.from+1},y[v.label]=Object.freeze(v))}),l.frames.forEach((t,e)=>{let n=m[g[~~(e/d)]],i={pos:s.b.vec2(t.frame.x,t.frame.y),dims:s.b.vec2(t.frame.w,t.frame.h)};n.frames.push(Object.freeze(i))}),o.requestAsset(l.meta.image).then(e=>{let o=new i(Object.seal(m),Object.seal(y),Object.seal(w));o.init(e.content),r[t]=o,n(o)})}))})}},function(t,e,n){"use strict";var i=n(9),o=n(10);n(27);const s=i;e.b=s;const r=o;e.a=r},function(t,e,n){"use strict";function i(t){if(0===t.length)return[[]];for(var e=[],n=0;n<t.length;n++)for(var o=t.slice(),s=o.splice(n,1),r=i(o),a=0;a<r.length;a++){var c=s.concat(r[a]);e.push(c)}return e}function o(t){return t.map(t=>this[t])}function s(t){return"quaternion("+h.toArray(t).map(t=>t.toFixed(2)).join(", ")+")"}function r(t,e){e=e||a();return f(t,e)}function a(){let t=[0,0,0,1],e=Array.prototype.slice.apply(arguments),n=e.length;0===n?e=t:e[n-1]instanceof ArrayBuffer?e=1===n?t.concat(e).concat([0]):e.concat([0]):e[n-2]instanceof ArrayBuffer&&2===n&&(e=t.concat(e));return u.create.apply(null,[4].concat(e))}function c(t){return function(t){Object.defineProperties(t,{x:{get:function(){return this[0]}},y:{get:function(){return this[1]}},z:{get:function(){return this[2]}},w:{get:function(){return this[3]}}});for(let e=0,n=w.length;e<n;++e)Object.defineProperty(t,w[e].join(""),{get:o.bind(t,w[e])})}(t),h.wrap(t),t.slerp=l(v,t),t.normalize=l(r,t),t.invert=l(y,t),t.toString=s.bind(null,t),t.times=l(u.times,t),t.clamp=l(u.clamp,t),t.normalize=l(u.normalize,t),t.mut_normalize=l(u.mut_normalize,t),t.mut_times=l(u.mut_times,t),t.mut_clamp=l(u.mut_clamp,t),t.mut_copy=l(u.mut_copy,t),t}function l(t,e){return function(){return c(a(t.apply(null,[e].concat(Array.prototype.slice.apply(arguments)))))}}Object.defineProperty(e,"__esModule",{value:!0}),e.toString=s,e.normalize=r,e.create=a,e.wrap=c;var u=n(9),h=n(10);const f=u.normalize,{abs:d,sin:p,cos:m,acos:g,sqrt:b}=Math;let w=[];["xyzw","xyz","xzw","xyw","yzw","xy","xw","xz","yz","yw","zw"].forEach(t=>{i(t.split("")).forEach(t=>{w.push(t)})});const v=function(){let t=0,e=0,n=0,i=0,o=0,s=0,r=0,c=0,l=0,u=0,h=0,f=0,m=0;return function(w,v,y,E){return t=w[0],e=v[0],n=w[1],i=v[1],o=w[2],s=v[2],r=w[3],c=v[3],l=t*e+n*i+o*s+r*c,E=E||a(),d(l)>=1?(E[0]=t,E[1]=n,E[2]=o,E[3]=r,E):(h=g(l),u=b(1-l*l),f=p((1-y)*h)/u,m=p(y*h)/u,E[0]=t*f+e*m,E[1]=n*f+i*m,E[2]=o*f+s*m,E[3]=r*f+c*m,E)}}();e.slerp=v;const y=function(t,e=!0,n){return n=n||a(),e?r(t,n):n.set(t),n[0]=-n[0],n[1]=-n[1],n[2]=-n[2],n};e.invert=y,a.identity=function(){return a()},a.fromEulerAngles=function(){let t=0,e=0,n=0,i=0,o=0,s=0,r=0,c=0,l=0,u=0,h=0;return function(f,d,g){let b=a(d,g);return t=f[0]/2,e=f[1]/2,n=f[2]/2,i=m(t),o=p(t),s=m(e),r=p(e),c=m(n),l=p(n),u=i*s,h=o*r,b[0]=u*l+h*c,b[1]=o*s*c+i*r*l,b[2]=i*r*c-o*s*l,b[3]=u*c-h*l,b}}(),a.fromAxisAngle=function(){let t=0,e=0;return function(n,i,o,s){let r=a(o,s);return t=f(n),e=i/2,r[0]=t[0]*p(e),r[1]=t[1]*p(e),r[2]=t[2]*p(e),r[3]=m(e),r}}()},function(t,e,n){"use strict";function i(){return this}i.prototype.init=function(t){},i.prototype.write=function(t,e,n,i,o,s=1){}},function(t,e,n){"use strict";function i(t){return t>>1<<1}function o(){S||(S=!0,document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),j.events.fire("fullscreen-off")):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),j.events.fire("fullscreen-on")))}function s(t){return t.preventDefault(),S=!!(document.webkitIsFullScreen||document.mozIsFullScreen||document.msIsFullScreen),!1}function r(){A.width=j.width=i(m.clientWidth),A.height=j.height=i(m.clientHeight),j.orientation=j.width>j.height?0:1,j.minDimension=b(j.width,j.height),j.maxDimension=w(j.width,j.height),M.forEach(t=>{t.width=~~(j.width/j.pixelRatio),t.height=~~(j.height/j.pixelRatio)}),j.events.fire("resize")}function a(){requestAnimationFrame(a);try{let t=Date.now();(E=t-C)>y&&(C=t-E%y,O++,g(x),u.composite(M,A,j))}catch(t){console.error("Crappy uncaught error in animation loop is crappy")}}function c(t){j.pixelRatio=t.pixelRatio||j.pixelRatio,(m=document.querySelector(t.container)).classList.add("2d"),A=new u.CompositeBuffer(m),m.width=A.width=i(m.clientWidth),m.height=A.height=i(m.clientHeight),function(t){for(let e=0,n=t.length;e<n;++e){let n=t[e],i=new u.DrawBuffer(n.compositeMethod,n.scaleMethod);i.id=n.label,M.push(i),x[n.label]=i}}(t.bufferDescriptions),r(),g=t.frameCallback,window.addEventListener("resize",r),(v=t.fullscreen)&&(m.addEventListener("click",o),document.addEventListener("fullscreenchange",s),document.addEventListener("mozfullscreenchange",s),document.addEventListener("msfullscreenchange",s),document.addEventListener("webkitfullscreenchange",s)),p=Date.now(),C=p,y=1e3/d.b,_||requestAnimationFrame(a),_=!0}Object.defineProperty(e,"__esModule",{value:!0}),e.evenNumber=i,e.updateCompositeOperation=function(t,e){t.globalCompositeOperation!==e&&(t.globalCompositeOperation=e)},e.init=c;var l=n(30),u=n(31),h=n(12),f=n(32);n.n(f);n.d(e,"buffers",function(){return u}),n.d(e,"ui",function(){return f}),n.d(e,"util",function(){return l});var d=n(13);let p,m,g,{min:b,max:w}=Math,v=!1,y=0,E=0,O=0,_=!1,S=!1,C=0;const M=[],x={};e.buffersByLabel=x;let A;const j={width:0,height:0,pixelRatio:1,orientation:0,aspect:0,minDimension:0,maxDimension:0,events:new h.a};e.props=j;const T={get frameCount(){return O},get startTime(){return p},get lastFrame(){return C},get elapsed(){return E},get interval(){return y}};e.timing=T},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.drawCircle=function(t,e,n,i,o,s=0,r){t.globalCompositeOperation="source-over",t.beginPath(),t.arc(e,n,i,2*Math.PI,!1),t.fillStyle=o,t.fill(),r&&(t.strokeStyle=r,t.lineWidth=s,t.stroke()),t.closePath()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrawBuffer=function(t="source-over",e=o,n="2d"){return this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext(n),this.offsetX=0,this.offsetY=0,this.compositeMethod=t,this.scaleMethod=e,Object.defineProperties(this,{width:{get:()=>this.canvas.width,set:t=>this.canvas.width=t},height:{get:()=>this.canvas.height,set:t=>this.canvas.height=t}}),this},e.CompositeBuffer=function(t){return this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.container=t,this.container.appendChild(this.canvas),Object.defineProperties(this,{width:{get:()=>this.canvas.width,set:t=>this.canvas.width=t},height:{get:()=>this.canvas.height,set:t=>this.canvas.height=t}}),this};const{min:i}=Math,o=0;e.SCALE_STRETCH=o;e.SCALE_KEEP_ASPECT=1;e.SCALE_NONE=2;e.SCALE_CROP=3;const s=function(){let t,e,n,s,r,a,c,l,u,h,f,d;return function(p,m,g){for(s=m.context,1!==g.pixelRatio&&(s.imageSmoothingEnabled=!1),t=0,e=p.length;t<e;++t){switch(n=p[t],s.globalCompositeOperation!==n.compositeMethod&&(s.globalCompositeOperation=n.compositeMethod),n.scaleMethod){case o:c=0,l=0,r=n.width,a=n.height,f=n.offsetX,d=n.offsetY,u=m.width,h=m.height;break;case 1:c=0,l=0,r=n.width,a=n.height,f=n.offsetX,d=n.offsetY,u=m.width,h=m.height,g.orientation?(r=m.width,a=i(m.height,n.height),u=i(m.width,n.width),h=m.height):(r=i(m.width,n.width),a=m.height,u=m.width,h=i(m.height,n.height));break;case 3:c=0,l=0,r=i(m.width-n.offsetX,n.width),a=i(m.height-n.offsetY,n.height),f=n.offsetX,d=n.offsetY,u=i(m.width-n.offsetX,n.width),h=i(m.height-n.offsetY,n.height);break;default:c=0,l=0,r=n.width,a=n.height,f=n.offsetX,d=n.offsetY,u=n.width*g.pixelRatio,h=n.height*g.pixelRatio}s.drawImage(n.canvas,c,l,r,a,f,d,u,h)}}}();e.composite=s},function(t,e,n){"use strict"},function(t,e,n){"use strict";function i(t,e=0,n=1/0){return m(t)<m(e)?t=t<0?-e:e:m(t)>m(n)&&(t=t<0?-n:n),t}var o=n(13),s=n(1);const{minus:r,mut_clamp:a,mut_copy:c,mut_times:l,normalize:u,mut_normalize:h,magnitude:f,vec2:d}=s.b,{sqrt:p,abs:m,floor:g,ceil:b,round:w}=Math,v=function(){let t=0,e=0;return function(n,o=0,s=1/0){for(t=0,e=n.length;t<e;++t)n[t]=i(n[t],o,s)}}(),y=function(){let t,e;return function(n){for(t=0,e=n.length;t<e;t++){if(isNaN(n[t]))throw new Error("NaN vector");if(n[t]===1/0)throw new Error("Infinite vector");if(n[t]===-1/0)throw new Error("-Infinite vector")}}}();(function(){let t=d(),e=0,n=0,i=0,o=0})(),function(){let t=d(),e=0,n=0,i=0}(),function(){let t=d(),e=0,n=0,i=0,o=0,s=0}()},function(t,e,n){"use strict";function i(){if(arguments[0]instanceof ArrayBuffer&&"number"==typeof arguments[1]&&"number"==typeof arguments[2])this[o]=new Uint8Array(arguments[0],arguments[1],Math.ceil(arguments[2]/8));else{if("number"!=typeof arguments[0])throw Error("expected either length or buffer, offset, length as arguments");this[o]=new Uint8Array(Math.ceil(arguments[0]/8))}return this.length=8*this[o].byteLength,Object.freeze(this),this}const o=Symbol();i.prototype.get=function(t){let e=~~(t/8),n=t%8;return!!(this[o][e]&1<<n)},i.prototype.set=function(t,e){let n=~~(t/8),i=t%8;e?this[o][n]|=1<<i:this[o][n]&=255^1<<i},i.prototype.fill=function(t){this[o].fill(t?255:0)},i.prototype.recycle=function(){this[o].fill(0)}},function(t,e,n){"use strict"},function(t,e,n){"use strict";function i(t=0,e=0){return this.width=0,this.height=0,this.cellWidth=0,this.cellHeight=0,this.length=0,t&&e&&this.init(t,e),this}const{floor:o}=Math,s=Math.pow(2,16)-1,r=new Uint16Array(4),a=new Uint16Array(4),c=new Uint16Array(4),l=new Uint16Array(4),u=new Uint16Array(4),h=new Uint16Array(4);if(r[0]=4369,r[1]=r[0]<<1,r[2]=r[0]<<2,r[3]=r[0]<<3,(r[0]|r[1]|r[2]|r[3])!==s)throw new Error("MASK_X is bad");if(a[0]=15,a[1]=a[0]<<4,a[2]=a[0]<<8,a[3]=a[0]<<12,(a[0]|a[1]|a[2]|a[3])!==s)throw new Error("MASK_Y is bad");c[0]=0,c[1]=a[3],c[2]=c[1]|a[2],c[3]=c[2]|a[1],l[0]=0,l[1]=a[0],l[2]=l[1]|a[1],l[3]=l[2]|a[2],u[0]=0,u[1]=r[3],u[2]=u[1]|r[2],u[3]=u[2]|r[1],h[0]=0,h[1]=r[0],h[2]=h[1]|r[1],h[3]=h[2]|r[2];const f=Symbol();i.CHANNEL_RED=0,i.CHANNEL_GREEN=1,i.CHANNEL_BLUE=2,i.CHANNEL_ALPHA=3,i.fromCanvasPixels=function(t,e=0,n=i.CHANNEL_ALPHA){console.time("new CollisionMap");let o=new i(t.width,t.height);console.timeEnd("new CollisionMap");let s,r=t.getContext("2d");console.time("fromCanvasPixels loop");let a=!0;for(let i=0,c=t.height;i<c;i+=100){try{a&&console.time("getImageData"),s=r.getImageData(0,i,t.width,100).data,a&&console.timeEnd("getImageData")}catch(t){throw new Error("CollisionData:failed to get image data :(")}a&&console.time("loop map.set");for(let r=0,a=s.length;r<a;r+=4){let a=r/4%t.width,c=i+~~(r/4/t.width);s[r+n]>e&&o.set(a,c,!0)}a&&console.timeEnd("loop map.set"),a=!1}return console.timeEnd("fromCanvasPixels loop"),o};const d=i.cellBit=function(t,e){return 1<<t%4+e%4*4},p=i.cellMask=function(t,e){return function(t){return s^t}(d(t,e))},m=i.cellIndex=function(t,e,n){return o(e/4)*o(n/4)+o(t/4)};i.prototype.init=function(t,e){this.width=~~t,this.width%4&&(this.width+=4-~~t%4),this.height=~~e,this.height%4&&(this.height+=4-~~e%4),this.cellWidth=this.width/4,this.cellHeight=this.height/4;let n=this.cellWidth*this.cellHeight;return this.length!==n?(this.length=n,this.length&&(this[f]=new Uint16Array(this.length))):this[f]&&this[f].fill(0),this},i.prototype.getCell=function(t,e){return this[f][m(t,e,this.width)]},i.prototype.get=function(t,e){return this.getCell(t,e)&d(t,e)?1:0},i.prototype.set=function(t,e,n){n?this[f][m(t,e,this.width)]|=d(t,e):this[f][m(t,e,this.width)]&=p(t,e)},i.prototype.checkRect=function(t,e,n,i){let o,r,a=t%4,d=e%4,p=Math.ceil((a+n)/4),m=Math.ceil((d+i)/4);for(let t=0;t<m;++t){r=0===t?c[d]:t===m-1?l[d]:s;for(let e=0;e<p;++e)if((o=0===e?h[a]:e===p-1?u[a]:s)&r&this[f][t*this.cellWidth+e])return 1}return 0},i.prototype.intersect=function(t,e,n,i,o,s,r){let a,c,l=0;for(c=0;c<r;++c)for(a=0;a<r;++a)l+=this.get(e+a,n+c)&&t.get(i+a,o+c)?1:0;return l},i.MASK_X=r,i.MASK_Y=a,i.MASK_TOP=c,i.MASK_BOTTOM=l,i.MASK_LEFT=h,i.MASK_RIGHT=u},function(t,e,n){"use strict";function i(t,e){return Math.random()*(e-t)+t}function o(t,e,n,i){return"hsla("+t+","+e+"%,"+n+"%,"+i+")"}function s(){let t=u.width,e=u.height,n=Math.min(t,e),i=Math.max(t,e);h.fillStyle="black",h.fillRect(0,0,t,e);let o=h.createLinearGradient(0,0,t,e);o.addColorStop(0,g[0]),o.addColorStop(.5,g[1]),o.addColorStop(1,g[2]),h.fillStyle=o,h.fillRect(0,0,t,e),(o=h.createLinearGradient(0,e,t,0)).addColorStop(0,b[0]),o.addColorStop(.5,b[1]),o.addColorStop(1,b[2]),h.fillStyle=o,h.fillRect(0,0,t,e),r(h,0,0,t,e,6);let s=(i-n)/i;(o=h.createRadialGradient(t/2,e/2,i/2,t/2,e/2,0)).addColorStop(1,"rgba(32,32,32,0.5)"),o.addColorStop(s+.06,"rgba(0,0,0,0.8)"),o.addColorStop(s+.05,"rgba(128,128,128,1.0)"),o.addColorStop(s+.04,"rgba(255,255,255,0.6)"),o.addColorStop(s+.03,"rgba(255,255,255,0.8)"),o.addColorStop(s+.025,"rgba(255,255,255,0.8)"),o.addColorStop(s+.005,"rgba(255,255,255,0.5)"),o.addColorStop(0,"rgba(255,255,255,0.01)"),h.fillStyle=o,h.globalCompositeOperation="luminosity",h.fillRect(0,0,t,e),h.globalCompositeOperation="source-in",r(h,0,0,t,e,6),Object(c.canvasRGBA)(h.canvas,0,0,t,e,4)}function r(t,e,n,i,o,s=1){let r,c=t.getImageData(e,n,i,o),l=c.data;for(let t=0,e=l.length;t<e;t+=4)r=~~(Math.random()*s*2-s),l[t]=Object(a.clamp)(l[t]+r,0,255),r=~~(Math.random()*s*2-s),l[t+1]=Object(a.clamp)(l[t+1]+r,0,255),r=~~(Math.random()*s*2-s),l[t+2]=Object(a.clamp)(l[t+2]+r,0,255);h.putImageData(c,e,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){d=t.props,l=t.buffersByLabel.bokehBack,h=l.context,u=t.buffersByLabel.bokehFront,f=u.context;let e=l.width+l.height,n=u.width,o=u.height;m.length=0;for(var r=0;r<Math.floor(.01*(n+o));r++)m.push({radius:i(.005*e,.02*e),x:i(0,n),y:i(0,o),angle:i(0,p),vel:i(.05,.2),tick:i(0,1e4)});s(),d.events.on("resize",s)},e.generateBackground=s,e.draw=function(){var t=m.length;let e=u.width,n=u.height;for(f.fillStyle="rgba(0,0,0,0)",f.globalCompositeOperation="source-over",f.clearRect(0,0,e,n),f.shadowBlur=15,f.shadowColor="#fff";t--;){var s=m[t];s.x+=Math.cos(s.angle)*s.vel,s.y+=Math.sin(s.angle)*s.vel,s.angle+=i(-.05,.05),f.beginPath(),f.arc(s.x,s.y,s.radius,0,p),f.fillStyle=o(0,0,100,.03+.01*Math.cos(.02*s.tick)),f.fill(),s.x-s.radius>e&&(s.x=-s.radius),s.x+s.radius<0&&(s.x=e+s.radius),s.y-s.radius>n&&(s.y=-s.radius),s.y+s.radius<0&&(s.y=n+s.radius),s.tick++}};var a=n(2),c=n(38);n.n(c);let l,u,h,f,d,p=2*Math.PI,m=[],g=["rgba(255,64,64,1.0)","rgba(64,255,64,1.0)","rgba(64,64,225,1.0)"];Object(a.shuffle)(g);let b=["rgba(255,64,64,0.8)","rgba(64,255,64,0.8)","rgba(64,64,225,0.8)"];Object(a.shuffle)(b)},function(t,e){function n(t,e,n,i,o){if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLCanvasElement&&!t instanceof HTMLCanvasElement)return;var s,r=t.getContext("2d");try{try{s=r.getImageData(e,n,i,o)}catch(t){throw new Error("unable to access local image data: "+t)}}catch(t){throw new Error("unable to access image data: "+t)}return s}function i(t,e,i,s,r,a){if(!(isNaN(a)||a<1)){a|=0;var c=n(t,e,i,s,r);c=o(c,e,i,s,r,a),t.getContext("2d").putImageData(c,e,i)}}function o(t,e,n,i,o,s){var r,u,h,f,d,p,m,g,b,w,v,y,E,O,_,S,C,M,x,A,j,T,P,I,k=t.data,R=s+s+1,z=i-1,D=o-1,L=s+1,N=L*(L+1)/2,F=new a,G=F;for(h=1;h<R;h++)if(G=G.next=new a,h==L)var B=G;G.next=F;var H=null,U=null;m=p=0;var q=c[s],V=l[s];for(u=0;u<o;u++){for(S=C=M=x=g=b=w=v=0,y=L*(A=k[p]),E=L*(j=k[p+1]),O=L*(T=k[p+2]),_=L*(P=k[p+3]),g+=N*A,b+=N*j,w+=N*T,v+=N*P,G=F,h=0;h<L;h++)G.r=A,G.g=j,G.b=T,G.a=P,G=G.next;for(h=1;h<L;h++)f=p+((z<h?z:h)<<2),g+=(G.r=A=k[f])*(I=L-h),b+=(G.g=j=k[f+1])*I,w+=(G.b=T=k[f+2])*I,v+=(G.a=P=k[f+3])*I,S+=A,C+=j,M+=T,x+=P,G=G.next;for(H=F,U=B,r=0;r<i;r++)k[p+3]=P=v*q>>V,0!=P?(P=255/P,k[p]=(g*q>>V)*P,k[p+1]=(b*q>>V)*P,k[p+2]=(w*q>>V)*P):k[p]=k[p+1]=k[p+2]=0,g-=y,b-=E,w-=O,v-=_,y-=H.r,E-=H.g,O-=H.b,_-=H.a,f=m+((f=r+s+1)<z?f:z)<<2,g+=S+=H.r=k[f],b+=C+=H.g=k[f+1],w+=M+=H.b=k[f+2],v+=x+=H.a=k[f+3],H=H.next,y+=A=U.r,E+=j=U.g,O+=T=U.b,_+=P=U.a,S-=A,C-=j,M-=T,x-=P,U=U.next,p+=4;m+=i}for(r=0;r<i;r++){for(C=M=x=S=b=w=v=g=0,y=L*(A=k[p=r<<2]),E=L*(j=k[p+1]),O=L*(T=k[p+2]),_=L*(P=k[p+3]),g+=N*A,b+=N*j,w+=N*T,v+=N*P,G=F,h=0;h<L;h++)G.r=A,G.g=j,G.b=T,G.a=P,G=G.next;for(d=i,h=1;h<=s;h++)p=d+r<<2,g+=(G.r=A=k[p])*(I=L-h),b+=(G.g=j=k[p+1])*I,w+=(G.b=T=k[p+2])*I,v+=(G.a=P=k[p+3])*I,S+=A,C+=j,M+=T,x+=P,G=G.next,h<D&&(d+=i);for(p=r,H=F,U=B,u=0;u<o;u++)k[(f=p<<2)+3]=P=v*q>>V,P>0?(P=255/P,k[f]=(g*q>>V)*P,k[f+1]=(b*q>>V)*P,k[f+2]=(w*q>>V)*P):k[f]=k[f+1]=k[f+2]=0,g-=y,b-=E,w-=O,v-=_,y-=H.r,E-=H.g,O-=H.b,_-=H.a,f=r+((f=u+L)<D?f:D)*i<<2,g+=S+=H.r=k[f],b+=C+=H.g=k[f+1],w+=M+=H.b=k[f+2],v+=x+=H.a=k[f+3],H=H.next,y+=A=U.r,E+=j=U.g,O+=T=U.b,_+=P=U.a,S-=A,C-=j,M-=T,x-=P,U=U.next,p+=i}return t}function s(t,e,i,o,s,a){if(!(isNaN(a)||a<1)){a|=0;var c=n(t,e,i,o,s);c=r(c,e,i,o,s,a),t.getContext("2d").putImageData(c,e,i)}}function r(t,e,n,i,o,s){var r,u,h,f,d,p,m,g,b,w,v,y,E,O,_,S,C,M,x,A,j=t.data,T=s+s+1,P=i-1,I=o-1,k=s+1,R=k*(k+1)/2,z=new a,D=z;for(h=1;h<T;h++)if(D=D.next=new a,h==k)var L=D;D.next=z;var N=null,F=null;m=p=0;var G=c[s],B=l[s];for(u=0;u<o;u++){for(O=_=S=g=b=w=0,v=k*(C=j[p]),y=k*(M=j[p+1]),E=k*(x=j[p+2]),g+=R*C,b+=R*M,w+=R*x,D=z,h=0;h<k;h++)D.r=C,D.g=M,D.b=x,D=D.next;for(h=1;h<k;h++)f=p+((P<h?P:h)<<2),g+=(D.r=C=j[f])*(A=k-h),b+=(D.g=M=j[f+1])*A,w+=(D.b=x=j[f+2])*A,O+=C,_+=M,S+=x,D=D.next;for(N=z,F=L,r=0;r<i;r++)j[p]=g*G>>B,j[p+1]=b*G>>B,j[p+2]=w*G>>B,g-=v,b-=y,w-=E,v-=N.r,y-=N.g,E-=N.b,f=m+((f=r+s+1)<P?f:P)<<2,g+=O+=N.r=j[f],b+=_+=N.g=j[f+1],w+=S+=N.b=j[f+2],N=N.next,v+=C=F.r,y+=M=F.g,E+=x=F.b,O-=C,_-=M,S-=x,F=F.next,p+=4;m+=i}for(r=0;r<i;r++){for(_=S=O=b=w=g=0,v=k*(C=j[p=r<<2]),y=k*(M=j[p+1]),E=k*(x=j[p+2]),g+=R*C,b+=R*M,w+=R*x,D=z,h=0;h<k;h++)D.r=C,D.g=M,D.b=x,D=D.next;for(d=i,h=1;h<=s;h++)p=d+r<<2,g+=(D.r=C=j[p])*(A=k-h),b+=(D.g=M=j[p+1])*A,w+=(D.b=x=j[p+2])*A,O+=C,_+=M,S+=x,D=D.next,h<I&&(d+=i);for(p=r,N=z,F=L,u=0;u<o;u++)j[f=p<<2]=g*G>>B,j[f+1]=b*G>>B,j[f+2]=w*G>>B,g-=v,b-=y,w-=E,v-=N.r,y-=N.g,E-=N.b,f=r+((f=u+k)<I?f:I)*i<<2,g+=O+=N.r=j[f],b+=_+=N.g=j[f+1],w+=S+=N.b=j[f+2],N=N.next,v+=C=F.r,y+=M=F.g,E+=x=F.b,O-=C,_-=M,S-=x,F=F.next,p+=i}return t}function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],l=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];t.exports={image:function(t,e,n,o){if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLImageElement&&!t instanceof HTMLImageElement)return;var r=t.naturalWidth,a=t.naturalHeight;if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLCanvasElement&&!e instanceof HTMLCanvasElement)return;e.style.width=r+"px",e.style.height=a+"px",e.width=r,e.height=a;var c=e.getContext("2d");c.clearRect(0,0,r,a),c.drawImage(t,0,0),isNaN(n)||n<1||(o?i(e,0,0,r,a,n):s(e,0,0,r,a,n))},canvasRGBA:i,canvasRGB:s,imageDataRGBA:o,imageDataRGB:r}},function(t,e,n){"use strict";function i(){let t,e,{width:n,height:i,minDimension:o,orientation:s}=j;_.width=S.width=o,_.height=S.height=o,s?(t=0,e=(i-n)/2):(t=(n-i)/2,e=0),_.offsetX=S.offsetX=t,_.offsetY=S.offsetY=e}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=n(14),r=n(0),a=n(2),c=n(6),l=n(5),u=n(4),h=n(16);const{vec2:f,lerp:d}=o.b,{mut_plus:p}=o.a;let{min:m,cos:g,sin:b,sqrt:w,tan:v,round:y,PI:E}=Math;const O=r.TARGET_FPS;let _,S,C,M,x,A,j;const T=function(){let t=f(),e=f(),n=f(),i=f(),o=f(),s=f(),r=0,c=0,l=0,u=0,h=0,m=0,w=0,E=0,O=0,S=0,C=0,M=0,A=0,j=0;return function(f,T,P,I,k,R=4,z=0){h=.9,O=.7,S=.9,l=.57121,E=.71213,d(T,P,u=.6,t),d(T,P,O,e),d(T,P,h,n),d(T,P,S,i),p(Object(a.rotate)(t,n,v(g((x+z)*l)),o),t),p(Object(a.rotate)(e,i,v(b((x+z)*E)),s),e),C=T[0],M=T[1],A=P[0],j=P[1],r=o[0],c=o[1],m=s[0],w=s[1],_.width>_.height?(C=C,A=A,r=r,m=m):(M=M,j=j,c=c,w=w),f.beginPath(),f.moveTo(C,M),f.bezierCurveTo(r,c,m,w,A,j),f.strokeStyle=I,f.lineWidth=y(g((x+z)*l)*R),f.lineCap="round",f.stroke(),f.closePath(),f.beginPath(),f.moveTo(C,M),f.bezierCurveTo(r,c,m,w,A,j),f.strokeStyle=k,f.lineWidth=y(g((x+z)*l)*~~(R/4)),f.lineCap="round",f.stroke(),f.closePath()}}(),P=function(){let t,e=0,n=0,i=0,o=0,r=0,a=f(),l=f(),d=0,p=0,m=0,v=0,y=0,E=0,_=0;return function(f){C.globalCompositeOperation="lighter",E=Object(c.screenSpace)(f.pos[0]),_=Object(c.screenSpace)(f.pos[1]),({pulse:e,pregnant:n,injured:i,lastMeal:o}=f),r=f.size*j.minDimension,n?(d=r*g(.2*(x+e))*(w(n)+1),p=r*b(.2*(x+e+O))*(w(n)+1)*.1):i?(d=r*g((x+e)*(1-1/i+.2)),p=r*b(.2*(x+e+O))*.1):(d=r*g(.2*(x+e)),p=r*b(.2*(x+e+O))*.1),m=.5*d,v=.5*p,y=s.util.colorIndex(f.color[u.c],f.color[u.b],f.color[u.a]),t=s.motes.get(y),C.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,E-m,_-m,d,d),t=s.motes.getCenter(),C.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,E-m,_-m,d,d),f.target&&f.action==h.a&&(a[0]=E,a[1]=_,l[0]=Object(c.screenSpace)(f.target.pos[0]),l[1]=Object(c.screenSpace)(f.target.pos[1]),T(C,a,l,s.motes.getColorString(y),"white",5,e))}}(),I=function(){let t,e=0,n=0,i=0,o=0,a=0,l=0;return function(u){Object(c.updateCompositeOperation)(C,"lighter"),i=Object(c.screenSpace)(u.pos[0]),o=Object(c.screenSpace)(u.pos[1]),t=s.photons.get(u.color),a=r.PHOTON_BASE_SIZE*j.minDimension,l=u.pulse,e=.75*a*(g(.3*(x+l))*b(.1*(x+l)))+.25*a,n=.5*e,C.drawImage(t.canvas,0,0,t.pixelSize,t.pixelSize,i-n,o-n,e,e)}}(),k=function(){let t,e=0,n=0,i=0,o=0,r=0;return function(a){Object(c.updateCompositeOperation)(C,"lighter"),i=Object(c.screenSpace)(a.pos[0]),o=Object(c.screenSpace)(a.pos[1]),t=s.markers.get(),r=.5*Math.pow(100-a.mass,1.5),n=.5*(e=r),C.drawImage(t.canvas,0,0,t.pixelSize,t.pixelSize,i-n,o-n,e,e),e=r*g(10*x),n=.5*e,C.drawImage(t.canvas,0,0,t.pixelSize,t.pixelSize,i-n,o-n,e,e)}}(),R=function(){let t,e=0,n=0,i=0,o=0,r=0,a=0,l=0,h=0,f=0;return function(d){switch(i=Object(c.screenSpace)(d.pos[0]),o=Object(c.screenSpace)(d.pos[1]),e=d.size*j.minDimension*1+b(.2*x),n=.5*e,t=s.voids.get(),Object(c.updateCompositeOperation)(M,"source-over"),M.drawImage(t.canvas,i-n,o-n,e,e),d.lastMeal){case-1:f=2184;break;case u.c:f=3908;break;case u.b:f=1268;break;case u.a:f=1103}h=.5*(l=1.7*e),r=b(.0127*x)*e*.1,a=g(.0127*x)*e*.1,t=s.motes.get(4095),Object(c.updateCompositeOperation)(M,"soft-light"),M.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-h,o+a-h,l,l),h=.5*(l=1.2*e),r=g(.023*x)*e*.13,a=b(.023*x)*e*.13,t=s.motes.get(f),M.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-h,o+a-h,l,l),t=s.motes.get(0),h=.5*(l=1.65*e),r=b(.0122*x)*e*.15,a=g(.0122*x)*e*.15,Object(c.updateCompositeOperation)(M,"multiply"),M.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-h,o+a-h,l,l)}}(),z=function(){let t,e=0,n=0,i=0,o=0,r=0,a=0,l=0,u=0;return function(h){Object(c.updateCompositeOperation)(C,"lighter"),i=Object(c.screenSpace)(h.pos[0]),o=Object(c.screenSpace)(h.pos[1]),e=h.size*j.minDimension,n=.5*e,t=s.emitters.get(),C.drawImage(t.canvas,i-n,o-n,e,e),l=g(.2*x)*e*1.7,u=.5*l,t=s.motes.get(819),C.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i-u,o-u,l,l);try{u=.5*(l=1.3*e),r=b(.08*x)*e*(.1-.1*h.ratios[0]),a=g(.08*x)*e*(.1-.1*h.ratios[0]),t=s.motes.get(15.9*h.ratios[0]<<8),C.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-u,o+a-u,l,l),u=.5*(l=1.3*e),r=b(.08*x+2.094394)*e*(.1-.1*h.ratios[1]),a=g(.08*x+2.094394)*e*(.1-.1*h.ratios[1]),t=s.motes.get(15.9*h.ratios[1]<<4),C.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-u,o+a-u,l,l),u=.5*(l=1.3*e),r=b(.08*x+4.188789)*e*(.1-.1*h.ratios[2]),a=g(.08*x+4.188789)*e*(.1-.1*h.ratios[2]),t=s.motes.get(~~(15.9*h.ratios[2])),C.drawImage(t.canvas,t.sx,t.sy,t.sw,t.sh,i+r-u,o+a-u,l,l)}catch(t){console.log(t.message)}}}(),D=function(){function t(t,e){p=b(.08*x+t)*v*e,w=g(.08*x+t)*v*e,o[0]=h+p,o[1]=d+w,T(M,i,o,a,l,r)}let e,n=0,i=f(),o=f(),r=4,a="rgba(0,0,0,0.3)",l="rgba(0,0,0,0.7)",u=E*(1/3),h=0,d=0,p=0,w=0,v=0,y=0;return function(o){Object(c.updateCompositeOperation)(M,"multiply"),h=Object(c.screenSpace)(o.pos[0]),d=Object(c.screenSpace)(o.pos[1]),n=o.size*j.minDimension,r=m(4,~~((v=n)/2)),y=.5*v,i[0]=h,i[1]=d,t(0,.5),t(2*u,.5),t(4*u,.5),t(u,.25),t(3*u,.25),t(5*u,.25),e=s.motes.get(0),M.drawImage(e.canvas,e.sx,e.sy,e.sw,e.sh,h-y,d-y,v,v)}}();e.init=function(t){j=t.props,A=t.timing,_=t.buffersByLabel.entitiesLight,S=t.buffersByLabel.entitiesDark,C=_.context,M=S.context,i(),j.events.on("resize",i),s.init(j)};const L=function(){let t,e,n,i,o;return function(r){Object(c.updateCompositeOperation)(C,"destination-out"),C.fillStyle="rgba(0,0,0,0.2)",C.fillRect(0,0,_.width,_.height),Object(c.updateCompositeOperation)(M,"destination-out"),M.fillStyle="rgba(0,0,0,0.1)",M.clearRect(0,0,S.width,S.height),x=A.frameCount;let a=s.ui.get("mask");for(t=0,e=r.entities.length;t<e;++t)n=r.entities[t],i=Object(c.screenSpace)(n.pos[0]),o=Object(c.screenSpace)(n.pos[1]),Object(c.offscreen)(i,o)||(n instanceof l.Mote?P(n):n instanceof l.Photon?I(n):n instanceof l.Void?R(n):n instanceof l.Emitter?z(n):n instanceof l.AntiGravitonCluster?D(n):n instanceof l.Ripple&&k(n));Object(c.updateCompositeOperation)(C,"destination-out"),C.drawImage(a.canvas,0,0,j.minDimension,j.minDimension),Object(c.updateCompositeOperation)(M,"destination-out"),M.drawImage(a.canvas,0,0,j.minDimension,j.minDimension)}}();e.draw=L},function(t,e,n){"use strict";function i(t){h=t.minDimension,f=4*m.MOTE_BASE_SIZE,d=Object(g.scaleSprite)(h,f),function(){(s=document.createElement("canvas")).width=s.height=d;let t=(c=s.getContext("2d")).createRadialGradient(d/2,d/2,d/2,d/2,d/2,0);t.addColorStop(1,"rgba(255,255,255,1.0"),t.addColorStop(.8,"rgba(255,255,255,0.5)"),t.addColorStop(.1,"rgba(255,255,255,0.0)"),c.fillStyle=t,c.fillRect(0,0,d,d)}(),function(){let t=d,e=d,n=document.createElement("canvas");n.width=t,n.height=e;let i=n.getContext("2d");i.globalCompositeOperation="copy",i.drawImage(s,0,0,t,e),i.globalCompositeOperation="source-in",i.fillStyle="rgba(255,255,255,0.15)",i.fillRect(0,0,t,e),r={canvas:n,context:i,pixelSize:d,sw:d,sh:d,sx:0,sy:0}}(),function(){(l=document.createElement("canvas")).width=l.height=d,u=l.getContext("2d"),(p=document.createElement("canvas")).width=p.height=64*d,a=p.getContext("2d"),o=Array(4096);for(let t=0;t<4096;++t)y[t]="rgb("+((t&b)>>4)+","+(t&w)+","+((t&v)<<4)+")",o[t]=function(t,e){let n=d,i=d,o=t%64,r=o*d,c=(t-o)/64*d;return u.globalCompositeOperation="copy",u.drawImage(s,0,0,n,i),u.globalCompositeOperation="source-in",u.fillStyle=e,u.fillRect(0,0,n,i),a.drawImage(l,c,r,n,i),{canvas:p,context:a,pixelSize:d,sw:d,sh:d,sx:c,sy:r}}(t,y[t])}()}Object.defineProperty(e,"__esModule",{value:!0}),e.getColorString=function(t){return y[t]},e.get=function(t){return o[t]},e.getCenter=function(){return r},e.init=i;var o,s,r,a,c,l,u,h,f,d,p,m=n(0),g=n(3);const b=3840,w=240,v=15,y=Array(4096)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){let e=Object(o.scaleSprite)(t.minDimension,1),n=document.createElement("canvas");n.width=n.height=e;let s=n.getContext("2d"),r=s.createRadialGradient(e/2,e/2,e/2,e/2,e/2,0);r.addColorStop(1,"rgba(255,255,255,0.3)"),r.addColorStop(.78,"rgba(255,255,255,0.3)"),r.addColorStop(.58,"rgba(255,255,255,0.22)"),r.addColorStop(.48,"rgba(255,255,255,0.17)"),r.addColorStop(.44,"rgba(255,255,255,0.22)"),r.addColorStop(.4,"rgba(255,255,255,0.19)"),r.addColorStop(.2,"rgba(255,255,255,0.09)"),r.addColorStop(.1,"rgba(255,255,255,0.0)"),s.fillStyle=r,s.fillRect(0,0,e,e),i={canvas:n,context:s,w:e,h:e,pixelSize:e}},e.get=function(){return i};var i,o=n(3)},function(t,e,n){"use strict";function i(t,e,n){let i=document.createElement("canvas");i.width=i.height=17;let o,s=i.getContext("2d");return(o=s.createRadialGradient(8,8,8,8,8,0)).addColorStop(.7,n),o.addColorStop(1,"white"),s.globalCompositeOperation="source-over",s.beginPath(),s.moveTo(8,0),s.quadraticCurveTo(8,8,0,8),s.quadraticCurveTo(8,8,8,17),s.quadraticCurveTo(8,8,17,8),s.quadraticCurveTo(8,8,8,0),s.fillStyle=o,s.fill(),s.closePath(),s.beginPath(),s.moveTo(8,4),s.lineTo(8,13),s.moveTo(4,8),s.lineTo(13,8),s.strokeStyle="white",s.lineWidth=1,s.stroke(),s.closePath(),{canvas:i,context:s,pixelSize:17,w:17,h:17}}Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){r[s.c]=i(t.minDimension,o.PHOTON_BASE_SIZE,"red"),r[s.b]=i(t.minDimension,o.PHOTON_BASE_SIZE,"green"),r[s.a]=i(t.minDimension,o.PHOTON_BASE_SIZE,"blue")},e.get=function(t){return r[t]};var o=n(0),s=n(4);const r=Array(3)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){let e=Object(o.scaleSprite)(t.minDimension,1),n=document.createElement("canvas");n.width=n.height=e;let s=n.getContext("2d"),r=s.createRadialGradient(e/2,e/2,e/2,e/2,e/2,0);r.addColorStop(1,"rgba(0,0,0,1.0)"),r.addColorStop(.5,"rgba(0,0,0,1.0)"),r.addColorStop(.479,"rgba(0,0,0,0.99)"),r.addColorStop(.442,"rgba(0,0,0,0.98)"),r.addColorStop(.44,"rgba(255,255,255,0.95)"),r.addColorStop(.43,"rgba(255,255,255,0.95)"),r.addColorStop(.41,"rgba(255,255,255,0.39)"),r.addColorStop(.37,"rgba(255,255,255,0.29)"),r.addColorStop(.36,"rgba(255,255,255,0.32)"),r.addColorStop(.34,"rgba(255,255,255,0.31)"),r.addColorStop(.3,"rgba(255,255,255,0.35)"),r.addColorStop(.28,"rgba(255,255,255,0.39)"),r.addColorStop(.26,"rgba(255,255,255,0.35)"),r.addColorStop(.23,"rgba(255,255,255,0.30)"),r.addColorStop(.21,"rgba(255,255,255,0.26)"),r.addColorStop(.2,"rgba(255,255,255,0.31)"),r.addColorStop(.19,"rgba(255,255,255,0.34)"),r.addColorStop(.17,"rgba(255,255,255,0.29)"),r.addColorStop(.16,"rgba(255,255,255,0.21)"),r.addColorStop(.15,"rgba(255,255,255,0.19)"),r.addColorStop(.14,"rgba(255,255,255,0.15)"),r.addColorStop(.1,"rgba(255,255,255,0.09)"),r.addColorStop(.09,"rgba(255,255,255,0.15)"),r.addColorStop(.07,"rgba(255,255,255,0.12)"),r.addColorStop(.05,"rgba(255,255,255,0.09)"),r.addColorStop(0,"rgba(0,0,0,0.0)"),s.fillStyle=r,s.fillRect(0,0,e,e),i={canvas:n,context:s,w:e,h:e,pixelSize:e}},e.get=function(){return i};var i,o=n(3)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=function(t){let e=Object(o.scaleSprite)(t.minDimension,1),n=~~(e/2),s=document.createElement("canvas");s.width=s.height=e;let r=s.getContext("2d"),a=r.createRadialGradient(n,n,n,n,n,0);a.addColorStop(0,"rgba(255,255,255,0.0)"),a.addColorStop(.75,"rgba(255,255,255,0.0)"),a.addColorStop(.8,"rgba(255,255,255,0.007)"),a.addColorStop(.85,"rgba(255,255,255,0.007)"),a.addColorStop(.9,"rgba(255,255,255,0.0)"),r.fillStyle=a,r.fillRect(0,0,e,e),i={canvas:s,context:r,pixelSize:e,w:e,h:e}},e.get=function(){return i};var i,o=n(3)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get=function(t){return i[t]},e.init=function(t){let e=t.minDimension,n=document.createElement("canvas");n.width=n.height=e;let o=n.getContext("2d"),s=o.createRadialGradient(e/2,e/2,e/2,e/2,e/2,0);s.addColorStop(1,"rgba(0,0,0,0.0)"),s.addColorStop(.05,"rgba(0,0,0,0.0)"),s.addColorStop(0,"rgba(255,255,255,1.0)"),o.fillStyle=s,o.fillRect(0,0,e,e),i.mask={canvas:n,context:o,w:e,h:e,pixelSize:e}};var i={mask:void 0}},function(t,e,n){"use strict";function i(t=c(),e=c(),n=1,i,o=l(1,1,1)){return this.pos=c(t),this.vel=c(e),this.ratios=Object(r.norm_ratio)(o),this.birthMass=n,this.mass=1,this.initialMass=n,this.arms=i||g(p()*p()*50),this.size=0,this.next=~~(3*p()),this}e.a=i;var o=n(1),s=n(0),r=n(2),a=n(5);let{vec2:c,vec3:l,times:u,mut_times:h,distance:f}=o.b,{mut_plus:d}=o.a,{random:p,sqrt:m,ceil:g,min:b,PI:w}=Math;const v=c(0,0);let y,E=c(),O=0,_=0,S=0,C=0,M=0,x=0,A=0;i.prototype.tick=function(t,e,n){if(this.birthMass>0&&(A=b(this.birthMass,g(this.mass/100)),this.birthMass-=A,this.mass+=A),this.size=m(this.mass/w)*s.EMITTER_SIZE,0===this.birthMass&&(O=this.initialMass/20,S=g(s.TARGET_FPS/O),_=O/s.TARGET_FPS,n%S==0))for(;_-- >0&&this.mass>0;)this.mass--,t.push(this.emitPhoton());for(d(this.pos,u(this.vel,e,E)),d(this.vel,Object(r.drag)(this.vel,s.GLOBAL_DRAG)),d(this.vel,Object(r.avoid)(this.vel,this.pos,v,1.3,.001,E)),C=0,M=t.length;C<M;++C)(y=t[C])!==this&&(x=f(this.pos,y.pos),y instanceof i?d(y.vel,h(Object(r.gravitate)(y.pos,this.pos,this.mass*y.mass,E),1/y.mass)):d(y.vel,h(Object(r.gravitate)(y.pos,this.pos,-this.mass*y.mass,E),1/y.mass)))},i.prototype.emitPhoton=function(){let t=c(),e=0,n=0,i=0;return function(){return i=this.next,t[0]=this.size/5,t[1]=this.size/5,d(t,this.pos),n=this.mass%this.initialMass,e=n/(this.initialMass/2),e+=n%this.arms*(2/this.arms),d(Object(r.rotate)(t,this.pos,e,t),this.pos),this.next=function(t){let e=p();return e<t[0]?0:e<t[0]+t[1]?1:2}(this.ratios),new a.Photon(t,c(0,0),i)}}()},function(t,e,n){"use strict";function i(t,e,n=o.TARGET_FPS){this.type=t,this.pos=s.b.vec2(e),this.start=n,this.lifetime=n}e.a=i;var o=n(0),s=n(1);i.prototype.tick=function(){this.lifetime--}},function(t,e,n){"use strict";function i(t=l(),e=100){return this.pos=l(t),this.vel=l(0,0),this.storedMass=0,this.mass=e,this}e.a=i;var o=n(1),s=n(2),r=n(4),a=n(11);let c,{vec2:l,mut_times:u,distance:h}=o.b,{mut_plus:f}=o.a,d=l(),p=0,m=0,g=0;i.prototype.tick=function(t){for(this.storedMass?(this.mass+=this.storedMass,this.storedMass=0):this.mass--,p=0,m=t.length;p<m;++p)(c=t[p])!==this&&(g=h(this.pos,c.pos),c instanceof r.d?g<.01?c.lifetime=0:f(c.vel,u(Object(s.gravitate)(c.pos,this.pos,20*this.mass,d),1/c.mass)):c instanceof i&&!c.storedMass?g<.005&&g>.001&&(this.storedMass++,c.mass--):c instanceof a.a?(g<.0025&&(c.birthMass+=this.storedMass,this.storedMass=0),g-c.size<.01&&this.mass>90&&this.mass<100&&c.mass--,this.storedMass=0):f(c.vel,u(Object(s.gravitate)(c.pos,this.pos,-this.mass*c.mass,d),1/c.mass)))}},function(t,e,n){"use strict";function i(t=c(),e=c(),n=1){return this.pos=c(t),this.vel=c(e),this.size=0,this.birthMass=this.initialMass=n,this.mass=1,this.instability=0,this.size=0,this}e.a=i;var o=n(1),s=n(2),r=n(5),a=n(0);const{vec2:c,times:l,distance:u,mut_copy:h}=o.b,{mut_plus:f}=o.a,{random:d,sqrt:p,PI:m,ceil:g,min:b,max:w}=Math,v=c(0,0);let y,E=c(),O=0,_=0,S=0,C=0;i.prototype.tick=function(t,e,n){if(this.birthMass>0&&(C=b(this.birthMass,g(this.mass/10)),this.birthMass-=C,this.mass+=C),this.size=p(.05*this.mass/m)*a.MOTE_BASE_SIZE,f(this.pos,l(this.vel,e,E)),this.initialMass=w(this.mass,this.initialMass),f(this.vel,Object(s.avoid)(this.vel,this.pos,v,1.3,.01,E)),f(this.vel,Object(s.drag)(this.vel,a.GLOBAL_DRAG)),0===this.birthMass&&(this.instability+=.003*this.mass),n%g(.05*a.TARGET_FPS)==0)for(;this.instability>0&&this.mass>0;)t.push(this.emitPhoton()),this.mass-=b(this.mass,7),this.instability-=.9;for(O=0,_=t.length;O<_;++O)if((y=t[O])!==this&&(S=u(this.pos,y.pos),y instanceof r.Void))return S<.5*(y.size+this.size)&&(C=b(y.mass,g((y.mass+y.birthMass)/10)),this.mass+=C,y.mass-=C,this.instability+=.07*C),void(S<10*this.size&&f(this.vel,Object(s.accelerate)(this.pos,y.pos,this.size*S*5,E)))},i.prototype.emitPhoton=function(){let t=c(),e=c(),n=c(),i=0,o=0,a=0;return function(){return a=~~(3*d()),t[0]=.1*this.size,t[1]=.1*this.size,f(t,this.pos),h(e,this.vel),o=this.mass%this.initialMass,i=o/(this.initialMass/2),i+=o%100*.02,h(n,Object(s.rotate)(t,this.pos,i,t)),f(n,this.pos),f(t,n),f(e,Object(s.accelerate)(this.pos,t,2*this.size,E)),new r.Photon(t,e,a)}}()},function(t,e,n){"use strict";function i(t){let e,n,i,o=h.width,r=h.height,a=!0,c=90,u=Date.now();if(t.started<0||t.started>u-1e3){for(i="rgba(255,255,255,"+(e=(1e3-(n=t.started>0?u-t.started:0))/1e3)+")";a;)try{l.font=c+"px RightBankFLF",l.fillStyle=i,s(l,"PHOTONOMIX",o/2,r/2+c/2),a=!1}catch(t){a=!0,c-=10}l.font=c/3+"px RightBankFLF",l.fillStyle=i,s(l,"click to start",o/2,r/2+c)}}function o(t){let e=h.width,n=h.height;l.clearRect(0,0,e,n),a.DEBUG&&f(),i(t),function(){let t=c.a.getCursorPosition();Object(r.drawCircle)(l,t[0],t[1],5,"white")}()}function s(t,e,n,i){let o=t.measureText(e);if(o.width>h.width)throw new Error("text is wider than body");t.fillText(e,n-o.width/2,i)}Object.defineProperty(e,"__esModule",{value:!0}),e.drawUIText=i,e.draw=o,e.writeCentered=s,e.init=function(t){h=t.props,u=t.buffersByLabel.ui,l=u.context};var r=n(6),a=n(0),c=n(7);let l,u,h;const f=function(){let t,e,n,i;return function(){t=h.width,e=h.height,n=t/2,i=e/2,Object(r.drawCircle)(l,0,0,4,"yellow",1,"white"),Object(r.drawCircle)(l,n,0,4,"orange",1,"white"),Object(r.drawCircle)(l,t,0,4,"red",1,"white"),Object(r.drawCircle)(l,0,i,4,"white",1,"white"),Object(r.drawCircle)(l,n,i,4,"gray",1,"white"),Object(r.drawCircle)(l,t,i,4,"black",1,"white"),Object(r.drawCircle)(l,0,e,4,"blue",1,"white"),Object(r.drawCircle)(l,n,e,4,"cyan",1,"white"),Object(r.drawCircle)(l,t,e,4,"green",1,"white")}}()}]);
//# sourceMappingURL=photonomix.js.map